<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduSync | Teacher Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Fallback for offline use -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    /* Fallback font stack */
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    /* Simple icon fallbacks for common icons */
    .fas.fa-tachometer-alt::before { content: "📊"; }
    .fas.fa-book::before { content: "📚"; }
    .fas.fa-users::before { content: "👥"; }
    .fas.fa-tasks::before { content: "📋"; }
    .fas.fa-graduation-cap::before { content: "🎓"; }
    .fas.fa-comments::before { content: "💬"; }
    .fas.fa-chart-bar::before { content: "📈"; }
    .fas.fa-cog::before { content: "⚙️"; }
    .fas.fa-plus::before { content: "➕"; }
    .fas.fa-edit::before { content: "✏️"; }
    .fas.fa-trash::before { content: "🗑️"; }
    .fas.fa-eye::before { content: "👁️"; }
    .fas.fa-download::before { content: "⬇️"; }
    .fas.fa-star::before { content: "⭐"; }
    .fas.fa-times::before { content: "✖️"; }
    .fas.fa-microphone::before { content: "🎤"; }
    .fas.fa-comment::before { content: "💭"; }
    .fas.fa-moon::before { content: "🌙"; }
    .fas.fa-sun::before { content: "☀️"; }
    .fas.fa-bars::before { content: "☰"; }
    .fas.fa-chalkboard-teacher::before { content: "👨‍🏫"; }
    .fas.fa-envelope::before { content: "✉️"; }
    .fas.fa-calendar::before { content: "📅"; }
    .fas.fa-clock::before { content: "🕐"; }
    .fas.fa-file::before { content: "📄"; }
    .fas.fa-check::before { content: "✅"; }
    .fas.fa-exclamation::before { content: "⚠️"; }
    .fas.fa-info::before { content: "ℹ️"; }
    .fas.fa-question::before { content: "❓"; }
    .fas.fa-search::before { content: "🔍"; }
    .fas.fa-filter::before { content: "🔧"; }
    .fas.fa-sort::before { content: "↕️"; }
    .fas.fa-upload::before { content: "⬆️"; }
    .fas.fa-save::before { content: "💾"; }
    .fas.fa-undo::before { content: "↶"; }
    .fas.fa-redo::before { content: "↷"; }
    .fas.fa-print::before { content: "🖨️"; }
    .fas.fa-share::before { content: "📤"; }
    .fas.fa-link::before { content: "🔗"; }
    .fas.fa-copy::before { content: "📋"; }
    .fas.fa-paste::before { content: "📋"; }
    .fas.fa-cut::before { content: "✂️"; }
    .fas.fa-bold::before { content: "B"; }
    .fas.fa-italic::before { content: "I"; }
    .fas.fa-underline::before { content: "U"; }
    .fas.fa-list::before { content: "📝"; }
    .fas.fa-list-ol::before { content: "1️⃣"; }
    .fas.fa-list-ul::before { content: "•"; }
    .fas.fa-align-left::before { content: "⬅️"; }
    .fas.fa-align-center::before { content: "↔️"; }
    .fas.fa-align-right::before { content: "➡️"; }
    .fas.fa-align-justify::before { content: "↔️"; }
    .fas.fa-indent::before { content: "➡️"; }
    .fas.fa-outdent::before { content: "⬅️"; }
    .fas.fa-quote-left::before { content: "❝"; }
    .fas.fa-quote-right::before { content: "❞"; }
    .fas.fa-code::before { content: "&lt;/&gt;"; }
    .fas.fa-table::before { content: "📊"; }
    .fas.fa-image::before { content: "🖼️"; }
    .fas.fa-video::before { content: "🎥"; }
    .fas.fa-music::before { content: "🎵"; }
    .fas.fa-file-pdf::before { content: "📄"; }
    .fas.fa-file-word::before { content: "📝"; }
    .fas.fa-file-excel::before { content: "📊"; }
    .fas.fa-file-powerpoint::before { content: "📊"; }
    .fas.fa-file-archive::before { content: "📦"; }
    .fas.fa-file-image::before { content: "🖼️"; }
    .fas.fa-file-video::before { content: "🎥"; }
    .fas.fa-file-audio::before { content: "🎵"; }
    .fas.fa-folder::before { content: "📁"; }
    .fas.fa-folder-open::before { content: "📂"; }
    .fas.fa-home::before { content: "🏠"; }
    .fas.fa-user::before { content: "👤"; }
    .fas.fa-users::before { content: "👥"; }
    .fas.fa-user-plus::before { content: "👤➕"; }
    .fas.fa-user-minus::before { content: "👤➖"; }
    .fas.fa-user-edit::before { content: "👤✏️"; }
    .fas.fa-user-cog::before { content: "👤⚙️"; }
    .fas.fa-user-lock::before { content: "👤🔒"; }
    .fas.fa-user-shield::before { content: "👤🛡️"; }
    .fas.fa-user-graduate::before { content: "🎓"; }
    .fas.fa-user-tie::before { content: "👔"; }
    .fas.fa-user-friends::before { content: "👥"; }
    .fas.fa-user-clock::before { content: "👤🕐"; }
    .fas.fa-user-check::before { content: "👤✅"; }
    .fas.fa-user-times::before { content: "👤❌"; }
    .fas.fa-user-slash::before { content: "👤🚫"; }
    .fas.fa-user-tag::before { content: "👤🏷️"; }
    .fas.fa-user-secret::before { content: "👤🕵️"; }
    .fas.fa-user-ninja::before { content: "👤🥷"; }
    .fas.fa-user-astronaut::before { content: "👤🚀"; }
    .fas.fa-user-injured::before { content: "👤🤕"; }
    .fas.fa-user-nurse::before { content: "👤🏥"; }
    .fas.fa-user-md::before { content: "👤⚕️"; }
    .fas.fa-user-graduate::before { content: "👤🎓"; }
    .fas.fa-user-tie::before { content: "👤👔"; }
    .fas.fa-user-friends::before { content: "👤👥"; }
    .fas.fa-user-clock::before { content: "👤🕐"; }
    .fas.fa-user-check::before { content: "👤✅"; }
    .fas.fa-user-times::before { content: "👤❌"; }
    .fas.fa-user-slash::before { content: "👤🚫"; }
    .fas.fa-user-tag::before { content: "👤🏷️"; }
    .fas.fa-user-secret::before { content: "👤🕵️"; }
    .fas.fa-user-ninja::before { content: "👤🥷"; }
    .fas.fa-user-astronaut::before { content: "👤🚀"; }
    .fas.fa-user-injured::before { content: "👤🤕"; }
    .fas.fa-user-nurse::before { content: "👤🏥"; }
    .fas.fa-user-md::before { content: "👤⚕️"; }
  </style>
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3f37c9;
      --accent: #4cc9f0;
      --danger: #f72585;
      --success: #4ad66d;
      --warning: #f7b801;
      --dark: #0a0a0a;
      --dark-gray: #1a1a1a;
      --medium-gray: #2d2d2d;
      --light-gray: #3d3d3d;
      --text: #ffffff;
      --text-light: #b0b0b0;
      --glass: rgba(30, 30, 30, 0.6);
      --glass-border: rgba(255, 255, 255, 0.1);
    }
    body.light-theme {
      --dark: #f5f6fa;
      --dark-gray: #e1e5ea;
      --medium-gray: #f0f0f0;
      --light-gray: #e9ecef;
      --text: #22223b;
      --text-light: #414346;
      --glass: rgba(255,255,255,0.7);
      --glass-border: rgba(0,0,0,0.07);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body {
      background-color: var(--dark);
      color: var(--text);
      min-height: 100vh;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(67, 97, 238, 0.15) 0%, transparent 25%),
        radial-gradient(circle at 80% 70%, rgba(63, 55, 201, 0.15) 0%, transparent 25%);
      transition: background 0.3s, color 0.3s;
    }
    .container {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
      transition: grid-template-columns 0.3s;
    }
    .sidebar {
      background-color: var(--dark-gray);
      border-right: 1px solid var(--glass-border);
      padding: 20px 0;
      min-width: 280px;
      max-width: 280px;
      width: 280px;
      transition: width 0.3s, min-width 0.3s, max-width 0.3s;
      overflow: hidden;
    }
    
    /* Sidebar collapsed state */
    body.sidebar-collapsed .container {
      grid-template-columns: 60px 1fr;
    }
    
    body.sidebar-collapsed .sidebar {
      min-width: 60px;
      max-width: 60px;
      width: 60px;
    }
    
    body.sidebar-collapsed .logo-text {
      display: none;
    }
    
    body.sidebar-collapsed .nav-link span {
      display: none;
    }
    
    body.sidebar-collapsed .nav-icon {
      margin-right: 0;
      width: 100%;
      text-align: center;
    }
    
    /* Sidebar toggle button */
    #sidebar-toggle {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1100;
      display: none;
    }
    
    body.sidebar-collapsed #sidebar-toggle {
      display: block;
    }
    .logo {
      display: flex;
      align-items: center;
      padding: 0 24px 20px;
      border-bottom: 1px solid var(--glass-border);
      margin-bottom: 20px;
      min-height: 60px;
      width: 100%;
    }
    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      color: white;
      flex-shrink: 0;
    }
    .logo-text {
      font-weight: 700;
      font-size: 16px;
      line-height: 1.2;
      color: var(--text);
      white-space: nowrap;
      overflow: visible;
      text-overflow: clip;
      flex: 1;
      min-width: 0;
    }
    .nav-menu {
      list-style: none;
      padding: 0 20px;
    }
    .nav-item { margin-bottom: 5px; }
    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      color: var(--text-light);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .nav-link:hover, .nav-link.active {
      background-color: var(--medium-gray);
      color: var(--text);
    }
    .nav-link.active {
      background: linear-gradient(90deg, rgba(67, 97, 238, 0.2), transparent);
      border-left: 3px solid var(--primary);
    }
    .nav-icon {
      width: 24px;
      text-align: center;
      margin-right: 10px;
      font-size: 14px;
    }
    .main-content {
      display: grid;
      grid-template-rows: 60px 1fr;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 25px;
      border-bottom: 1px solid var(--glass-border);
      background-color: var(--dark-gray);
    }
    .user-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    #logout-btn {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    #logout-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }
    .user-name {
      font-weight: 500;
      font-size: 14px;
    }
    .dashboard {
      padding: 25px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
    }
    .card {
      background-color: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 20px;
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: box-shadow 0.2s, transform 0.18s;
    }
    .card:hover {
      box-shadow: 0 8px 32px 0 rgba(76,201,240,0.13), 0 2px 8px 0 rgba(0,0,0,0.10);
      transform: translateY(-4px) scale(1.012);
    }
    .card-icon {
      font-size: 2.2rem;
      color: var(--primary-light);
      margin-bottom: 12px;
    }
    .card-title {
      font-weight: 700;
      font-size: 1.15rem;
      margin-bottom: 4px;
    }
    .card-count {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 14px;
    }
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover { background: var(--secondary); }
    .btn-secondary {
      background: var(--medium-gray);
      color: var(--text);
    }
    .btn-secondary:hover { background: var(--light-gray); }
    .btn-danger {
      background: var(--danger);
    }
    .btn-danger:hover { background: #d90429; }
    .btn-success {
      background: var(--success);
    }
    .btn-success:hover { background: #3a9d5f; }
    .modal {
      display: none;
      position: fixed;
      z-index: 3000;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: var(--dark-gray);
      padding: 36px 28px;
      border-radius: 18px;
      min-width: 340px;
      max-width: 95vw;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      background: none;
      border: none;
      font-size: 20px;
      color: var(--text-light);
      cursor: pointer;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 0.98rem;
      color: var(--text-light);
      margin-bottom: 4px;
    }
    .form-control {
      width: 100%;
      padding: 10px 12px;
      border-radius: 7px;
      border: none;
      background: var(--medium-gray);
      color: var(--text);
      font-size: 1rem;
      font-weight: 500;
    }
    .form-control:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--primary);
    }
    /* Login Styles */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
    }
    
    .login-card {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-header h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .login-header i {
      color: #667eea;
      margin-right: 10px;
    }
    
    .login-header p {
      color: #666;
      font-size: 16px;
    }
    
    .login-form {
      margin-bottom: 20px;
    }
    
    .login-form .form-group {
      margin-bottom: 20px;
    }
    
    .login-form .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }
    
    .login-form .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      background: white;
      color: #333;
    }
    
    .login-form .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 14px;
      color: #666;
    }
    
    .checkbox-label input {
      width: auto;
      margin-right: 8px;
    }
    
    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
    }
    
    .login-footer {
      text-align: center;
      border-top: 1px solid #e1e5e9;
      padding-top: 20px;
    }
    
    .login-footer p {
      margin: 8px 0;
      color: #666;
      font-size: 14px;
    }
    
    .login-footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }
    
    .login-footer a:hover {
      text-decoration: underline;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    .table th, .table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--glass-border);
    }
    .table th {
      background: var(--medium-gray);
      font-weight: 600;
    }
    .badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .badge-success { background: var(--success); color: white; }
    .badge-warning { background: var(--warning); color: white; }
    .badge-danger { background: var(--danger); color: white; }
    .badge-primary { background: var(--primary); color: white; }
.badge-info { background: var(--accent); color: white; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--medium-gray);
      border-radius: 4px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
    }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
    .flex { display: flex; }
    .flex-between { justify-content: space-between; }
    .flex-center { align-items: center; }
    .gap-10 { gap: 10px; }
    .gap-16 { gap: 16px; }
    .mb-16 { margin-bottom: 16px; }
    .mb-20 { margin-bottom: 20px; }
    .text-center { text-align: center; }
    .text-muted { color: var(--text-light); }
    .hidden { display: none; }
    @media (max-width: 900px) {
      .container { grid-template-columns: 0 1fr; }
      .sidebar { min-width: 0; max-width: 0; width: 0; padding: 0; border: none; }
      .sidebar * { opacity: 0; pointer-events: none; }
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
    }
    @media (max-width: 768px) {
      .container { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .dashboard { grid-template-columns: 1fr; }
      .modal-content { padding: 24px 20px; }
    }
    .notification-badge { background: var(--danger); color: #fff; border-radius: 50%; font-size: 0.8em; padding: 2px 7px; margin-left: 6px; vertical-align: middle; }
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    
    /* Assessment Styles */
    .tab-navigation {
      display: flex;
      border-bottom: 1px solid var(--glass-border);
      margin-bottom: 20px;
    }
    .tab-btn {
      background: none;
      border: none;
      padding: 12px 20px;
      color: var(--text-light);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s;
      font-weight: 500;
    }
    .tab-btn:hover {
      color: var(--text);
      background: var(--medium-gray);
    }
    .tab-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: var(--medium-gray);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .assessment-item {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.3s;
    }
    .assessment-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .assessment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .assessment-title {
      font-weight: 600;
      color: var(--text);
    }
    .assessment-meta {
      display: flex;
      gap: 16px;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    .assessment-actions {
      display: flex;
      gap: 8px;
    }
    .quiz-question {
      background: var(--medium-gray);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .quiz-options {
      display: grid;
      gap: 8px;
      margin-top: 12px;
    }
    .quiz-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--glass);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .quiz-option:hover {
      background: var(--light-gray);
    }
    .quiz-option.correct {
      background: var(--success);
      color: white;
    }
    .gradebook-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    .gradebook-table th,
    .gradebook-table td {
      padding: 12px 8px;
      text-align: center;
      border: 1px solid var(--glass-border);
    }
    .gradebook-table th {
      background: var(--medium-gray);
      font-weight: 600;
      position: sticky;
      top: 0;
    }
    .gradebook-table td:first-child {
      text-align: left;
      font-weight: 500;
      position: sticky;
      left: 0;
      background: var(--dark-gray);
    }
    .grade-input {
      width: 60px;
      padding: 4px 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      background: var(--medium-gray);
      color: var(--text);
      text-align: center;
    }
    .feedback-input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      background: var(--medium-gray);
      color: var(--text);
      resize: vertical;
      min-height: 60px;
    }
    .submission-item {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .submission-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .submission-student {
      font-weight: 600;
      color: var(--text);
    }
    .submission-time {
      font-size: 0.9rem;
      color: var(--text-light);
    }
    .submission-content {
      background: var(--medium-gray);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .submission-actions {
      display: flex;
      gap: 8px;
    }
    .rubric-item {
      background: var(--glass);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .rubric-criteria {
      font-weight: 500;
      margin-bottom: 8px;
    }
    .rubric-points {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .rubric-points input {
      width: 60px;
      padding: 4px 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      background: var(--medium-gray);
      color: var(--text);
      text-align: center;
    }
    .audio-feedback {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    .audio-feedback button {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .weightage-input {
      width: 80px;
      padding: 4px 8px;
      border: 1px solid var(--glass-border);
      border-radius: 4px;
      background: var(--medium-gray);
      color: var(--text);
      text-align: center;
    }
    
    /* ===== SECURITY & ADMIN CONTROLS STYLES ===== */
    
    .security-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-light);
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .status-indicator.active {
      background: var(--success);
    }
    
    .status-indicator.inactive {
      background: var(--danger);
    }
    
    .security-stat {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
    }
    
    .security-stat .stat-icon {
      font-size: 24px;
      color: var(--primary);
    }
    
    .security-stat .stat-number {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
    }
    
    .security-stat .stat-label {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .security-tabs {
      margin-top: 20px;
    }
    
    .tab-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--glass-border);
      padding-bottom: 10px;
    }
    
    .tab-btn {
      background: none;
      border: none;
      padding: 10px 16px;
      color: var(--text-light);
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .tab-btn:hover {
      background: var(--medium-gray);
      color: var(--text);
    }
    
    .tab-btn.active {
      background: var(--primary);
      color: white;
    }
    
    .tab-panel {
      display: none;
    }
    
    .tab-panel.active {
      display: block;
    }
    
    .security-section {
      margin-bottom: 30px;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .section-header h4 {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
    }
    
    .roles-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }
    
    .role-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 16px;
    }
    
    .role-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .role-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
    }
    
    .role-info h5 {
      margin: 0 0 4px 0;
      font-size: 16px;
    }
    
    .role-info p {
      margin: 0;
      font-size: 12px;
      color: var(--text-light);
    }
    
    .role-status {
      margin-left: auto;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .role-status.active {
      background: var(--success);
      color: white;
    }
    
    .role-permissions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .permission-tag {
      background: var(--medium-gray);
      color: var(--text);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
    }
    
    .user-management h5 {
      margin-bottom: 16px;
    }
    
    .user-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .user-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 6px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .user-name {
      font-weight: 500;
      font-size: 14px;
    }
    
    .user-email {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .user-role {
      font-size: 12px;
      color: var(--text-light);
      background: var(--medium-gray);
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .user-actions {
      display: flex;
      gap: 6px;
    }
    
    .privacy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }
    
    .privacy-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 16px;
    }
    
    .privacy-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      flex-wrap: nowrap;
    }
    
    .privacy-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 60px;
      height: 60px;
      border-radius: 12px;
      color: white;
      font-size: 20px;
      position: relative;
      margin-right: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      min-width: 60px;
      min-height: 60px;
    }
    
    .privacy-logo:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    
    .privacy-logo i {
      font-size: 24px;
      margin-bottom: 4px;
    }
    
    .privacy-logo .logo-text {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: white;
    }
    
    .gdpr-logo {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      border: 2px solid #4CAF50;
    }
    
    .ferpa-logo {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      border: 2px solid #2196F3;
    }
    
    .coppa-logo {
      background: linear-gradient(135deg, #FF9800, #F57C00);
      border: 2px solid #FF9800;
    }
    
    .privacy-header i {
      font-size: 20px;
      color: var(--primary);
    }
    
    .privacy-header h5 {
      margin: 0;
      font-size: 16px;
    }
    
    .privacy-status {
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 12px;
      text-align: center;
    }
    
    .privacy-status.active {
      background: var(--success);
      color: white;
    }
    
    .privacy-status.inactive {
      background: var(--danger);
      color: white;
    }
    
    .privacy-features {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .privacy-features li {
      padding: 4px 0;
      font-size: 12px;
      color: var(--text-light);
      position: relative;
      padding-left: 16px;
    }
    
    .privacy-features li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: var(--success);
      font-weight: bold;
    }
    
    .data-retention h5 {
      margin-bottom: 16px;
    }
    
    .retention-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .backup-overview {
      margin-bottom: 30px;
    }
    
    .backup-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
    }
    
    .backup-stat {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
    }
    
    .backup-stat .stat-icon {
      font-size: 20px;
      color: var(--primary);
    }
    
    .backup-schedule h5 {
      margin-bottom: 16px;
    }
    
    .schedule-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    
    .backup-history h5 {
      margin-bottom: 16px;
    }
    
    .backup-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .backup-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 6px;
    }
    
    .backup-info {
      display: flex;
      gap: 20px;
      font-size: 12px;
    }
    
    .backup-date {
      color: var(--text);
      font-weight: 500;
    }
    
    .backup-size {
      color: var(--text-light);
    }
    
    .backup-type {
      color: var(--primary);
      font-weight: 500;
    }
    
    .backup-actions {
      display: flex;
      gap: 6px;
    }
    
    .mobile-overview {
      margin-bottom: 30px;
    }
    
    .mobile-status {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
    }
    
    .mobile-status.active {
      border-color: var(--success);
    }
    
    .mobile-status.inactive {
      border-color: var(--danger);
    }
    
    .status-icon {
      font-size: 32px;
    }
    
    .mobile-status.active .status-icon {
      color: var(--success);
    }
    
    .mobile-status.inactive .status-icon {
      color: var(--danger);
    }
    
    .status-info h5 {
      margin: 0 0 4px 0;
    }
    
    .status-info p {
      margin: 0;
      color: var(--text-light);
    }
    
    .mobile-features h5 {
      margin-bottom: 16px;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }
    
    .feature-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }
    
    .feature-icon {
      font-size: 24px;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .feature-card h6 {
      margin: 0 0 8px 0;
      font-size: 14px;
    }
    
    .feature-card p {
      margin: 0 0 12px 0;
      font-size: 12px;
      color: var(--text-light);
    }
    
    .feature-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .feature-status.active {
      background: var(--success);
      color: white;
    }
    
    .feature-status.inactive {
      background: var(--danger);
      color: white;
    }
    
    .mobile-settings h5 {
      margin-bottom: 16px;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 30px;
    }
    
    .mobile-download h5 {
      margin-bottom: 16px;
    }
    
    .download-options {
      display: flex;
      gap: 16px;
    }
    
    .download-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .download-btn:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }
    
    .download-btn i {
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar Toggle Button -->
    <div id="sidebar-toggle">
      <button id="toggleSidebarBtn" class="btn btn-secondary">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-chalkboard-teacher"></i>
        </div>
        <div class="logo-text">EduSync Teacher</div>
      </div>
      <ul class="nav-menu">
        <li class="nav-item"><a class="nav-link active" data-section="dashboard"><i class="fas fa-tachometer-alt nav-icon"></i><span>Dashboard</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="courses"><i class="fas fa-book nav-icon"></i><span>Course Management</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="students"><i class="fas fa-users nav-icon"></i><span>Student Management</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="assignments"><i class="fas fa-tasks nav-icon"></i><span>Assignments</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="grades"><i class="fas fa-graduation-cap nav-icon"></i><span>Grades & Assessment</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="exams"><i class="fas fa-file-alt nav-icon"></i><span>Exams</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="communication"><i class="fas fa-comments nav-icon"></i><span>Communication</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="analytics"><i class="fas fa-chart-bar nav-icon"></i><span>Analytics</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="security"><i class="fas fa-shield-alt nav-icon"></i><span>Security & Admin</span></a></li>
        <li class="nav-item"><a class="nav-link" data-section="settings"><i class="fas fa-cog nav-icon"></i><span>Settings</span></a></li>
      </ul>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Bar -->
      <div class="top-bar">
        <div class="flex flex-center gap-16">
          <h2 id="page-title">Dashboard</h2>
        </div>
        <div class="user-controls">
          <button id="theme-toggle-btn" class="btn btn-secondary" title="Toggle light/dark mode">
            <i class="fas fa-moon"></i>
          </button>
          <div class="user-profile" id="teacher-profile">
            <div class="user-avatar" id="teacher-avatar">H</div>
            <div class="user-name" id="teacher-name">Harshwardhan</div>
          </div>
          <button id="logout-btn" class="btn btn-danger" title="Logout" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
      
      <!-- Content Area -->
      <div id="content-area" class="dashboard">
        <!-- Dashboard content will be loaded here -->
      </div>
    </main>
  </div>

  <!-- Modals -->
  <div id="profile-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('profile-modal')"><i class="fas fa-times"></i></button>
      <h2>Edit Profile</h2>
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="edit-fullname" class="form-control" placeholder="Harshwardhan">
      </div>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="edit-email" class="form-control" placeholder="teacher@edusync.edu">
      </div>
      <div class="form-group">
        <label>Role</label>
        <input type="text" id="edit-role" class="form-control" placeholder="Teacher">
      </div>
      <button class="btn" onclick="saveProfile()">Save Changes</button>
    </div>
  </div>

  <script>
    // Error handling for missing functions
    window.addEventListener('error', function(e) {
      console.warn('Resource failed to load:', e.target.src || e.target.href);
      // Don't break the page for resource loading errors
      e.preventDefault();
    });

    // ===== LOCALSTORAGE DATA MANAGEMENT SYSTEM =====
    
    // Global state with localStorage integration
    let currentSection = 'dashboard';
    
    // Data storage keys
    const STORAGE_KEYS = {
      COURSES: 'courses',
      STUDENTS: 'students', 
      ASSIGNMENTS: 'assignments',
      ANNOUNCEMENTS: 'announcements',
      DISCUSSIONS: 'discussions',
      MESSAGES: 'messages',
      GRADEBOOK: 'gradebook',
      SETTINGS: 'settings',
      TEACHER_PROFILE: 'teacherProfile',
      NOTIFICATIONS: 'notifications',
      ATTENDANCE: 'attendance',
      SUBMISSIONS: 'submissions',
      REPORTS: 'reports',
      BACKUP: 'backup',
      // Authentication keys
      TEACHERS: 'teachers',
      IS_LOGGED_IN: 'isLoggedIn',
      CURRENT_TEACHER: 'currentTeacher',
      REMEMBER_ME: 'rememberMe',
      // Theme key
      CURRENT_THEME: 'currentTheme',
      // Security & Admin keys
      USER_ROLES: 'userRoles',
      PERMISSIONS: 'permissions',
      PRIVACY_SETTINGS: 'privacySettings',
      BACKUP_HISTORY: 'backupHistory',
      MOBILE_SETTINGS: 'mobileSettings'
    };
    
    // Data management functions
    function getData(key) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : null;
      } catch (error) {
        console.error(`Error reading data from localStorage (${key}):`, error);
        return null;
      }
    }
    
    function setData(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
        return true;
      } catch (error) {
        console.error(`Error writing data to localStorage (${key}):`, error);
        showNotification(`Failed to save data: ${error.message}`, 'error');
        return false;
      }
    }
    
    function removeData(key) {
      try {
        localStorage.removeItem(key);
        return true;
      } catch (error) {
        console.error(`Error removing data from localStorage (${key}):`, error);
        return false;
      }
    }
    
    function clearAllData() {
      try {
        Object.values(STORAGE_KEYS).forEach(key => {
          localStorage.removeItem(key);
        });
        showNotification('All data cleared successfully!', 'success');
        setTimeout(() => location.reload(), 1000);
        return true;
      } catch (error) {
        console.error('Error clearing all data:', error);
        showNotification('Failed to clear data', 'error');
        return false;
      }
    }
    
    function resetAllData() {
      if (confirm('This will clear all data and reinitialize with sample data. Are you sure?')) {
        try {
          // Clear all existing data
          Object.values(STORAGE_KEYS).forEach(key => {
            localStorage.removeItem(key);
          });
          
          // Reinitialize all sample data
          initializeAllSampleData();
          
          showNotification('Data reset successfully! All sample data has been reinitialized.', 'success');
          
          // Reload the current section
          if (currentSection) {
            navigateToSection(currentSection);
          } else {
            loadDashboard();
          }
          
          return true;
        } catch (error) {
          console.error('Error resetting data:', error);
          showNotification('Failed to reset data', 'error');
          return false;
        }
      }
      return false;
    }
    
    function initializeAllSampleData() {
      // Initialize demo teacher account
      const demoTeacher = {
        id: 1,
        name: 'Harshwardhan',
        email: 'harshwardhan06@gmail.com',
        password: 'harshdemo123',
        subject: 'Mathematics',
        createdAt: new Date().toISOString(),
        profile: {
          bio: 'Experienced mathematics teacher with 10+ years of teaching experience.',
          phone: '+1-555-0123',
          department: 'Mathematics',
          office: 'Room 201',
          officeHours: 'Mon/Wed 2-4 PM, or by appointment',
          profilePicture: null
        }
      };
      setData(STORAGE_KEYS.TEACHERS, [demoTeacher]);
      
      // Initialize sample students
      const sampleStudents = [
        // Students from MATH301 (Advanced Mathematics)
        { id: 1, name: 'Sarah Johnson', email: 'sarah.johnson@university.edu', phone: '+1-555-0101', dob: '2000-03-15', status: 'active', attendance: 95, progress: 87, enrollmentDate: '2024-01-10' },
        { id: 2, name: 'Michael Chen', email: 'michael.chen@university.edu', phone: '+1-555-0102', dob: '1999-07-22', status: 'active', attendance: 88, progress: 92, enrollmentDate: '2024-01-12' },
        { id: 3, name: 'Emily Rodriguez', email: 'emily.rodriguez@university.edu', phone: '+1-555-0103', dob: '2001-11-08', status: 'active', attendance: 92, progress: 78, enrollmentDate: '2024-01-08' },
        { id: 4, name: 'David Kim', email: 'david.kim@university.edu', phone: '+1-555-0104', dob: '2000-05-30', status: 'active', attendance: 85, progress: 85, enrollmentDate: '2024-01-15' },
        { id: 5, name: 'Lisa Thompson', email: 'lisa.thompson@university.edu', phone: '+1-555-0105', dob: '1999-12-14', status: 'active', attendance: 90, progress: 91, enrollmentDate: '2024-01-11' },
        { id: 6, name: 'Robert Zhang', email: 'robert.zhang@university.edu', phone: '+1-555-0106', dob: '2000-09-03', status: 'active', attendance: 87, progress: 83, enrollmentDate: '2024-01-13' },
        { id: 7, name: 'Jennifer Davis', email: 'jennifer.davis@university.edu', phone: '+1-555-0107', dob: '2001-01-25', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-01-14' },
        { id: 8, name: 'Christopher Lee', email: 'christopher.lee@university.edu', phone: '+1-555-0108', dob: '1999-08-17', status: 'active', attendance: 89, progress: 76, enrollmentDate: '2024-01-16' },
        { id: 9, name: 'Amanda Wilson', email: 'amanda.wilson@university.edu', phone: '+1-555-0109', dob: '2000-04-12', status: 'active', attendance: 91, progress: 94, enrollmentDate: '2024-01-17' },
        { id: 10, name: 'Kevin Patel', email: 'kevin.patel@university.edu', phone: '+1-555-0110', dob: '2001-06-28', status: 'active', attendance: 86, progress: 81, enrollmentDate: '2024-01-18' },
        
        // Students from CS101 (Computer Science)
        { id: 11, name: 'Alex Martinez', email: 'alex.martinez@university.edu', phone: '+1-555-0111', dob: '2000-02-09', status: 'active', attendance: 94, progress: 88, enrollmentDate: '2024-01-18' },
        { id: 12, name: 'Jessica Wang', email: 'jessica.wang@university.edu', phone: '+1-555-0112', dob: '1999-10-31', status: 'active', attendance: 90, progress: 85, enrollmentDate: '2024-01-19' },
        { id: 13, name: 'Ryan O\'Connor', email: 'ryan.oconnor@university.edu', phone: '+1-555-0113', dob: '2001-03-07', status: 'active', attendance: 88, progress: 79, enrollmentDate: '2024-01-20' },
        { id: 14, name: 'Maria Garcia', email: 'maria.garcia@university.edu', phone: '+1-555-0114', dob: '2000-07-19', status: 'active', attendance: 92, progress: 87, enrollmentDate: '2024-01-21' },
        { id: 15, name: 'James Wilson', email: 'james.wilson@university.edu', phone: '+1-555-0115', dob: '1999-12-05', status: 'active', attendance: 85, progress: 82, enrollmentDate: '2024-01-22' },
        { id: 16, name: 'Amanda Lee', email: 'amanda.lee@university.edu', phone: '+1-555-0116', dob: '2000-08-14', status: 'active', attendance: 89, progress: 84, enrollmentDate: '2024-01-23' },
        { id: 17, name: 'Brian Taylor', email: 'brian.taylor@university.edu', phone: '+1-555-0117', dob: '2001-04-22', status: 'active', attendance: 91, progress: 86, enrollmentDate: '2024-01-24' },
        { id: 18, name: 'Nicole Anderson', email: 'nicole.anderson@university.edu', phone: '+1-555-0118', dob: '1999-11-30', status: 'active', attendance: 87, progress: 80, enrollmentDate: '2024-01-25' },
        { id: 19, name: 'Steven Brown', email: 'steven.brown@university.edu', phone: '+1-555-0119', dob: '2000-06-18', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-01-26' },
        { id: 20, name: 'Rachel Green', email: 'rachel.green@university.edu', phone: '+1-555-0120', dob: '2001-01-12', status: 'active', attendance: 88, progress: 83, enrollmentDate: '2024-01-27' },
        
        // Students from LIT201 (World Literature)
        { id: 21, name: 'Sophie Anderson', email: 'sophie.anderson@university.edu', phone: '+1-555-0121', dob: '2000-09-25', status: 'active', attendance: 92, progress: 88, enrollmentDate: '2024-01-28' },
        { id: 22, name: 'Daniel Brown', email: 'daniel.brown@university.edu', phone: '+1-555-0122', dob: '1999-12-08', status: 'active', attendance: 86, progress: 81, enrollmentDate: '2024-01-29' },
        { id: 23, name: 'Thomas White', email: 'thomas.white@university.edu', phone: '+1-555-0123', dob: '2001-02-14', status: 'active', attendance: 90, progress: 85, enrollmentDate: '2024-01-30' },
        { id: 24, name: 'Emma Davis', email: 'emma.davis@university.edu', phone: '+1-555-0124', dob: '2000-05-03', status: 'active', attendance: 94, progress: 90, enrollmentDate: '2024-01-31' },
        { id: 25, name: 'Matthew Johnson', email: 'matthew.johnson@university.edu', phone: '+1-555-0125', dob: '1999-07-19', status: 'active', attendance: 89, progress: 84, enrollmentDate: '2024-02-01' },
        { id: 26, name: 'Olivia Smith', email: 'olivia.smith@university.edu', phone: '+1-555-0126', dob: '2001-03-11', status: 'active', attendance: 91, progress: 87, enrollmentDate: '2024-02-02' },
        { id: 27, name: 'William Taylor', email: 'william.taylor@university.edu', phone: '+1-555-0127', dob: '2000-10-28', status: 'active', attendance: 87, progress: 82, enrollmentDate: '2024-02-03' },
        { id: 28, name: 'Isabella Martinez', email: 'isabella.martinez@university.edu', phone: '+1-555-0128', dob: '1999-08-07', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-02-04' },
        { id: 29, name: 'Ethan Wilson', email: 'ethan.wilson@university.edu', phone: '+1-555-0129', dob: '2001-01-23', status: 'active', attendance: 88, progress: 83, enrollmentDate: '2024-02-05' },
        { id: 30, name: 'Ava Foster', email: 'ava.foster@university.edu', phone: '+1-555-0130', dob: '2000-04-16', status: 'active', attendance: 90, progress: 86, enrollmentDate: '2024-02-06' }
      ];
      setData(STORAGE_KEYS.STUDENTS, sampleStudents);
      
      // Initialize sample courses (this will be called from the existing initialization)
      if (typeof initializeSampleCourses === 'function') {
        initializeSampleCourses();
      }
      
      // Initialize other sample data
      if (typeof initializeSampleAssignments === 'function') {
        initializeSampleAssignments();
      }
      
      if (typeof initializeSampleAnnouncements === 'function') {
        initializeSampleAnnouncements();
      }
      
      if (typeof initializeSampleDiscussions === 'function') {
        initializeSampleDiscussions();
      }
      
      if (typeof initializeSampleMessages === 'function') {
        initializeSampleMessages();
      }
      
      if (typeof initializeSecurityData === 'function') {
        initializeSecurityData();
      }
    }
    
    function backupData() {
      try {
        const backup = {};
        Object.values(STORAGE_KEYS).forEach(key => {
          const data = localStorage.getItem(key);
          if (data) {
            backup[key] = data;
          }
        });
        
        const backupData = {
          timestamp: new Date().toISOString(),
          version: '1.0',
          data: backup
        };
        
        setData(STORAGE_KEYS.BACKUP, backupData);
        
        // Create downloadable backup file
        const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `teacher-portal-backup-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        showNotification('Backup created and downloaded successfully!', 'success');
        return true;
      } catch (error) {
        console.error('Error creating backup:', error);
        showNotification('Failed to create backup', 'error');
        return false;
      }
    }
    
    function restoreData(backupData) {
      try {
        if (!backupData || !backupData.data) {
          throw new Error('Invalid backup data');
        }
        
        // Clear existing data
        Object.values(STORAGE_KEYS).forEach(key => {
          localStorage.removeItem(key);
        });
        
        // Restore backup data
        Object.entries(backupData.data).forEach(([key, value]) => {
          localStorage.setItem(key, value);
        });
        
        showNotification('Data restored successfully!', 'success');
        setTimeout(() => location.reload(), 1000);
        return true;
      } catch (error) {
        console.error('Error restoring data:', error);
        showNotification('Failed to restore data', 'error');
        return false;
      }
    }
    
    function getStorageInfo() {
      try {
        const info = {
          totalSize: 0,
          items: {},
          available: 0
        };
        
        Object.values(STORAGE_KEYS).forEach(key => {
          const data = localStorage.getItem(key);
          if (data) {
            const size = new Blob([data]).size;
            info.items[key] = {
              size: size,
              sizeFormatted: formatBytes(size),
              exists: true
            };
            info.totalSize += size;
          } else {
            info.items[key] = {
              size: 0,
              sizeFormatted: '0 B',
              exists: false
            };
          }
        });
        
        info.totalSizeFormatted = formatBytes(info.totalSize);
        
        // Estimate available space (localStorage typically has 5-10MB limit)
        const testKey = 'storage-test';
        let testData = '';
        try {
          while (true) {
            testData += 'x'.repeat(1000);
            localStorage.setItem(testKey, testData);
          }
        } catch (e) {
          info.available = testData.length;
          info.availableFormatted = formatBytes(testData.length);
          localStorage.removeItem(testKey);
        }
        
        return info;
      } catch (error) {
        console.error('Error getting storage info:', error);
        return null;
      }
    }
    
    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function cleanupData() {
      try {
        let cleaned = 0;
        
        // Clean up old notifications (keep only last 30 days)
        const notifications = getData(STORAGE_KEYS.NOTIFICATIONS) || [];
        const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
        const filteredNotifications = notifications.filter(n => new Date(n.date) > thirtyDaysAgo);
        
        if (notifications.length !== filteredNotifications.length) {
          setData(STORAGE_KEYS.NOTIFICATIONS, filteredNotifications);
          cleaned += notifications.length - filteredNotifications.length;
        }
        
        // Clean up old reports (keep only last 90 days)
        const reports = getData(STORAGE_KEYS.REPORTS) || [];
        const ninetyDaysAgo = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000);
        const filteredReports = reports.filter(r => new Date(r.createdAt) > ninetyDaysAgo);
        
        if (reports.length !== filteredReports.length) {
          setData(STORAGE_KEYS.REPORTS, filteredReports);
          cleaned += reports.length - filteredReports.length;
        }
        
        showNotification(`Cleanup completed! Removed ${cleaned} old items.`, 'success');
        return true;
      } catch (error) {
        console.error('Error during cleanup:', error);
        showNotification('Failed to cleanup data', 'error');
        return false;
      }
    }
    
    function optimizeStorage() {
      try {
        // Remove empty or null values
        Object.values(STORAGE_KEYS).forEach(key => {
          const data = localStorage.getItem(key);
          if (data === 'null' || data === 'undefined' || data === '""') {
            localStorage.removeItem(key);
          }
        });
        
        // Compress data by removing unnecessary whitespace
        Object.values(STORAGE_KEYS).forEach(key => {
          const data = localStorage.getItem(key);
          if (data) {
            try {
              const parsed = JSON.parse(data);
              const compressed = JSON.stringify(parsed);
              if (compressed.length < data.length) {
                localStorage.setItem(key, compressed);
              }
            } catch (e) {
              // Skip if not valid JSON
            }
          }
        });
        
        showNotification('Storage optimized successfully!', 'success');
        return true;
      } catch (error) {
        console.error('Error optimizing storage:', error);
        showNotification('Failed to optimize storage', 'error');
        return false;
      }
    }
    
    // Initialize data from localStorage
    let courses = getData(STORAGE_KEYS.COURSES) || [];
    let students = getData(STORAGE_KEYS.STUDENTS) || [];
    let assignments = getData(STORAGE_KEYS.ASSIGNMENTS) || [];
    let announcements = getData(STORAGE_KEYS.ANNOUNCEMENTS) || [];

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
      // Clear any existing login state for testing (remove this in production)
      setData(STORAGE_KEYS.IS_LOGGED_IN, false);
      setData(STORAGE_KEYS.CURRENT_TEACHER, null);
      
      // Hide main portal initially
      const mainContainer = document.querySelector('.container');
      if (mainContainer) {
        mainContainer.style.display = 'none';
      }
      
      checkLoginStatus();
    });

    // ===== AUTHENTICATION SYSTEM =====
    
    // Check login status on app load
    function checkLoginStatus() {
      const isLoggedIn = getData(STORAGE_KEYS.IS_LOGGED_IN) || false;
      const currentTeacher = getData(STORAGE_KEYS.CURRENT_TEACHER) || {};
      
      if (!isLoggedIn || !currentTeacher.email) {
        showLoginScreen();
      } else {
        showMainPortal();
      }
    }
    
    // Show login screen
    function showLoginScreen() {
      // Hide main portal
      const mainContainer = document.querySelector('.container');
      if (mainContainer) {
        mainContainer.style.display = 'none';
      }
      
      // Create login container if it doesn't exist
      let loginContainer = document.querySelector('.login-container');
      if (!loginContainer) {
        loginContainer = document.createElement('div');
        loginContainer.className = 'login-container';
        loginContainer.innerHTML = `
          <div class="login-card">
            <div class="login-header">
              <h1><i class="fas fa-chalkboard-teacher"></i> Teacher Portal</h1>
              <p>Sign in to access your teaching dashboard</p>
            </div>
            
            <form id="login-form" class="login-form">
              <div class="form-group">
                <label for="login-email">Email Address</label>
                <input type="email" id="login-email" required placeholder="Enter your email">
              </div>
              
              <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" required placeholder="Enter your password">
              </div>
              
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="remember-me">
                  <span class="checkmark"></span>
                  Remember me
                </label>
              </div>
              
              <button type="submit" class="login-btn">
                <i class="fas fa-sign-in-alt"></i> Sign In
              </button>
            </form>
            
            <div class="login-footer">
              <p>Don't have an account? <a href="#" onclick="showRegisterScreen()">Register here</a></p>
              <p><a href="#" onclick="showForgotPassword()">Forgot password?</a></p>
            </div>
          </div>
        `;
        document.body.appendChild(loginContainer);
      }
      
      // Show login container
      loginContainer.style.display = 'flex';
      
      // Add login form event listener
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        // Remove existing listener to prevent duplicates
        loginForm.removeEventListener('submit', handleLogin);
        loginForm.addEventListener('submit', handleLogin);
        console.log('Login form event listener attached');
      } else {
        console.error('Login form not found!');
      }
    }
    
    // Show registration screen
    function showRegisterScreen() {
      document.body.innerHTML = `
        <div class="login-container">
          <div class="login-card">
            <div class="login-header">
              <h1><i class="fas fa-user-plus"></i> Create Account</h1>
              <p>Register for your teacher portal account</p>
            </div>
            
            <form id="register-form" class="login-form">
              <div class="form-group">
                <label for="register-name">Full Name</label>
                <input type="text" id="register-name" required placeholder="Enter your full name">
              </div>
              
              <div class="form-group">
                <label for="register-email">Email Address</label>
                <input type="email" id="register-email" required placeholder="Enter your email">
              </div>
              
              <div class="form-group">
                <label for="register-password">Password</label>
                <input type="password" id="register-password" required placeholder="Create a password">
              </div>
              
              <div class="form-group">
                <label for="register-confirm-password">Confirm Password</label>
                <input type="password" id="register-confirm-password" required placeholder="Confirm your password">
              </div>
              
              <div class="form-group">
                <label for="register-subject">Subject/Department</label>
                <input type="text" id="register-subject" required placeholder="e.g., Mathematics, Science">
              </div>
              
              <button type="submit" class="login-btn">
                <i class="fas fa-user-plus"></i> Create Account
              </button>
            </form>
            
            <div class="login-footer">
              <p>Already have an account? <a href="#" onclick="showLoginScreen()">Sign in here</a></p>
            </div>
          </div>
        </div>
      `;
      
      // Add register form event listener
      document.getElementById('register-form').addEventListener('submit', handleRegister);
    }
    
    // Handle login
    function handleLogin(e) {
      e.preventDefault();
      
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const rememberMe = document.getElementById('remember-me').checked;
      
      console.log('Login attempt:', { email, password, rememberMe });
      
      // Get stored teacher data
      const teachers = getData(STORAGE_KEYS.TEACHERS) || [];
      console.log('Available teachers:', teachers);
      
      const teacher = teachers.find(t => t.email === email && t.password === password);
      console.log('Found teacher:', teacher);
      
      if (teacher) {
        // Login successful
        setData(STORAGE_KEYS.IS_LOGGED_IN, true);
        setData(STORAGE_KEYS.CURRENT_TEACHER, teacher);
        
        if (rememberMe) {
          setData(STORAGE_KEYS.REMEMBER_ME, true);
        }
        
        console.log('Login successful, showing main portal...');
        showMainPortal();
        showNotification('Welcome back, ' + teacher.name + '!', 'success');
      } else {
        console.log('Login failed: Invalid credentials');
        showNotification('Invalid email or password. Please try again.', 'error');
      }
    }
    
    // Handle registration
    function handleRegister(e) {
      e.preventDefault();
      
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;
      const subject = document.getElementById('register-subject').value;
      
      if (password !== confirmPassword) {
        showNotification('Passwords do not match!', 'error');
        return;
      }
      
      if (password.length < 6) {
        showNotification('Password must be at least 6 characters long!', 'error');
        return;
      }
      
      // Get existing teachers
      const teachers = getData(STORAGE_KEYS.TEACHERS) || [];
      
      // Check if email already exists
      if (teachers.find(t => t.email === email)) {
        showNotification('Email already registered! Please use a different email.', 'error');
        return;
      }
      
      // Create new teacher account
      const newTeacher = {
        id: teachers.length + 1,
        name: name,
        email: email,
        password: password,
        subject: subject,
        createdAt: new Date().toISOString(),
        profile: {
          bio: '',
          phone: '',
          department: subject,
          office: '',
          officeHours: '',
          profilePicture: null
        }
      };
      
      teachers.push(newTeacher);
      setData(STORAGE_KEYS.TEACHERS, teachers);
      
      // Auto-login after registration
      setData(STORAGE_KEYS.IS_LOGGED_IN, true);
      setData(STORAGE_KEYS.CURRENT_TEACHER, newTeacher);
      
      showMainPortal();
      loadProfile();
      loadDashboard();
      applySavedSettings();
      showNotification('Account created successfully! Welcome to Teacher Portal!', 'success');
    }
    
    // Show forgot password screen
    function showForgotPassword() {
      document.body.innerHTML = `
        <div class="login-container">
          <div class="login-card">
            <div class="login-header">
              <h1><i class="fas fa-key"></i> Reset Password</h1>
              <p>Enter your email to reset your password</p>
            </div>
            
            <form id="forgot-password-form" class="login-form">
              <div class="form-group">
                <label for="reset-email">Email Address</label>
                <input type="email" id="reset-email" required placeholder="Enter your email">
              </div>
              
              <button type="submit" class="login-btn">
                <i class="fas fa-paper-plane"></i> Send Reset Link
              </button>
            </form>
            
            <div class="login-footer">
              <p><a href="#" onclick="showLoginScreen()">Back to login</a></p>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('forgot-password-form').addEventListener('submit', handleForgotPassword);
    }
    
    // Handle forgot password
    function handleForgotPassword(e) {
      e.preventDefault();
      
      const email = document.getElementById('reset-email').value;
      const teachers = getData(STORAGE_KEYS.TEACHERS) || [];
      
      if (teachers.find(t => t.email === email)) {
        showNotification('Password reset link sent to your email! (Demo: Check console for new password)', 'success');
        console.log('Demo: New password would be sent to', email);
      } else {
        showNotification('Email not found in our records!', 'error');
      }
    }
    
    // Show main portal after login
    function showMainPortal() {
      // Hide login screen
      const loginContainer = document.querySelector('.login-container');
      if (loginContainer) {
        loginContainer.style.display = 'none';
      }
      
      // Show the main portal content
      const mainContainer = document.querySelector('.container');
      if (mainContainer) {
        mainContainer.style.display = 'grid';
      }
      
      // Initialize the portal
      loadProfile();
      loadDashboard();
      applySavedSettings();
      setupEventListeners();
    }
    
    // Logout function
    function logout() {
      setData(STORAGE_KEYS.IS_LOGGED_IN, false);
      setData(STORAGE_KEYS.CURRENT_TEACHER, null);
      setData(STORAGE_KEYS.REMEMBER_ME, false);
      
      // Hide main portal
      const mainContainer = document.querySelector('.container');
      if (mainContainer) {
        mainContainer.style.display = 'none';
      }
      
      showLoginScreen();
      showNotification('Logged out successfully!', 'success');
    }
    
    // Event Listeners
    function setupEventListeners() {
      // Theme toggle
      document.getElementById('theme-toggle-btn').addEventListener('click', toggleTheme);
      
      // Profile modal
      document.getElementById('teacher-profile').addEventListener('click', () => openModal('profile-modal'));
      
      // Sidebar toggle
      document.getElementById('toggleSidebarBtn').addEventListener('click', toggleSidebar);
      
      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const section = this.getAttribute('data-section');
          navigateToSection(section);
        });
      });
    }

    // Navigation
    function navigateToSection(section) {
      currentSection = section;
      // Update active nav link
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.querySelector(`[data-section="${section}"]`).classList.add('active');
      // Update page title
      const titles = {
        dashboard: 'Dashboard',
        courses: 'Course Management & Content Creation',
        students: 'Student & Class Management',
        assignments: 'Assessment & Grading Tools',
        grades: 'Grades & Gradebook',
        exams: 'Exams & MCQ Tests',
        communication: 'Communication & Collaboration',
        analytics: 'Analytics & Reporting',
        settings: 'Integration, Security & More',
        security: 'Security & Admin Controls'
      };
      document.getElementById('page-title').textContent = titles[section];
      // Load section content
      switch(section) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'courses':
          renderCourseManagement();
          break;
        case 'students':
          renderStudentManagement();
          break;
        case 'assignments':
          renderAssessmentTools();
          break;
        case 'grades':
          loadGrades();
          break;
        case 'exams':
          loadExams();
          break;
        case 'communication':
          renderCommunication();
          break;
        case 'analytics':
          renderAnalytics();
          break;
        case 'settings':
          renderSettings();
          break;
        case 'security':
          renderSecurityAdmin();
          break;
      }
    }

    // Enhanced Dashboard
    function loadDashboard() {
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      
      // Calculate dashboard metrics
      const totalStudents = students.length;
      const totalCourses = courses.length;
      const totalAssignments = assignments.length;
      
      // Calculate pending submissions
      let pendingSubmissions = 0;
      let gradedAssignments = 0;
      assignments.forEach(a => {
        if (a.submissions) {
          pendingSubmissions += a.submissions.filter(s => s.status === 'pending').length;
          gradedAssignments += a.submissions.filter(s => s.status === 'graded').length;
        }
      });
      
      // Calculate average grades
      let totalGrades = 0;
      let gradeCount = 0;
      assignments.forEach(a => {
        if (a.grades) {
          Object.values(a.grades).forEach(grade => {
            if (grade) {
              totalGrades += grade;
              gradeCount++;
            }
          });
        }
      });
      const averageGrade = gradeCount > 0 ? Math.round(totalGrades / gradeCount) : 0;
      
      // Get recent announcements
      const now = new Date();
      const recentAnnouncements = announcements
        .filter(a => !a.expiry || new Date(a.expiry) > now)
        .slice(-3)
        .reverse();
      
      // Get upcoming assignments (due in next 7 days)
      const upcomingAssignments = assignments
        .filter(a => {
          const dueDate = new Date(a.dueDate);
          const weekFromNow = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
          return dueDate > now && dueDate <= weekFromNow;
        })
        .slice(0, 5);
      
      // Get top performing courses
      const coursePerformance = courses.map(course => {
        const courseStudents = students.filter(s => s.courses && s.courses.includes(course.id));
        const avgProgress = courseStudents.length > 0 ? 
          Math.round(courseStudents.reduce((sum, s) => sum + (s.progress || 0), 0) / courseStudents.length) : 0;
        return { ...course, avgProgress, studentCount: courseStudents.length };
      }).sort((a, b) => b.avgProgress - a.avgProgress).slice(0, 3);
      
      const content = `
        <style>
          .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
          }
          
          .dashboard-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            color: white;
            position: relative;
            overflow: hidden;
          }
          
          .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
          }
          
          @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
          }
          
          .dashboard-header-content {
            position: relative;
            z-index: 2;
          }
          
          .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
          }
          
          .dashboard-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 24px;
          }
          
          .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
          }
          
          .stat-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          }
          
          .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
          }
          
          .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
          }
          
          .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin: 0 auto 16px;
            color: white;
          }
          
          .stat-card.primary .stat-icon { background: linear-gradient(135deg, #4361ee, #3f37c9); }
          .stat-card.secondary .stat-icon { background: linear-gradient(135deg, #4895ef, #4cc9f0); }
          .stat-card.warning .stat-icon { background: linear-gradient(135deg, #f7b801, #f72585); }
          .stat-card.success .stat-icon { background: linear-gradient(135deg, #4ad66d, #06ffa5); }
          
          .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
          }
          
          .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
          }
          
          .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
          }
          
          .dashboard-main {
            display: flex;
            flex-direction: column;
            gap: 24px;
          }
          
          .dashboard-sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
          }
          
          .dashboard-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
          }
          
          .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
          }
          
          .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
          }
          
          .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text);
          }
          
          .card-title i {
            font-size: 1.3rem;
            color: var(--primary);
          }
          
          .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
          }
          
          .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 20px 16px;
            background: var(--medium-gray);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.3s ease;
            text-align: center;
          }
          
          .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.3);
          }
          
          .quick-action-btn i {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
          }
          
          .quick-action-btn span {
            font-size: 0.85rem;
            font-weight: 500;
            line-height: 1.3;
          }
          
          .announcement-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--medium-gray);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
          }
          
          .announcement-item:hover {
            background: var(--light-gray);
            transform: translateX(4px);
          }
          
          .announcement-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
          }
          
          .announcement-content {
            flex: 1;
          }
          
          .announcement-title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
          }
          
          .announcement-date {
            font-size: 0.85rem;
            color: var(--text-light);
          }
          
          .deadline-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--medium-gray);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
          }
          
          .deadline-item:hover {
            background: var(--light-gray);
            transform: translateX(4px);
          }
          
          .deadline-info {
            flex: 1;
          }
          
          .deadline-title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
          }
          
          .deadline-course {
            font-size: 0.85rem;
            color: var(--text-light);
          }
          
          .deadline-date {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
          }
          
          .performance-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--medium-gray);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
          }
          
          .performance-item:hover {
            background: var(--light-gray);
            transform: translateX(4px);
          }
          
          .performance-info {
            flex: 1;
          }
          
          .course-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
          }
          
          .course-students {
            font-size: 0.85rem;
            color: var(--text-light);
          }
          
          .performance-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 120px;
          }
          
          .progress-bar {
            flex: 1;
            height: 8px;
            background: var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
          }
          
          .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
          }
          
          .progress-text {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
            min-width: 35px;
          }
          
          .view-all-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
          }
          
          .view-all-btn:hover {
            background: var(--primary);
            color: white;
          }
          
          @media (max-width: 1200px) {
            .dashboard-grid {
              grid-template-columns: 1fr;
            }
          }
          
          @media (max-width: 768px) {
            .dashboard-stats {
              grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions-grid {
              grid-template-columns: repeat(2, 1fr);
            }
          }
          
          @media (max-width: 480px) {
            .dashboard-stats {
              grid-template-columns: 1fr;
            }
            
            .quick-actions-grid {
              grid-template-columns: 1fr;
            }
          }
        </style>
        
        <div class="dashboard-container">
          <!-- Dashboard Header -->
          <div class="dashboard-header">
            <div class="dashboard-header-content">
              <h1 class="dashboard-title">Welcome back, Teacher!</h1>
              <p class="dashboard-subtitle">Here's what's happening in your classroom today</p>
              <div class="dashboard-stats">
                <div class="stat-card primary">
                  <div class="stat-icon"><i class="fas fa-users"></i></div>
                  <div class="stat-number">${totalStudents}</div>
                  <div class="stat-label">Total Students</div>
                </div>
                
                <div class="stat-card secondary">
                  <div class="stat-icon"><i class="fas fa-book"></i></div>
                  <div class="stat-number">${totalCourses}</div>
                  <div class="stat-label">Active Courses</div>
                </div>
                
                <div class="stat-card warning">
                  <div class="stat-icon"><i class="fas fa-clock"></i></div>
                  <div class="stat-number">${pendingSubmissions}</div>
                  <div class="stat-label">Pending Grades</div>
                </div>
                
                <div class="stat-card success">
                  <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                  <div class="stat-number">${averageGrade}%</div>
                  <div class="stat-label">Average Grade</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Main Dashboard Content -->
          <div class="dashboard-grid">
            <!-- Left Column - Main Content -->
            <div class="dashboard-main">
              <!-- Quick Actions -->
              <div class="dashboard-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-bolt"></i>
                    Quick Actions
                  </h2>
                </div>
                <div class="quick-actions-grid">
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('assignments')">
                    <i class="fas fa-plus"></i>
                    <span>Create Assignment</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('communication')">
                    <i class="fas fa-bullhorn"></i>
                    <span>Send Announcement</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('grades')">
                    <i class="fas fa-chart-bar"></i>
                    <span>View Gradebook</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('analytics')">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics Report</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('students')">
                    <i class="fas fa-user-plus"></i>
                    <span>Add Student</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('courses')">
                    <i class="fas fa-book-open"></i>
                    <span>Manage Courses</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('exams')">
                    <i class="fas fa-file-alt"></i>
                    <span>Create Exam</span>
                  </a>
                  <a href="#" class="quick-action-btn" onclick="navigateToSection('courses')">
                    <i class="fas fa-book"></i>
                    <span>Create Course</span>
                  </a>
                </div>
              </div>

              <!-- Upcoming Deadlines -->
              <div class="dashboard-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-calendar-alt"></i>
                    Upcoming Deadlines
                  </h2>
                  <button class="view-all-btn" onclick="navigateToSection('assignments')">View All</button>
                </div>
                <div class="deadlines-list">
                  ${upcomingAssignments.length > 0 ? 
                    upcomingAssignments.map(assignment => `
                      <div class="deadline-item">
                        <div class="deadline-info">
                          <div class="deadline-title">${assignment.title}</div>
                          <div class="deadline-course">${assignment.course || 'General'}</div>
                        </div>
                        <div class="deadline-date">${new Date(assignment.dueDate).toLocaleDateString()}</div>
                      </div>
                    `).join('') : 
                    '<div class="text-muted text-center py-8">No upcoming deadlines</div>'
                  }
                </div>
              </div>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="dashboard-sidebar">
              <!-- Recent Announcements -->
              <div class="dashboard-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-bell"></i>
                    Recent Announcements
                  </h2>
                  <button class="view-all-btn" onclick="navigateToSection('communication')">View All</button>
                </div>
                <div class="announcements-list">
                  ${recentAnnouncements.length > 0 ? 
                    recentAnnouncements.map(ann => `
                      <div class="announcement-item">
                        <div class="announcement-icon">
                          <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="announcement-content">
                          <div class="announcement-title">${ann.title}</div>
                          <div class="announcement-date">${new Date(ann.date).toLocaleDateString()}</div>
                        </div>
                      </div>
                    `).join('') : 
                    '<div class="text-muted text-center py-8">No recent announcements</div>'
                  }
                </div>
              </div>

              <!-- Course Performance -->
              <div class="dashboard-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-trophy"></i>
                    Top Performing Courses
                  </h2>
                  <button class="view-all-btn" onclick="navigateToSection('courses')">View All</button>
                </div>
                <div class="performance-list">
                  ${coursePerformance.length > 0 ? 
                    coursePerformance.map(course => `
                      <div class="performance-item">
                        <div class="performance-info">
                          <div class="course-name">${course.title}</div>
                          <div class="course-students">${course.studentCount} students</div>
                        </div>
                        <div class="performance-bar">
                          <div class="progress-bar">
                            <div class="progress-fill" style="width: ${course.avgProgress}%"></div>
                          </div>
                          <span class="progress-text">${course.avgProgress}%</span>
                        </div>
                      </div>
                    `).join('') : 
                    '<div class="text-muted text-center py-8">No course data available</div>'
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('content-area').innerHTML = content;
    }



    // --- Sample Data Initialization ---
    (function initSampleData() {
      // Initialize courses if not exists
      if (!localStorage.getItem('courses')) {
        const sampleCourses = [
          {
            id: 1,
            title: 'Math 101',
            code: 'MTH101',
            students: [
              { id: 1, name: 'Ayushi Sharma', email: 'ayushi.sharma@example.com' },
              { id: 2, name: 'Devansh Mehta', email: 'devansh.mehta@example.com' },
              { id: 3, name: 'Priya Kapoor', email: 'priya.kapoor@example.com' },
              ...Array.from({length: 22}, (_, i) => ({ 
                id: i+4, 
                name: `Student ${i+4}`, 
                email: `student${i+4}@example.com` 
              }))
            ]
          },
          {
            id: 2,
            title: 'Physics 202',
            code: 'PHY202',
            students: [
              { id: 27, name: 'Rohan Patel', email: 'rohan.patel@example.com' },
              { id: 28, name: 'Simran Kaur', email: 'simran.kaur@example.com' },
              { id: 29, name: 'Aarav Nair', email: 'aarav.nair@example.com' },
              ...Array.from({length: 15}, (_, i) => ({ 
                id: i+30, 
                name: `Student ${i+30}`, 
                email: `student${i+30}@example.com` 
              }))
            ]
          },
          {
            id: 3,
            title: 'English Literature',
            code: 'ENG301',
            students: [
              { id: 45, name: 'Ananya Verma', email: 'ananya.verma@example.com' },
              { id: 46, name: 'Kabir Singh', email: 'kabir.singh@example.com' },
              { id: 47, name: 'Meera Joshi', email: 'meera.joshi@example.com' },
              ...Array.from({length: 27}, (_, i) => ({ 
                id: i+48, 
                name: `Student ${i+48}`, 
                email: `student${i+48}@example.com` 
              }))
            ]
          }
        ];
        setData(STORAGE_KEYS.COURSES, sampleCourses);
      }

      // Initialize students if not exists
      if (!getData(STORAGE_KEYS.STUDENTS)) {
        const allStudents = [];
        const courses = getData(STORAGE_KEYS.COURSES) || [];
        courses.forEach(course => {
          course.students.forEach(student => {
            if (!allStudents.find(s => s.id === student.id)) {
              allStudents.push({
                ...student,
                courses: [course.id],
                grade: Math.floor(Math.random() * 12) + 9, // Grade 9-12
                parentEmail: `parent.${student.email}`,
                phone: `+1-555-${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`
              });
            }
          });
        });
        setData(STORAGE_KEYS.STUDENTS, allStudents);
      }

      // Initialize announcements if not exists
      if (!getData(STORAGE_KEYS.ANNOUNCEMENTS)) {
        const sampleAnnouncements = [
          {
            id: 1,
            title: 'Welcome to the New Semester!',
            content: 'Welcome back everyone! I hope you had a great break. We have an exciting semester ahead with new topics and projects.',
            recipients: 'All Students',
            priority: 'normal',
            date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
            delivery: ['app', 'email']
          },
          {
            id: 2,
            title: 'Important: Assignment Deadline Extended',
            content: 'Due to technical difficulties, the deadline for the Math 101 final project has been extended to Friday.',
            recipients: 'Math 101 Students',
            priority: 'important',
            date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
            delivery: ['app', 'email', 'sms']
          },
          {
            id: 3,
            title: 'Parent-Teacher Conference Schedule',
            content: 'Parent-teacher conferences will be held next week. Please check your email for your scheduled time slot.',
            recipients: 'Parents/Guardians',
            priority: 'urgent',
            date: new Date().toISOString(),
            delivery: ['app', 'email']
          }
        ];
        setData(STORAGE_KEYS.ANNOUNCEMENTS, sampleAnnouncements);
      }

      // Initialize discussions if not exists
      if (!getData(STORAGE_KEYS.DISCUSSIONS)) {
        const sampleDiscussions = [
          {
            id: 1,
            topic: 'Calculus Integration Techniques',
            description: 'Let\'s discuss different methods of integration and when to use each one.',
            courseId: 1,
            type: 'qna',
            allowPosts: true,
            moderatePosts: false,
            allowReplies: true,
            anonymous: false,
            posts: [
              {
                id: 1,
                author: 'Ayushi Sharma',
                content: 'I find u-substitution the most intuitive method. What do others think?',
                date: new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString(),
                approved: true
              },
              {
                id: 2,
                author: 'Devansh Mehta',
                content: 'Integration by parts is useful for products of functions.',
                date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                approved: true
              }
            ],
            date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
          },
          {
            id: 2,
            topic: 'Physics Lab Safety Guidelines',
            description: 'Important safety reminders for our upcoming lab sessions.',
            courseId: 2,
            type: 'general',
            allowPosts: false,
            moderatePosts: true,
            allowReplies: false,
            anonymous: false,
            posts: [],
            date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
          }
        ];
        setData(STORAGE_KEYS.DISCUSSIONS, sampleDiscussions);
      }

      // Initialize messages if not exists
      if (!getData(STORAGE_KEYS.MESSAGES)) {
        const sampleMessages = [
          {
            id: 1,
            studentId: 1,
            sender: 'student',
            content: 'Hi, I have a question about the calculus assignment. Can you help me understand the integration by parts method?',
            date: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
            read: false
          },
          {
            id: 2,
            studentId: 1,
            sender: 'teacher',
            content: 'Of course! Integration by parts is based on the product rule. The formula is ∫udv = uv - ∫vdu. Which specific problem are you working on?',
            date: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
            read: true
          },
          {
            id: 3,
            studentId: 2,
            sender: 'student',
            content: 'I won\'t be able to attend class tomorrow due to a family emergency. Will I miss anything important?',
            date: new Date(Date.now() - 30 * 60 * 1000).toISOString(),
            read: false
          },
          {
            id: 4,
            studentId: 3,
            sender: 'student',
            content: 'Thank you for the extension on the assignment deadline! I really appreciate it.',
            date: new Date(Date.now() - 15 * 60 * 1000).toISOString(),
            read: true
          }
        ];
        setData(STORAGE_KEYS.MESSAGES, sampleMessages);
      }

          // Clear old teacher data to ensure new credentials work
    const existingTeachers = getData(STORAGE_KEYS.TEACHERS);
    if (existingTeachers && existingTeachers.length > 0) {
      const oldTeacher = existingTeachers[0];
      if (oldTeacher.email === 'teacher@demo.com') {
        // Remove old teacher data
        removeData(STORAGE_KEYS.TEACHERS);
        removeData(STORAGE_KEYS.IS_LOGGED_IN);
        removeData(STORAGE_KEYS.CURRENT_TEACHER);
        removeData(STORAGE_KEYS.REMEMBER_ME);
      }
    }
    
    // Initialize demo teacher account if not exists
    if (!getData(STORAGE_KEYS.TEACHERS)) {
      const demoTeacher = {
        id: 1,
        name: 'Harshwardhan',
        email: 'harshwardhan06@gmail.com',
        password: 'harshdemo123',
        subject: 'Mathematics',
        createdAt: new Date().toISOString(),
        profile: {
          bio: 'Experienced mathematics teacher with 10+ years of teaching experience.',
          phone: '+1-555-0123',
          department: 'Mathematics',
          office: 'Room 201',
          officeHours: 'Mon/Wed 2-4 PM, or by appointment',
          profilePicture: null
        }
      };
      setData(STORAGE_KEYS.TEACHERS, [demoTeacher]);
    }
    
    // Initialize sample students if not exists
    if (!getData(STORAGE_KEYS.STUDENTS)) {
      const sampleStudents = [
        // Students from MATH301 (Advanced Mathematics)
        { id: 1, name: 'Sarah Johnson', email: 'sarah.johnson@university.edu', phone: '+1-555-0101', dob: '2000-03-15', status: 'active', attendance: 95, progress: 87, enrollmentDate: '2024-01-10' },
        { id: 2, name: 'Michael Chen', email: 'michael.chen@university.edu', phone: '+1-555-0102', dob: '1999-07-22', status: 'active', attendance: 88, progress: 92, enrollmentDate: '2024-01-12' },
        { id: 3, name: 'Emily Rodriguez', email: 'emily.rodriguez@university.edu', phone: '+1-555-0103', dob: '2001-11-08', status: 'active', attendance: 92, progress: 78, enrollmentDate: '2024-01-08' },
        { id: 4, name: 'David Kim', email: 'david.kim@university.edu', phone: '+1-555-0104', dob: '2000-05-30', status: 'active', attendance: 85, progress: 85, enrollmentDate: '2024-01-15' },
        { id: 5, name: 'Lisa Thompson', email: 'lisa.thompson@university.edu', phone: '+1-555-0105', dob: '1999-12-14', status: 'active', attendance: 90, progress: 91, enrollmentDate: '2024-01-11' },
        { id: 6, name: 'Robert Zhang', email: 'robert.zhang@university.edu', phone: '+1-555-0106', dob: '2000-09-03', status: 'active', attendance: 87, progress: 83, enrollmentDate: '2024-01-13' },
        { id: 7, name: 'Jennifer Davis', email: 'jennifer.davis@university.edu', phone: '+1-555-0107', dob: '2001-01-25', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-01-14' },
        { id: 8, name: 'Christopher Lee', email: 'christopher.lee@university.edu', phone: '+1-555-0108', dob: '1999-08-17', status: 'active', attendance: 89, progress: 76, enrollmentDate: '2024-01-16' },
        { id: 9, name: 'Amanda Wilson', email: 'amanda.wilson@university.edu', phone: '+1-555-0109', dob: '2000-04-12', status: 'active', attendance: 91, progress: 94, enrollmentDate: '2024-01-17' },
        { id: 10, name: 'Kevin Patel', email: 'kevin.patel@university.edu', phone: '+1-555-0110', dob: '2001-06-28', status: 'active', attendance: 86, progress: 81, enrollmentDate: '2024-01-18' },
        
        // Students from CS101 (Computer Science)
        { id: 11, name: 'Alex Martinez', email: 'alex.martinez@university.edu', phone: '+1-555-0111', dob: '2000-02-09', status: 'active', attendance: 94, progress: 88, enrollmentDate: '2024-01-18' },
        { id: 12, name: 'Jessica Wang', email: 'jessica.wang@university.edu', phone: '+1-555-0112', dob: '1999-10-31', status: 'active', attendance: 90, progress: 85, enrollmentDate: '2024-01-19' },
        { id: 13, name: 'Ryan O\'Connor', email: 'ryan.oconnor@university.edu', phone: '+1-555-0113', dob: '2001-03-07', status: 'active', attendance: 88, progress: 79, enrollmentDate: '2024-01-20' },
        { id: 14, name: 'Maria Garcia', email: 'maria.garcia@university.edu', phone: '+1-555-0114', dob: '2000-07-19', status: 'active', attendance: 92, progress: 87, enrollmentDate: '2024-01-21' },
        { id: 15, name: 'James Wilson', email: 'james.wilson@university.edu', phone: '+1-555-0115', dob: '1999-12-05', status: 'active', attendance: 85, progress: 82, enrollmentDate: '2024-01-22' },
        { id: 16, name: 'Amanda Lee', email: 'amanda.lee@university.edu', phone: '+1-555-0116', dob: '2000-08-14', status: 'active', attendance: 89, progress: 84, enrollmentDate: '2024-01-23' },
        { id: 17, name: 'Brian Taylor', email: 'brian.taylor@university.edu', phone: '+1-555-0117', dob: '2001-04-22', status: 'active', attendance: 91, progress: 86, enrollmentDate: '2024-01-24' },
        { id: 18, name: 'Nicole Anderson', email: 'nicole.anderson@university.edu', phone: '+1-555-0118', dob: '1999-11-30', status: 'active', attendance: 87, progress: 80, enrollmentDate: '2024-01-25' },
        { id: 19, name: 'Steven Brown', email: 'steven.brown@university.edu', phone: '+1-555-0119', dob: '2000-06-18', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-01-26' },
        { id: 20, name: 'Rachel Green', email: 'rachel.green@university.edu', phone: '+1-555-0120', dob: '2001-01-12', status: 'active', attendance: 88, progress: 83, enrollmentDate: '2024-01-27' },
        
        // Students from LIT201 (World Literature)
        { id: 21, name: 'Sophie Anderson', email: 'sophie.anderson@university.edu', phone: '+1-555-0121', dob: '2000-09-25', status: 'active', attendance: 92, progress: 88, enrollmentDate: '2024-01-28' },
        { id: 22, name: 'Daniel Brown', email: 'daniel.brown@university.edu', phone: '+1-555-0122', dob: '1999-12-08', status: 'active', attendance: 86, progress: 81, enrollmentDate: '2024-01-29' },
        { id: 23, name: 'Thomas White', email: 'thomas.white@university.edu', phone: '+1-555-0123', dob: '2001-02-14', status: 'active', attendance: 90, progress: 85, enrollmentDate: '2024-01-30' },
        { id: 24, name: 'Emma Davis', email: 'emma.davis@university.edu', phone: '+1-555-0124', dob: '2000-05-03', status: 'active', attendance: 94, progress: 90, enrollmentDate: '2024-01-31' },
        { id: 25, name: 'Matthew Johnson', email: 'matthew.johnson@university.edu', phone: '+1-555-0125', dob: '1999-07-19', status: 'active', attendance: 89, progress: 84, enrollmentDate: '2024-02-01' },
        { id: 26, name: 'Olivia Smith', email: 'olivia.smith@university.edu', phone: '+1-555-0126', dob: '2001-03-11', status: 'active', attendance: 91, progress: 87, enrollmentDate: '2024-02-02' },
        { id: 27, name: 'William Taylor', email: 'william.taylor@university.edu', phone: '+1-555-0127', dob: '2000-10-28', status: 'active', attendance: 87, progress: 82, enrollmentDate: '2024-02-03' },
        { id: 28, name: 'Isabella Martinez', email: 'isabella.martinez@university.edu', phone: '+1-555-0128', dob: '1999-08-07', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-02-04' },
        { id: 29, name: 'Ethan Wilson', email: 'ethan.wilson@university.edu', phone: '+1-555-0129', dob: '2001-01-23', status: 'active', attendance: 88, progress: 83, enrollmentDate: '2024-02-05' },
        { id: 30, name: 'Ava Foster', email: 'ava.foster@university.edu', phone: '+1-555-0130', dob: '2000-04-16', status: 'active', attendance: 90, progress: 86, enrollmentDate: '2024-02-06' }
      ];
      setData(STORAGE_KEYS.STUDENTS, sampleStudents);
    }
    })();

    // --- Course Management Section ---
    function renderCourseManagement() {
      
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Course Management</h3>
            <button class='btn' onclick='openCourseModal()'>+ Create New Course</button>
          </div>
          
          <!-- Course Statistics -->
          <div class='grid-3 mb-20'>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-book'></i></div>
              <div class='card-title'>Total Courses</div>
              <div class='card-count'>${courses.length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-users'></i></div>
              <div class='card-title'>Total Students</div>
              <div class='card-count'>${courses.reduce((total, course) => total + (course.students?.length || 0), 0)}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-clock'></i></div>
              <div class='card-title'>Active Lessons</div>
              <div class='card-count'>${courses.reduce((total, course) => total + (course.lessons?.length || 0), 0)}</div>
            </div>
          </div>

          <!-- Search and Filter -->
          <div class='grid-2 mb-20'>
            <div>
              <label>Search Courses:</label>
              <input type='text' id='course-search' class='form-control' placeholder='Search by title, code, or description...'>
            </div>
            <div>
              <label>Filter by Category:</label>
              <select id='course-category-filter' class='form-control'>
                <option value=''>All Categories</option>
                <option value='mathematics'>Mathematics</option>
                <option value='science'>Science</option>
                <option value='literature'>Literature</option>
                <option value='history'>History</option>
                <option value='computer-science'>Computer Science</option>
                <option value='arts'>Arts</option>
                <option value='languages'>Languages</option>
                <option value='other'>Other</option>
              </select>
            </div>
          </div>

          <!-- Courses List -->
          <div id='courses-list'>
            ${courses.length === 0 ? `
              <div class='card text-center'>
                <div class='card-icon'><i class='fas fa-plus-circle'></i></div>
                <h4>No Courses Yet</h4>
                <p class='text-muted mb-20'>Create your first course to get started</p>
                <button class='btn' onclick='openCourseModal()'>Create First Course</button>
              </div>
            ` : courses.map((course, idx) => `
              <div class='course-card mb-16' id='course-${course.id}'>
                <div class='course-header'>
                  <div class='course-info'>
                    <h4>${course.title} <span class='course-code'>${course.code}</span></h4>
                    <p class='text-muted'>${course.description || 'No description available'}</p>
                    <div class='course-meta'>
                      <span class='badge badge-primary'><i class='fas fa-users'></i> ${course.students?.length || 0} Students</span>
                      <span class='badge badge-success'><i class='fas fa-clock'></i> ${course.lessons?.length || 0} Lessons</span>
                      <span class='badge badge-info'><i class='fas fa-calendar'></i> ${course.duration || 12} Weeks</span>
                    </div>
                  </div>
                  <div class='course-actions'>
                    <button class='btn btn-secondary' onclick='viewCourseDetails(${course.id})'>View Details</button>
                    <button class='btn btn-secondary' onclick='editCourse(${course.id})'>Edit</button>
                    <button class='btn btn-danger' onclick='deleteCourse(${course.id})'>Delete</button>
                  </div>
                </div>
                
                <!-- Course Progress Bar -->
                <div class='course-progress mb-16'>
                  <div class='progress-info'>
                    <span>Course Progress</span>
                    <span>${course.progress || 0}%</span>
                  </div>
                  <div class='progress-bar'>
                    <div class='progress-fill' style='width: ${course.progress || 0}%'></div>
                  </div>
                </div>

                <!-- Quick Actions -->
                <div class='course-quick-actions'>
                  <button class='btn btn-sm btn-secondary' onclick='manageLessons(${course.id})'>
                    <i class='fas fa-list'></i> Manage Lessons
                  </button>
                  <button class='btn btn-sm btn-secondary' onclick='manageStudents(${course.id})'>
                    <i class='fas fa-user-plus'></i> Manage Students
                  </button>
                  <button class='btn btn-sm btn-secondary' onclick='manageMaterials(${course.id})'>
                    <i class='fas fa-file-alt'></i> Course Materials
                  </button>
                  <button class='btn btn-sm btn-secondary' onclick='viewSyllabus(${course.id})'>
                    <i class='fas fa-calendar-alt'></i> Syllabus
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>

        <!-- Course Modal -->
        <div id='course-modal' class='modal'>
          <div class='modal-content' style='max-width: 600px;'>
            <button class='modal-close' onclick='closeModal("course-modal")'><i class='fas fa-times'></i></button>
            <h2 id='course-modal-title'>Create New Course</h2>
            <form id='course-form'>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Course Title *</label>
                  <input type='text' id='course-title' class='form-control' required>
                </div>
                <div class='form-group'>
                  <label>Course Code *</label>
                  <input type='text' id='course-code' class='form-control' required>
                </div>
              </div>
              <div class='form-group'>
                <label>Description</label>
                <textarea id='course-description' class='form-control' rows='3' placeholder='Brief description of the course...'></textarea>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Duration (Weeks)</label>
                  <input type='number' id='course-duration' class='form-control' value='12' min='1' max='52'>
                </div>
                <div class='form-group'>
                  <label>Credits</label>
                  <input type='number' id='course-credits' class='form-control' value='3' min='1' max='6'>
                </div>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Start Date</label>
                  <input type='date' id='course-start-date' class='form-control'>
                </div>
                <div class='form-group'>
                  <label>End Date</label>
                  <input type='date' id='course-end-date' class='form-control'>
                </div>
              </div>
              <div class='form-group'>
                <label>Course Level</label>
                <select id='course-level' class='form-control'>
                  <option value='beginner'>Beginner</option>
                  <option value='intermediate'>Intermediate</option>
                  <option value='advanced'>Advanced</option>
                </select>
              </div>
              <div class='form-group'>
                <label>Category</label>
                <select id='course-category' class='form-control'>
                  <option value='mathematics'>Mathematics</option>
                  <option value='science'>Science</option>
                  <option value='literature'>Literature</option>
                  <option value='history'>History</option>
                  <option value='computer-science'>Computer Science</option>
                  <option value='arts'>Arts</option>
                  <option value='languages'>Languages</option>
                  <option value='other'>Other</option>
                </select>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("course-modal")'>Cancel</button>
                <button type='submit' class='btn'>Save Course</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Course Details Modal -->
        <div id='course-details-modal' class='modal'>
          <div class='modal-content' style='max-width: 800px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("course-details-modal")'><i class='fas fa-times'></i></button>
            <div id='course-details-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Lessons Modal -->
        <div id='lessons-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("lessons-modal")'><i class='fas fa-times'></i></button>
            <div id='lessons-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Materials Modal -->
        <div id='materials-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("materials-modal")'><i class='fas fa-times'></i></button>
            <div id='materials-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <style>
          .course-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
          }
          .course-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
          }
          .course-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
          }
          .course-info h4 {
            margin-bottom: 8px;
            color: var(--text);
          }
          .course-code {
            font-size: 0.9em;
            color: var(--text-light);
            font-weight: normal;
          }
          .course-meta {
            display: flex;
            gap: 12px;
            margin-top: 12px;
          }
          .course-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
          }
          .course-progress {
            margin: 16px 0;
          }
          .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
          }
          .course-quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
          }
          .btn-sm {
            padding: 6px 12px;
            font-size: 0.85em;
          }
          .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
          }
          .lesson-item {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
          }
          .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
          }
          .lesson-title {
            font-weight: 600;
            color: var(--text);
          }
          .lesson-date {
            color: var(--text-light);
            font-size: 0.9em;
          }
          .material-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            margin-bottom: 8px;
          }
          .material-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
          }
          .material-info {
            flex: 1;
          }
          .material-title {
            font-weight: 600;
            margin-bottom: 4px;
          }
          .material-type {
            font-size: 0.85em;
            color: var(--text-light);
          }
          .syllabus-timeline {
            position: relative;
            padding-left: 30px;
          }
          .syllabus-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary);
          }
          .timeline-item {
            position: relative;
            margin-bottom: 20px;
          }
          .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            border: 3px solid var(--dark-gray);
          }
          .timeline-content {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
          }
          .timeline-date {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
          }
          .lesson-item-small {
            padding: 8px 0;
            border-bottom: 1px solid var(--glass-border);
          }
          .lesson-title-small {
            font-weight: 600;
            margin-bottom: 4px;
          }
          .lesson-date-small {
            font-size: 0.85em;
            color: var(--text-light);
          }
          .course-actions-details {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
          }
        </style>
      `;
      
      // Initialize sample data if none exists
      if (courses.length === 0) {
        initializeSampleCourses();
      }
      
      setTimeout(initCourseManagementEvents, 0);
    }

    // Initialize sample courses with realistic data
    function initializeSampleCourses() {
      const sampleCourses = [
        {
          id: 1,
          title: 'Advanced Mathematics',
          code: 'MATH301',
          description: 'Comprehensive course covering calculus, linear algebra, and mathematical analysis with real-world applications.',
          duration: 16,
          credits: 4,
          level: 'advanced',
          category: 'mathematics',
          startDate: '2024-01-15',
          endDate: '2024-05-15',
          progress: 65,
          students: [
            { id: 1, name: 'Sarah Johnson', email: 'sarah.johnson@university.edu', enrollmentDate: '2024-01-10' },
            { id: 2, name: 'Michael Chen', email: 'michael.chen@university.edu', enrollmentDate: '2024-01-12' },
            { id: 3, name: 'Emily Rodriguez', email: 'emily.rodriguez@university.edu', enrollmentDate: '2024-01-08' },
            { id: 4, name: 'David Kim', email: 'david.kim@university.edu', enrollmentDate: '2024-01-15' },
            { id: 5, name: 'Lisa Thompson', email: 'lisa.thompson@university.edu', enrollmentDate: '2024-01-11' },
            { id: 6, name: 'Robert Zhang', email: 'robert.zhang@university.edu', enrollmentDate: '2024-01-13' },
            { id: 7, name: 'Jennifer Davis', email: 'jennifer.davis@university.edu', enrollmentDate: '2024-01-14' },
            { id: 8, name: 'Christopher Lee', email: 'christopher.lee@university.edu', enrollmentDate: '2024-01-16' },
            { id: 9, name: 'Amanda Wilson', email: 'amanda.wilson@university.edu', enrollmentDate: '2024-01-17' },
            { id: 10, name: 'Kevin Patel', email: 'kevin.patel@university.edu', enrollmentDate: '2024-01-18' }
          ],
          lessons: [
            { id: 1, title: 'Introduction to Calculus', date: '2024-01-15', duration: 90, type: 'lecture', description: 'Overview of calculus concepts, limits, and the fundamental theorem of calculus' },
            { id: 2, title: 'Limits and Continuity', date: '2024-01-22', duration: 90, type: 'lecture', description: 'Understanding limits, continuity, and their applications in real-world problems' },
            { id: 3, title: 'Derivatives and Differentiation', date: '2024-01-29', duration: 90, type: 'lecture', description: 'Rules of differentiation, chain rule, and implicit differentiation' },
            { id: 4, title: 'Applications of Derivatives', date: '2024-02-05', duration: 90, type: 'workshop', description: 'Optimization problems, related rates, and curve sketching' },
            { id: 5, title: 'Integration Techniques', date: '2024-02-12', duration: 90, type: 'lecture', description: 'Antiderivatives, definite integrals, and integration by parts' },
            { id: 6, title: 'Applications of Integration', date: '2024-02-19', duration: 90, type: 'workshop', description: 'Area between curves, volume of revolution, and work problems' },
            { id: 7, title: 'Linear Algebra Fundamentals', date: '2024-02-26', duration: 90, type: 'lecture', description: 'Matrices, vectors, and systems of linear equations' },
            { id: 8, title: 'Vector Spaces and Transformations', date: '2024-03-05', duration: 90, type: 'lecture', description: 'Basis, dimension, and linear transformations' },
            { id: 9, title: 'Eigenvalues and Eigenvectors', date: '2024-03-12', duration: 90, type: 'workshop', description: 'Diagonalization and applications in physics and engineering' },
            { id: 10, title: 'Multivariable Calculus', date: '2024-03-19', duration: 90, type: 'lecture', description: 'Partial derivatives, gradients, and multiple integrals' },
            { id: 11, title: 'Vector Calculus', date: '2024-03-26', duration: 90, type: 'workshop', description: 'Line integrals, surface integrals, and Green\'s theorem' },
            { id: 12, title: 'Differential Equations', date: '2024-04-02', duration: 90, type: 'lecture', description: 'First-order and second-order differential equations' },
            { id: 13, title: 'Series and Sequences', date: '2024-04-09', duration: 90, type: 'lecture', description: 'Power series, Taylor series, and convergence tests' },
            { id: 14, title: 'Complex Analysis Introduction', date: '2024-04-16', duration: 90, type: 'workshop', description: 'Complex numbers, analytic functions, and contour integration' },
            { id: 15, title: 'Mathematical Modeling', date: '2024-04-23', duration: 90, type: 'project', description: 'Real-world applications and modeling projects' },
            { id: 16, title: 'Final Review and Exam Prep', date: '2024-04-30', duration: 90, type: 'review', description: 'Comprehensive review of all topics and exam preparation' }
          ],
          materials: [
            { id: 1, title: 'Calculus Textbook - Stewart', type: 'pdf', url: 'https://example.com/calculus-stewart-textbook.pdf', description: 'Main course textbook covering all calculus topics' },
            { id: 2, title: 'Linear Algebra Textbook', type: 'pdf', url: 'https://example.com/linear-algebra-textbook.pdf', description: 'Comprehensive linear algebra reference' },
            { id: 3, title: 'Lecture Notes - Week 1-4', type: 'pdf', url: 'https://example.com/lecture-notes-1-4.pdf', description: 'Detailed notes on calculus fundamentals' },
            { id: 4, title: 'Calculus Video Series', type: 'video', url: 'https://youtube.com/watch?v=calculus-series', description: 'Complete video lecture series for visual learners' },
            { id: 5, title: 'Practice Problems Set 1-5', type: 'pdf', url: 'https://example.com/practice-1-5.pdf', description: 'Homework assignments with solutions' },
            { id: 6, title: 'Mathematica Tutorial', type: 'video', url: 'https://youtube.com/watch?v=mathematica-tutorial', description: 'Software tutorial for mathematical computations' },
            { id: 7, title: 'Exam Practice Questions', type: 'pdf', url: 'https://example.com/exam-practice.pdf', description: 'Previous exam questions with detailed solutions' }
          ]
        },
        {
          id: 2,
          title: 'Introduction to Computer Science',
          code: 'CS101',
          description: 'Fundamental concepts of programming, algorithms, data structures, and computer systems.',
          duration: 14,
          credits: 3,
          level: 'beginner',
          category: 'computer-science',
          startDate: '2024-01-20',
          endDate: '2024-04-30',
          progress: 45,
          students: [
            { id: 11, name: 'Alex Martinez', email: 'alex.martinez@university.edu', enrollmentDate: '2024-01-18' },
            { id: 12, name: 'Jessica Wang', email: 'jessica.wang@university.edu', enrollmentDate: '2024-01-19' },
            { id: 13, name: 'Ryan O\'Connor', email: 'ryan.oconnor@university.edu', enrollmentDate: '2024-01-20' },
            { id: 14, name: 'Maria Garcia', email: 'maria.garcia@university.edu', enrollmentDate: '2024-01-21' },
            { id: 15, name: 'James Wilson', email: 'james.wilson@university.edu', enrollmentDate: '2024-01-22' },
            { id: 16, name: 'Amanda Lee', email: 'amanda.lee@university.edu', enrollmentDate: '2024-01-23' },
            { id: 17, name: 'Brian Taylor', email: 'brian.taylor@university.edu', enrollmentDate: '2024-01-24' },
            { id: 18, name: 'Nicole Anderson', email: 'nicole.anderson@university.edu', enrollmentDate: '2024-01-25' },
            { id: 19, name: 'Steven Brown', email: 'steven.brown@university.edu', enrollmentDate: '2024-01-26' },
            { id: 20, name: 'Rachel Green', email: 'rachel.green@university.edu', enrollmentDate: '2024-01-27' }
          ],
          lessons: [
            { id: 1, title: 'What is Computer Science?', date: '2024-01-20', duration: 60, type: 'lecture', description: 'Introduction to the field, career opportunities, and course overview' },
            { id: 2, title: 'Programming Basics with Python', date: '2024-01-27', duration: 90, type: 'lab', description: 'First programming session: variables, print statements, and basic syntax' },
            { id: 3, title: 'Variables and Data Types', date: '2024-02-03', duration: 90, type: 'lecture', description: 'Understanding integers, floats, strings, and boolean data types' },
            { id: 4, title: 'Control Structures', date: '2024-02-10', duration: 90, type: 'lab', description: 'If statements, loops (for and while), and conditional logic' },
            { id: 5, title: 'Functions and Modularity', date: '2024-02-17', duration: 90, type: 'lecture', description: 'Creating functions, parameters, return values, and code organization' },
            { id: 6, title: 'Lists and Data Structures', date: '2024-02-24', duration: 90, type: 'lab', description: 'Working with lists, tuples, and basic data structures' },
            { id: 7, title: 'File I/O and Exception Handling', date: '2024-03-03', duration: 90, type: 'lecture', description: 'Reading/writing files and handling errors gracefully' },
            { id: 8, title: 'Object-Oriented Programming', date: '2024-03-10', duration: 90, type: 'lab', description: 'Classes, objects, inheritance, and encapsulation' },
            { id: 9, title: 'Algorithms and Complexity', date: '2024-03-17', duration: 90, type: 'lecture', description: 'Algorithm analysis, Big O notation, and efficiency' },
            { id: 10, title: 'Searching and Sorting', date: '2024-03-24', duration: 90, type: 'lab', description: 'Linear search, binary search, bubble sort, and merge sort' },
            { id: 11, title: 'Web Development Basics', date: '2024-03-31', duration: 90, type: 'workshop', description: 'HTML, CSS, and basic web page creation' },
            { id: 12, title: 'Database Fundamentals', date: '2024-04-07', duration: 90, type: 'lecture', description: 'SQL basics, database design, and data modeling' },
            { id: 13, title: 'Final Project Development', date: '2024-04-14', duration: 90, type: 'project', description: 'Working on individual programming projects' },
            { id: 14, title: 'Project Presentations', date: '2024-04-21', duration: 90, type: 'presentation', description: 'Students present their final projects' }
          ],
          materials: [
            { id: 1, title: 'Python Programming Guide', type: 'pdf', url: 'https://example.com/python-guide.pdf', description: 'Comprehensive Python tutorial and reference' },
            { id: 2, title: 'Programming Environment Setup', type: 'video', url: 'https://youtube.com/watch?v=setup', description: 'Step-by-step guide to set up development environment' },
            { id: 3, title: 'Week 1-3 Exercises', type: 'pdf', url: 'https://example.com/exercises-1-3.pdf', description: 'Practice problems for beginners with solutions' },
            { id: 4, title: 'Code Examples Repository', type: 'link', url: 'https://github.com/example/cs101-examples', description: 'GitHub repository with all code samples' },
            { id: 5, title: 'Python Cheat Sheet', type: 'pdf', url: 'https://example.com/python-cheatsheet.pdf', description: 'Quick reference for Python syntax and functions' },
            { id: 6, title: 'Web Development Tutorial', type: 'video', url: 'https://youtube.com/watch?v=web-dev', description: 'HTML, CSS, and JavaScript basics' },
            { id: 7, title: 'Final Project Guidelines', type: 'pdf', url: 'https://example.com/project-guidelines.pdf', description: 'Requirements and rubric for final project' }
          ]
        },
        {
          id: 3,
          title: 'World Literature',
          code: 'LIT201',
          description: 'Exploration of classic and contemporary literature from around the world, focusing on cultural perspectives and literary analysis.',
          duration: 12,
          credits: 3,
          level: 'intermediate',
          category: 'literature',
          startDate: '2024-02-01',
          endDate: '2024-04-25',
          progress: 25,
          students: [
            { id: 21, name: 'Sophie Anderson', email: 'sophie.anderson@university.edu', enrollmentDate: '2024-01-28' },
            { id: 22, name: 'Daniel Brown', email: 'daniel.brown@university.edu', enrollmentDate: '2024-01-29' },
            { id: 23, name: 'Rachel Green', email: 'rachel.green@university.edu', enrollmentDate: '2024-01-30' },
            { id: 24, name: 'Thomas White', email: 'thomas.white@university.edu', enrollmentDate: '2024-01-31' },
            { id: 25, name: 'Emma Davis', email: 'emma.davis@university.edu', enrollmentDate: '2024-02-01' },
            { id: 26, name: 'Matthew Johnson', email: 'matthew.johnson@university.edu', enrollmentDate: '2024-02-02' },
            { id: 27, name: 'Olivia Smith', email: 'olivia.smith@university.edu', enrollmentDate: '2024-02-03' },
            { id: 28, name: 'William Taylor', email: 'william.taylor@university.edu', enrollmentDate: '2024-02-04' },
            { id: 29, name: 'Isabella Martinez', email: 'isabella.martinez@university.edu', enrollmentDate: '2024-02-05' },
            { id: 30, name: 'Ethan Wilson', email: 'ethan.wilson@university.edu', enrollmentDate: '2024-02-06' }
          ],
          lessons: [
            { id: 1, title: 'Introduction to World Literature', date: '2024-02-01', duration: 75, type: 'lecture', description: 'Overview of course themes, objectives, and global literary traditions' },
            { id: 2, title: 'Ancient Greek Literature', date: '2024-02-08', duration: 75, type: 'discussion', description: 'Homer\'s Iliad and Odyssey, classical Greek drama and philosophy' },
            { id: 3, title: 'Shakespeare and Renaissance', date: '2024-02-15', duration: 75, type: 'lecture', description: 'Elizabethan literature, Shakespeare\'s major works and themes' },
            { id: 4, title: 'French Enlightenment', date: '2024-02-22', duration: 75, type: 'discussion', description: 'Voltaire, Rousseau, and the Age of Enlightenment' },
            { id: 5, title: 'Russian Literature', date: '2024-02-29', duration: 75, type: 'lecture', description: 'Dostoevsky, Tolstoy, and the Russian literary tradition' },
            { id: 6, title: 'Latin American Literature', date: '2024-03-07', duration: 75, type: 'discussion', description: 'Gabriel García Márquez, magical realism, and Latin American voices' },
            { id: 7, title: 'African Literature', date: '2024-03-14', duration: 75, type: 'lecture', description: 'Chinua Achebe, post-colonial literature, and African storytelling' },
            { id: 8, title: 'Asian Literature', date: '2024-03-21', duration: 75, type: 'discussion', description: 'Japanese haiku, Chinese poetry, and modern Asian literature' },
            { id: 9, title: 'Modern European Literature', date: '2024-03-28', duration: 75, type: 'lecture', description: 'Kafka, Camus, and existentialist literature' },
            { id: 10, title: 'Contemporary World Literature', date: '2024-04-04', duration: 75, type: 'discussion', description: 'Modern authors and global literary movements' },
            { id: 11, title: 'Literary Theory and Criticism', date: '2024-04-11', duration: 75, type: 'workshop', description: 'Critical approaches to analyzing literature' },
            { id: 12, title: 'Final Projects and Presentations', date: '2024-04-18', duration: 75, type: 'presentation', description: 'Student presentations of literary analysis projects' }
          ],
          materials: [
            { id: 1, title: 'Course Reading List', type: 'pdf', url: 'https://example.com/reading-list.pdf', description: 'Complete list of required and recommended readings' },
            { id: 2, title: 'Literary Analysis Guide', type: 'pdf', url: 'https://example.com/analysis-guide.pdf', description: 'Comprehensive guide to analyzing literary texts' },
            { id: 3, title: 'Shakespeare\'s Complete Works', type: 'link', url: 'https://shakespeare.mit.edu/', description: 'Online access to all Shakespeare texts' },
            { id: 4, title: 'Writing Workshop Materials', type: 'pdf', url: 'https://example.com/writing-workshop.pdf', description: 'Essay writing guidelines and examples' },
            { id: 5, title: 'World Literature Timeline', type: 'pdf', url: 'https://example.com/timeline.pdf', description: 'Chronological overview of literary movements' },
            { id: 6, title: 'Critical Theory Reader', type: 'pdf', url: 'https://example.com/critical-theory.pdf', description: 'Introduction to literary criticism and theory' }
          ]
        },
        {
          id: 4,
          title: 'Physics for Engineers',
          code: 'PHY201',
          description: 'Applied physics concepts for engineering students, covering mechanics, thermodynamics, and electromagnetism.',
          duration: 15,
          credits: 4,
          level: 'intermediate',
          category: 'science',
          startDate: '2024-01-25',
          endDate: '2024-05-10',
          progress: 35,
          students: [
            { id: 31, name: 'Andrew Clark', email: 'andrew.clark@university.edu', enrollmentDate: '2024-01-20' },
            { id: 32, name: 'Victoria Lewis', email: 'victoria.lewis@university.edu', enrollmentDate: '2024-01-21' },
            { id: 33, name: 'Nathan Hall', email: 'nathan.hall@university.edu', enrollmentDate: '2024-01-22' },
            { id: 34, name: 'Grace Turner', email: 'grace.turner@university.edu', enrollmentDate: '2024-01-23' },
            { id: 35, name: 'Benjamin Scott', email: 'benjamin.scott@university.edu', enrollmentDate: '2024-01-24' },
            { id: 36, name: 'Chloe Adams', email: 'chloe.adams@university.edu', enrollmentDate: '2024-01-25' },
            { id: 37, name: 'Joshua Baker', email: 'joshua.baker@university.edu', enrollmentDate: '2024-01-26' },
            { id: 38, name: 'Mia Carter', email: 'mia.carter@university.edu', enrollmentDate: '2024-01-27' },
            { id: 39, name: 'Samuel Evans', email: 'samuel.evans@university.edu', enrollmentDate: '2024-01-28' },
            { id: 40, name: 'Ava Foster', email: 'ava.foster@university.edu', enrollmentDate: '2024-01-29' }
          ],
          lessons: [
            { id: 1, title: 'Introduction to Physics for Engineers', date: '2024-01-25', duration: 90, type: 'lecture', description: 'Course overview, units, and measurement systems' },
            { id: 2, title: 'Kinematics and Motion', date: '2024-02-01', duration: 90, type: 'lecture', description: 'Position, velocity, acceleration, and motion equations' },
            { id: 3, title: 'Forces and Newton\'s Laws', date: '2024-02-08', duration: 90, type: 'lab', description: 'Force analysis, free body diagrams, and Newton\'s three laws' },
            { id: 4, title: 'Work, Energy, and Power', date: '2024-02-15', duration: 90, type: 'lecture', description: 'Mechanical work, kinetic and potential energy, conservation of energy' },
            { id: 5, title: 'Momentum and Collisions', date: '2024-02-22', duration: 90, type: 'lab', description: 'Linear momentum, impulse, and elastic/inelastic collisions' },
            { id: 6, title: 'Rotational Motion', date: '2024-02-29', duration: 90, type: 'lecture', description: 'Angular kinematics, torque, and rotational dynamics' },
            { id: 7, title: 'Fluid Mechanics', date: '2024-03-07', duration: 90, type: 'lab', description: 'Pressure, buoyancy, and fluid flow principles' },
            { id: 8, title: 'Thermodynamics Fundamentals', date: '2024-03-14', duration: 90, type: 'lecture', description: 'Temperature, heat, and the laws of thermodynamics' },
            { id: 9, title: 'Heat Engines and Efficiency', date: '2024-03-21', duration: 90, type: 'workshop', description: 'Carnot cycle, heat engines, and thermal efficiency' },
            { id: 10, title: 'Electric Charges and Fields', date: '2024-03-28', duration: 90, type: 'lecture', description: 'Electric charge, Coulomb\'s law, and electric fields' },
            { id: 11, title: 'Electric Potential and Circuits', date: '2024-04-04', duration: 90, type: 'lab', description: 'Voltage, current, resistance, and basic circuit analysis' },
            { id: 12, title: 'Magnetic Fields and Forces', date: '2024-04-11', duration: 90, type: 'lecture', description: 'Magnetic fields, Lorentz force, and electromagnetic induction' },
            { id: 13, title: 'Wave Phenomena', date: '2024-04-18', duration: 90, type: 'lab', description: 'Wave properties, interference, and resonance' },
            { id: 14, title: 'Modern Physics Introduction', date: '2024-04-25', duration: 90, type: 'lecture', description: 'Quantum mechanics basics and relativity' },
            { id: 15, title: 'Engineering Applications', date: '2024-05-02', duration: 90, type: 'project', description: 'Real-world engineering problems and solutions' }
          ],
          materials: [
            { id: 1, title: 'Physics for Engineers Textbook', type: 'pdf', url: 'https://example.com/physics-textbook.pdf', description: 'Comprehensive textbook covering all course topics' },
            { id: 2, title: 'Lab Manual', type: 'pdf', url: 'https://example.com/lab-manual.pdf', description: 'Detailed laboratory procedures and experiments' },
            { id: 3, title: 'Physics Simulation Software', type: 'link', url: 'https://phet.colorado.edu/', description: 'Interactive physics simulations for learning' },
            { id: 4, title: 'Problem Solving Guide', type: 'pdf', url: 'https://example.com/problem-solving.pdf', description: 'Step-by-step approach to physics problems' },
            { id: 5, title: 'Engineering Applications Video', type: 'video', url: 'https://youtube.com/watch?v=physics-engineering', description: 'Real-world applications of physics in engineering' },
            { id: 6, title: 'Exam Review Materials', type: 'pdf', url: 'https://example.com/exam-review.pdf', description: 'Practice problems and review questions' }
          ]
        },
        {
          id: 5,
          title: 'Business Ethics and Corporate Social Responsibility',
          code: 'BUS301',
          description: 'Examination of ethical decision-making in business, corporate governance, and social responsibility practices.',
          duration: 10,
          credits: 3,
          level: 'advanced',
          category: 'business',
          startDate: '2024-02-10',
          endDate: '2024-04-20',
          progress: 15,
          students: [
            { id: 41, name: 'Caroline Mitchell', email: 'caroline.mitchell@university.edu', enrollmentDate: '2024-02-05' },
            { id: 42, name: 'Jonathan Roberts', email: 'jonathan.roberts@university.edu', enrollmentDate: '2024-02-06' },
            { id: 43, name: 'Hannah Phillips', email: 'hannah.phillips@university.edu', enrollmentDate: '2024-02-07' },
            { id: 44, name: 'Tyler Campbell', email: 'tyler.campbell@university.edu', enrollmentDate: '2024-02-08' },
            { id: 45, name: 'Lauren Parker', email: 'lauren.parker@university.edu', enrollmentDate: '2024-02-09' },
            { id: 46, name: 'Brandon Evans', email: 'brandon.evans@university.edu', enrollmentDate: '2024-02-10' },
            { id: 47, name: 'Samantha Collins', email: 'samantha.collins@university.edu', enrollmentDate: '2024-02-11' },
            { id: 48, name: 'Derek Stewart', email: 'derek.stewart@university.edu', enrollmentDate: '2024-02-12' },
            { id: 49, name: 'Natalie Morris', email: 'natalie.morris@university.edu', enrollmentDate: '2024-02-13' },
            { id: 50, name: 'Gregory Rogers', email: 'gregory.rogers@university.edu', enrollmentDate: '2024-02-14' }
          ],
          lessons: [
            { id: 1, title: 'Introduction to Business Ethics', date: '2024-02-10', duration: 75, type: 'lecture', description: 'Foundations of ethical theory and business decision-making' },
            { id: 2, title: 'Ethical Frameworks', date: '2024-02-17', duration: 75, type: 'discussion', description: 'Utilitarianism, deontology, virtue ethics, and their applications' },
            { id: 3, title: 'Corporate Governance', date: '2024-02-24', duration: 75, type: 'lecture', description: 'Board structures, executive compensation, and shareholder rights' },
            { id: 4, title: 'Stakeholder Theory', date: '2024-03-02', duration: 75, type: 'discussion', description: 'Balancing interests of various stakeholders in business decisions' },
            { id: 5, title: 'Environmental Responsibility', date: '2024-03-09', duration: 75, type: 'workshop', description: 'Sustainability practices and environmental impact assessment' },
            { id: 6, title: 'Labor and Human Rights', date: '2024-03-16', duration: 75, type: 'lecture', description: 'Workplace ethics, fair labor practices, and human rights in business' },
            { id: 7, title: 'Consumer Protection', date: '2024-03-23', duration: 75, type: 'discussion', description: 'Product safety, advertising ethics, and consumer rights' },
            { id: 8, title: 'Global Business Ethics', date: '2024-03-30', duration: 75, type: 'lecture', description: 'Cross-cultural ethics, international business practices, and corruption' },
            { id: 9, title: 'Technology and Ethics', date: '2024-04-06', duration: 75, type: 'workshop', description: 'AI ethics, data privacy, and responsible technology use' },
            { id: 10, title: 'Case Studies and Presentations', date: '2024-04-13', duration: 75, type: 'presentation', description: 'Student presentations of ethical case studies' }
          ],
          materials: [
            { id: 1, title: 'Business Ethics Textbook', type: 'pdf', url: 'https://example.com/business-ethics-textbook.pdf', description: 'Comprehensive guide to business ethics and CSR' },
            { id: 2, title: 'Case Study Collection', type: 'pdf', url: 'https://example.com/case-studies.pdf', description: 'Real-world business ethics case studies' },
            { id: 3, title: 'Ethical Decision-Making Framework', type: 'pdf', url: 'https://example.com/decision-framework.pdf', description: 'Step-by-step guide for ethical decision making' },
            { id: 4, title: 'Corporate Social Responsibility Report', type: 'pdf', url: 'https://example.com/csr-report.pdf', description: 'Examples of CSR practices from major corporations' },
            { id: 5, title: 'Ethics in Technology Video', type: 'video', url: 'https://youtube.com/watch?v=tech-ethics', description: 'Discussion on ethical implications of emerging technologies' },
            { id: 6, title: 'Global Ethics Standards', type: 'link', url: 'https://example.com/global-ethics', description: 'International business ethics standards and guidelines' }
          ]
        }
      ];
      
      setData(STORAGE_KEYS.COURSES, sampleCourses);
      renderCourseManagement();
    }

    // --- Course Management Events ---
    function initCourseManagementEvents() {
      // Course form submission
      document.getElementById('course-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveCourse();
      });

      // Search and filter functionality
      setTimeout(() => {
        const courseSearch = document.getElementById('course-search');
        const categoryFilter = document.getElementById('course-category-filter');
        
        if (courseSearch) {
          courseSearch.addEventListener('input', filterCourses);
        }
        
        if (categoryFilter) {
          categoryFilter.addEventListener('change', filterCourses);
        }
      }, 100);
    }

    // Filter courses based on search and category
    function filterCourses() {
      const searchTerm = document.getElementById('course-search')?.value.toLowerCase() || '';
      const categoryFilter = document.getElementById('course-category-filter')?.value || '';
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      
      const filtered = courses.filter(course => {
        const matchesSearch = !searchTerm || 
          course.title.toLowerCase().includes(searchTerm) ||
          course.code.toLowerCase().includes(searchTerm) ||
          (course.description && course.description.toLowerCase().includes(searchTerm));
        
        const matchesCategory = !categoryFilter || course.category === categoryFilter;
        
        return matchesSearch && matchesCategory;
      });
      
      // Re-render courses list with filtered results
      const coursesList = document.getElementById('courses-list');
      if (coursesList) {
        if (filtered.length === 0) {
          coursesList.innerHTML = `
            <div class='card text-center'>
              <div class='card-icon'><i class='fas fa-search'></i></div>
              <h4>No Courses Found</h4>
              <p class='text-muted mb-20'>Try adjusting your search criteria</p>
            </div>
          `;
        } else {
          coursesList.innerHTML = filtered.map((course, idx) => `
            <div class='course-card mb-16' id='course-${course.id}'>
              <div class='course-header'>
                <div class='course-info'>
                  <h4>${course.title} <span class='course-code'>${course.code}</span></h4>
                  <p class='text-muted'>${course.description || 'No description available'}</p>
                  <div class='course-meta'>
                    <span class='badge badge-primary'><i class='fas fa-users'></i> ${course.students?.length || 0} Students</span>
                    <span class='badge badge-success'><i class='fas fa-clock'></i> ${course.lessons?.length || 0} Lessons</span>
                    <span class='badge badge-info'><i class='fas fa-calendar'></i> ${course.duration || 12} Weeks</span>
                  </div>
                </div>
                <div class='course-actions'>
                  <button class='btn btn-secondary' onclick='viewCourseDetails(${course.id})'>View Details</button>
                  <button class='btn btn-secondary' onclick='editCourse(${course.id})'>Edit</button>
                  <button class='btn btn-danger' onclick='deleteCourse(${course.id})'>Delete</button>
                </div>
              </div>
              
              <!-- Course Progress Bar -->
              <div class='course-progress mb-16'>
                <div class='progress-info'>
                  <span>Course Progress</span>
                  <span>${course.progress || 0}%</span>
                </div>
                <div class='progress-bar'>
                  <div class='progress-fill' style='width: ${course.progress || 0}%'></div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class='course-quick-actions'>
                <button class='btn btn-sm btn-secondary' onclick='manageLessons(${course.id})'>
                  <i class='fas fa-list'></i> Manage Lessons
                </button>
                <button class='btn btn-sm btn-secondary' onclick='manageStudents(${course.id})'>
                  <i class='fas fa-user-plus'></i> Manage Students
                </button>
                <button class='btn btn-sm btn-secondary' onclick='manageMaterials(${course.id})'>
                  <i class='fas fa-file-alt'></i> Course Materials
                </button>
                <button class='btn btn-sm btn-secondary' onclick='viewSyllabus(${course.id})'>
                  <i class='fas fa-calendar-alt'></i> Syllabus
                </button>
              </div>
            </div>
          `).join('');
        }
      }
    }

    // Course CRUD Operations
    function openCourseModal(editId = null) {
      const modal = document.getElementById('course-modal');
      const title = document.getElementById('course-modal-title');
      const form = document.getElementById('course-form');
      
      if (editId) {
        // Edit mode
        title.textContent = 'Edit Course';
        const courses = JSON.parse(localStorage.getItem('courses') || '[]');
        const course = courses.find(c => c.id === editId);
        if (course) {
          document.getElementById('course-title').value = course.title;
          document.getElementById('course-code').value = course.code;
          document.getElementById('course-description').value = course.description || '';
          document.getElementById('course-duration').value = course.duration || 12;
          document.getElementById('course-credits').value = course.credits || 3;
          document.getElementById('course-start-date').value = course.startDate || '';
          document.getElementById('course-end-date').value = course.endDate || '';
          document.getElementById('course-level').value = course.level || 'beginner';
          document.getElementById('course-category').value = course.category || 'other';
          
          // Store edit ID for save function
          form.dataset.editId = editId;
        }
      } else {
        // Create mode
        title.textContent = 'Create New Course';
        form.reset();
        delete form.dataset.editId;
      }
      
      modal.style.display = 'flex';
    }

    function saveCourse() {
      const form = document.getElementById('course-form');
      const editId = form.dataset.editId;
      
      const courseData = {
        title: document.getElementById('course-title').value.trim(),
        code: document.getElementById('course-code').value.trim(),
        description: document.getElementById('course-description').value.trim(),
        duration: parseInt(document.getElementById('course-duration').value),
        credits: parseInt(document.getElementById('course-credits').value),
        startDate: document.getElementById('course-start-date').value,
        endDate: document.getElementById('course-end-date').value,
        level: document.getElementById('course-level').value,
        category: document.getElementById('course-category').value,
        progress: 0,
        students: [],
        lessons: [],
        materials: []
      };
      
      // Validation
      if (!courseData.title || !courseData.code) {
        alert('Course title and code are required!');
        return;
      }
      
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      
      if (editId) {
        // Update existing course
        const index = courses.findIndex(c => c.id === parseInt(editId));
        if (index !== -1) {
          // Preserve existing data
          courseData.id = parseInt(editId);
          courseData.students = courses[index].students || [];
          courseData.lessons = courses[index].lessons || [];
          courseData.materials = courses[index].materials || [];
          courseData.progress = courses[index].progress || 0;
          courses[index] = courseData;
        }
      } else {
        // Create new course
        courseData.id = courses.length > 0 ? Math.max(...courses.map(c => c.id)) + 1 : 1;
        courses.push(courseData);
      }
      
      setData(STORAGE_KEYS.COURSES, courses);
      closeModal('course-modal');
      renderCourseManagement();
      
      // Show success message
      showNotification(editId ? 'Course updated successfully!' : 'Course created successfully!', 'success');
    }

    function editCourse(courseId) {
      openCourseModal(courseId);
    }

    function deleteCourse(courseId) {
      if (confirm('Are you sure you want to delete this course? This action cannot be undone.')) {
        async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
        courses = courses.filter(c => c.id !== courseId);
        setData(STORAGE_KEYS.COURSES, courses);
        renderCourseManagement();
        showNotification('Course deleted successfully!', 'success');
      }
    }

    function viewCourseDetails(courseId) {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === courseId);
      
      if (!course) return;
      
      const modal = document.getElementById('course-details-modal');
      const content = document.getElementById('course-details-content');
      
      content.innerHTML = `
        <div class='course-details'>
          <div class='course-header-details mb-20'>
            <h2>${course.title} <span class='course-code'>${course.code}</span></h2>
            <p class='text-muted'>${course.description || 'No description available'}</p>
            <div class='course-meta-details'>
              <span class='badge badge-primary'><i class='fas fa-users'></i> ${course.students?.length || 0} Students</span>
              <span class='badge badge-success'><i class='fas fa-clock'></i> ${course.lessons?.length || 0} Lessons</span>
              <span class='badge badge-info'><i class='fas fa-calendar'></i> ${course.duration || 12} Weeks</span>
              <span class='badge badge-warning'><i class='fas fa-star'></i> ${course.credits || 3} Credits</span>
            </div>
          </div>
          
          <div class='grid-2 gap-20'>
            <div class='card'>
              <h4><i class='fas fa-users'></i> Enrolled Students</h4>
              <div class='students-list'>
                ${course.students?.length > 0 ? course.students.map(student => `
                  <div class='student-item'>
                    <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class='student-info'>
                      <div class='student-name'>${student.name}</div>
                      <div class='student-email'>${student.email}</div>
                    </div>
                  </div>
                `).join('') : '<p class="text-muted">No students enrolled</p>'}
              </div>
            </div>
            
            <div class='card'>
              <h4><i class='fas fa-list'></i> Recent Lessons</h4>
              <div class='lessons-list'>
                ${course.lessons?.length > 0 ? course.lessons.slice(0, 3).map(lesson => `
                  <div class='lesson-item-small'>
                    <div class='lesson-title-small'>${lesson.title}</div>
                    <div class='lesson-date-small'>${new Date(lesson.date).toLocaleDateString()}</div>
                  </div>
                `).join('') : '<p class="text-muted">No lessons scheduled</p>'}
              </div>
            </div>
          </div>
          
          <div class='course-actions-details mt-20'>
            <button class='btn btn-secondary' onclick='manageLessons(${course.id})'>Manage Lessons</button>
            <button class='btn btn-secondary' onclick='manageStudents(${course.id})'>Manage Students</button>
            <button class='btn btn-secondary' onclick='manageMaterials(${course.id})'>Course Materials</button>
            <button class='btn btn-secondary' onclick='viewSyllabus(${course.id})'>View Syllabus</button>
          </div>
        </div>
        
        <style>
          .course-header-details h2 {
            margin-bottom: 8px;
          }
          .course-meta-details {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
          }
          .students-list {
            max-height: 300px;
            overflow-y: auto;
          }
          .student-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid var(--glass-border);
          }
          .student-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
          }
          .student-name {
            font-weight: 600;
            margin-bottom: 2px;
          }
          .student-email {
            font-size: 0.85em;
            color: var(--text-light);
          }
          .lessons-list {
            max-height: 300px;
            overflow-y: auto;
          }
          .lesson-item-small {
            padding: 8px 0;
            border-bottom: 1px solid var(--glass-border);
          }
          .lesson-title-small {
            font-weight: 600;
            margin-bottom: 4px;
          }
          .lesson-date-small {
            font-size: 0.85em;
            color: var(--text-light);
          }
          .course-actions-details {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function manageLessons(courseId) {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === courseId);
      
      if (!course) return;
      
      const modal = document.getElementById('lessons-modal');
      const content = document.getElementById('lessons-content');
      
      content.innerHTML = `
        <div class='lessons-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Manage Lessons - ${course.title}</h3>
            <button class='btn' onclick='addLesson(${courseId})'>+ Add Lesson</button>
          </div>
          
          <div class='lessons-timeline'>
            ${course.lessons?.length > 0 ? course.lessons.map((lesson, index) => `
              <div class='lesson-item' data-lesson-id='${lesson.id}'>
                <div class='lesson-header'>
                  <div class='lesson-info'>
                    <div class='lesson-title'>${lesson.title}</div>
                    <div class='lesson-meta'>
                      <span class='lesson-date'><i class='fas fa-calendar'></i> ${new Date(lesson.date).toLocaleDateString()}</span>
                      <span class='lesson-duration'><i class='fas fa-clock'></i> ${lesson.duration} min</span>
                      <span class='lesson-type'><i class='fas fa-chalkboard'></i> ${lesson.type}</span>
                    </div>
                  </div>
                  <div class='lesson-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='editLesson(${courseId}, ${lesson.id})'>Edit</button>
                    <button class='btn btn-sm btn-danger' onclick='deleteLesson(${courseId}, ${lesson.id})'>Delete</button>
                  </div>
                </div>
                <div class='lesson-description'>${lesson.description || 'No description available'}</div>
              </div>
            `).join('') : '<p class="text-muted text-center">No lessons scheduled yet</p>'}
          </div>
        </div>
        
        <style>
          .lessons-timeline {
            max-height: 500px;
            overflow-y: auto;
          }
          .lesson-meta {
            display: flex;
            gap: 16px;
            margin-top: 8px;
            font-size: 0.9em;
            color: var(--text-light);
          }
          .lesson-description {
            margin-top: 12px;
            color: var(--text-light);
            font-size: 0.95em;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function manageMaterials(courseId) {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === courseId);
      
      if (!course) return;
      
      const modal = document.getElementById('materials-modal');
      const content = document.getElementById('materials-content');
      
      content.innerHTML = `
        <div class='materials-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Course Materials - ${course.title}</h3>
            <button class='btn' onclick='addMaterial(${courseId})'>+ Add Material</button>
          </div>
          
          <div class='materials-grid'>
            ${course.materials?.length > 0 ? course.materials.map(material => `
              <div class='material-item' data-material-id='${material.id}'>
                <div class='material-icon'>
                  <i class='fas ${getMaterialIcon(material.type)}'></i>
                </div>
                <div class='material-info'>
                  <div class='material-title'>${material.title}</div>
                  <div class='material-type'>${material.type.toUpperCase()}</div>
                  <div class='material-description'>${material.description}</div>
                </div>
                <div class='material-actions'>
                  <button class='btn btn-sm btn-secondary' onclick='viewMaterial("${material.url}")'>View</button>
                  <button class='btn btn-sm btn-secondary' onclick='editMaterial(${courseId}, ${material.id})'>Edit</button>
                  <button class='btn btn-sm btn-danger' onclick='deleteMaterial(${courseId}, ${material.id})'>Delete</button>
                </div>
              </div>
            `).join('') : '<p class="text-muted text-center">No materials uploaded yet</p>'}
          </div>
        </div>
        
        <style>
          .materials-grid {
            max-height: 500px;
            overflow-y: auto;
          }
          .material-description {
            font-size: 0.85em;
            color: var(--text-light);
            margin-top: 4px;
          }
          .material-actions {
            display: flex;
            gap: 4px;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function viewSyllabus(courseId) {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === courseId);
      
      if (!course) return;
      
      const modal = document.getElementById('course-details-modal');
      const content = document.getElementById('course-details-content');
      
      content.innerHTML = `
        <div class='syllabus-view'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Syllabus - ${course.title}</h3>
            <button class='btn btn-secondary' onclick='viewCourseDetails(${courseId})'>Back to Course</button>
          </div>
          
          <div class='syllabus-timeline'>
            ${course.lessons?.length > 0 ? course.lessons.map((lesson, index) => `
              <div class='timeline-item'>
                <div class='timeline-content'>
                  <div class='timeline-date'>Week ${index + 1} - ${new Date(lesson.date).toLocaleDateString()}</div>
                  <h4>${lesson.title}</h4>
                  <p>${lesson.description || 'No description available'}</p>
                  <div class='lesson-details'>
                    <span class='badge badge-primary'>${lesson.duration} minutes</span>
                    <span class='badge badge-secondary'>${lesson.type}</span>
                  </div>
                </div>
              </div>
            `).join('') : '<p class="text-muted text-center">No syllabus available</p>'}
          </div>
        </div>
      `;
      
      modal.style.display = 'flex';
    }

    // Utility functions
    function getMaterialIcon(type) {
      const icons = {
        'pdf': 'fa-file-pdf',
        'video': 'fa-video',
        'link': 'fa-link',
        'document': 'fa-file-alt',
        'image': 'fa-image'
      };
      return icons[type] || 'fa-file';
    }

    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class='notification-content'>
          <i class='fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}'></i>
          <span>${message}</span>
        </div>
      `;
      
      // Add styles
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success)' : type === 'error' ? 'var(--danger)' : 'var(--primary)'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      `;
      
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Placeholder functions for lesson and material management
    function addLesson(courseId) {
      alert('Add lesson functionality will be implemented next');
    }

    function editLesson(courseId, lessonId) {
      alert('Edit lesson functionality will be implemented next');
    }

    function deleteLesson(courseId, lessonId) {
      if (confirm('Delete this lesson?')) {
        async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
        const courseIndex = courses.findIndex(c => c.id === courseId);
        if (courseIndex !== -1) {
          courses[courseIndex].lessons = courses[courseIndex].lessons.filter(l => l.id !== lessonId);
          localStorage.setItem('courses', JSON.stringify(courses));
          manageLessons(courseId);
          showNotification('Lesson deleted successfully!', 'success');
        }
      }
    }

    function addMaterial(courseId) {
      alert('Add material functionality will be implemented next');
    }

    function editMaterial(courseId, materialId) {
      alert('Edit material functionality will be implemented next');
    }

    function deleteMaterial(courseId, materialId) {
      if (confirm('Delete this material?')) {
        async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
        const courseIndex = courses.findIndex(c => c.id === courseId);
        if (courseIndex !== -1) {
          courses[courseIndex].materials = courses[courseIndex].materials.filter(m => m.id !== materialId);
          localStorage.setItem('courses', JSON.stringify(courses));
          manageMaterials(courseId);
          showNotification('Material deleted successfully!', 'success');
        }
      }
    }

    function viewMaterial(url) {
      window.open(url, '_blank');
    }

    function manageStudents(courseId) {
      alert('Student management functionality will be implemented next');
    }

    // Make course management functions globally accessible
    window.openCourseModal = openCourseModal;
    window.saveCourse = saveCourse;
    window.editCourse = editCourse;
    window.deleteCourse = deleteCourse;
    window.viewCourseDetails = viewCourseDetails;
    window.manageLessons = manageLessons;
    window.manageMaterials = manageMaterials;
    window.viewSyllabus = viewSyllabus;
    window.addLesson = addLesson;
    window.editLesson = editLesson;
    window.deleteLesson = deleteLesson;
    window.addMaterial = addMaterial;
    window.editMaterial = editMaterial;
    window.deleteMaterial = deleteMaterial;
    window.viewMaterial = viewMaterial;
    window.manageStudents = manageStudents;

    // --- Course Management Events ---
    function initCourseManagementEvents() {
      // Course form submission
      document.getElementById('course-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveCourse();
      });
    }
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // ===== STUDENT MANAGEMENT SECTION =====
    function renderStudentManagement() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Student Management & Enrollment</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='openAttendanceModal()'>Mark Attendance</button>
              <button class='btn btn-secondary' onclick='sendBulkAnnouncement()'>Send Announcement</button>
              <button class='btn' onclick='openStudentModal()'>+ Add Student</button>
            </div>
          </div>
          
          <!-- Student Statistics -->
          <div class='grid-4 mb-20'>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-users'></i></div>
              <div class='card-title'>Total Students</div>
              <div class='card-count'>${students.length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-user-check'></i></div>
              <div class='card-title'>Active Students</div>
              <div class='card-count'>${students.filter(s => s.status !== 'inactive').length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-chart-line'></i></div>
              <div class='card-title'>Avg Attendance</div>
              <div class='card-count'>${calculateAverageAttendance()}%</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-graduation-cap'></i></div>
              <div class='card-title'>Avg Progress</div>
              <div class='card-count'>${calculateAverageProgress()}%</div>
            </div>
          </div>

          <!-- Course-wise Student Distribution -->
          <div class='card mb-20'>
            <h4><i class='fas fa-chart-pie'></i> Students by Course</h4>
            <div class='course-student-grid'>
              ${courses.map(course => `
                <div class='course-student-card'>
                  <div class='course-student-header'>
                    <h5>${course.title}</h5>
                    <span class='badge badge-primary'>${course.students?.length || 0} students</span>
                  </div>
                  <div class='course-student-list'>
                    ${course.students?.length > 0 ? course.students.slice(0, 3).map(student => `
                      <div class='student-mini-item'>
                        <div class='student-mini-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                        <div class='student-mini-info'>
                          <div class='student-mini-name'>${student.name}</div>
                          <div class='student-mini-email'>${student.email}</div>
                        </div>
                      </div>
                    `).join('') : '<p class="text-muted">No students enrolled</p>'}
                    ${course.students?.length > 3 ? `<div class='text-muted'>+${course.students.length - 3} more students</div>` : ''}
                  </div>
                  <button class='btn btn-sm btn-secondary' onclick='viewCourseStudents(${course.id})'>View All</button>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Students List -->
          <div class='card'>
            <div class='flex flex-between flex-center mb-20'>
              <h4><i class='fas fa-list'></i> All Students</h4>
              <div class='flex gap-10'>
                <input type='text' id='student-search' class='form-control' placeholder='Search students...' style='width: 200px;'>
                <select id='course-filter' class='form-control' style='width: 150px;'>
                  <option value=''>All Courses</option>
                  ${courses.map(course => `<option value='${course.id}'>${course.title}</option>`).join('')}
                </select>
              </div>
            </div>
            
            <div class='table-responsive'>
              <table class='table'>
                <thead>
                  <tr>
                    <th>Student</th>
                    <th>Email</th>
                    <th>Enrolled Courses</th>
                    <th>Attendance</th>
                    <th>Progress</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id='students-table-body'>
                  ${renderStudentsTable()}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Student Modal -->
        <div id='student-modal' class='modal'>
          <div class='modal-content' style='max-width: 600px;'>
            <button class='modal-close' onclick='closeModal("student-modal")'><i class='fas fa-times'></i></button>
            <h2 id='student-modal-title'>Add New Student</h2>
            <form id='student-form'>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>First Name *</label>
                  <input type='text' id='student-firstname' class='form-control' required>
                </div>
                <div class='form-group'>
                  <label>Last Name *</label>
                  <input type='text' id='student-lastname' class='form-control' required>
                </div>
              </div>
              <div class='form-group'>
                <label>Email *</label>
                <input type='email' id='student-email' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Phone Number</label>
                <input type='tel' id='student-phone' class='form-control'>
              </div>
              <div class='form-group'>
                <label>Date of Birth</label>
                <input type='date' id='student-dob' class='form-control'>
              </div>
              <div class='form-group'>
                <label>Enroll in Courses</label>
                <div class='course-checkboxes'>
                  ${courses.map(course => `
                    <label class='course-checkbox'>
                      <input type='checkbox' value='${course.id}'>
                      <span class='checkbox-label'>
                        <strong>${course.title}</strong>
                        <small>${course.code} - ${course.duration} weeks</small>
                      </span>
                    </label>
                  `).join('')}
                </div>
              </div>
              <div class='form-group'>
                <label>Student Status</label>
                <select id='student-status' class='form-control'>
                  <option value='active'>Active</option>
                  <option value='inactive'>Inactive</option>
                  <option value='suspended'>Suspended</option>
                </select>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("student-modal")'>Cancel</button>
                <button type='submit' class='btn'>Save Student</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Student Details Modal -->
        <div id='student-details-modal' class='modal'>
          <div class='modal-content' style='max-width: 800px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("student-details-modal")'><i class='fas fa-times'></i></button>
            <div id='student-details-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Attendance Modal -->
        <div id='attendance-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("attendance-modal")'><i class='fas fa-times'></i></button>
            <div id='attendance-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Message Modal -->
        <div id='message-modal' class='modal'>
          <div class='modal-content' style='max-width: 500px;'>
            <button class='modal-close' onclick='closeModal("message-modal")'><i class='fas fa-times'></i></button>
            <h2>Send Message to Student</h2>
            <div class='form-group'>
              <label>Subject</label>
              <input type='text' id='message-subject' class='form-control' placeholder='Message subject...'>
            </div>
            <div class='form-group'>
              <label>Message</label>
              <textarea id='message-content' class='form-control' rows='5' placeholder='Type your message...'></textarea>
            </div>
            <div class='form-group'>
              <label>Priority</label>
              <select id='message-priority' class='form-control'>
                <option value='normal'>Normal</option>
                <option value='important'>Important</option>
                <option value='urgent'>Urgent</option>
              </select>
            </div>
            <button class='btn' onclick='sendMessage()'>Send Message</button>
          </div>
        </div>

        <style>
          .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
          .course-student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
          }
          .course-student-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
          }
          .course-student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
          }
          .course-student-header h5 {
            margin: 0;
            color: var(--text);
          }
          .course-student-list {
            margin-bottom: 12px;
          }
          .student-mini-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid var(--glass-border);
          }
          .student-mini-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: 600;
          }
          .student-mini-name {
            font-weight: 600;
            font-size: 0.9em;
          }
          .student-mini-email {
            font-size: 0.8em;
            color: var(--text-light);
          }
          .course-checkboxes {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
          }
          .course-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            cursor: pointer;
          }
          .course-checkbox input[type="checkbox"] {
            margin-top: 2px;
          }
          .checkbox-label {
            display: flex;
            flex-direction: column;
          }
          .checkbox-label small {
            color: var(--text-light);
            font-size: 0.85em;
          }
          .student-row {
            cursor: pointer;
          }
          .student-row:hover {
            background: var(--medium-gray);
          }
          .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
          }
          .attendance-item {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
          }
          .attendance-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
          }
          .status-present { background: var(--success); color: white; }
          .status-absent { background: var(--danger); color: white; }
          .status-late { background: var(--warning); color: white; }
          .student-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
          }
          .student-name {
            font-weight: 600;
            margin-bottom: 2px;
          }
          .student-id {
            font-size: 0.8em;
            color: var(--text-light);
          }
          .enrolled-courses {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
          }
          .student-actions {
            display: flex;
            gap: 4px;
          }
          .attendance-options {
            display: flex;
            gap: 8px;
          }
          .attendance-option {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
          }
          .attendance-option input[type="radio"] {
            display: none;
          }
          .attendance-option input[type="radio"]:checked + .attendance-status {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          }
        </style>
      `;
      
      // Initialize sample students if none exist
      if (students.length === 0) {
        initializeSampleStudents();
      }
      
      setTimeout(initStudentManagementEvents, 0);
    }

    function renderStudentsTable() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      
      if (students.length === 0) {
        return '<tr><td colspan="7" class="text-center text-muted">No students enrolled</td></tr>';
      }
      
      // Sort students by number of enrolled courses (descending)
      students.sort((a, b) => {
        const aCourses = courses.filter(course => 
          course.students && course.students.some(s => s.email === a.email)
        ).length;
        const bCourses = courses.filter(course => 
          course.students && course.students.some(s => s.email === b.email)
        ).length;
        return bCourses - aCourses; // Descending order (most courses first)
      });
      
      return students.map((student, index) => {
        const enrolledCourses = courses.filter(course => 
          course.students && course.students.some(s => s.email === student.email)
        );
        
        return `
          <tr class='student-row' onclick='viewStudentDetails(${index})'>
            <td>
              <div class='flex flex-center gap-10'>
                <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                <div>
                  <div class='student-name'>${student.name}</div>
                  <div class='student-id'>ID: ${student.id || 'N/A'}</div>
                </div>
              </div>
            </td>
            <td>${student.email}</td>
            <td>
              <div class='enrolled-courses'>
                ${enrolledCourses.length > 0 ? enrolledCourses.map(course => 
                  `<span class='badge badge-primary'>${course.code}</span>`
                ).join(' ') : '<span class="text-muted">No courses</span>'}
              </div>
            </td>
            <td>
              <span class='badge ${getAttendanceBadge(student.attendance || 0)}'>${student.attendance || 0}%</span>
            </td>
            <td>
              <div class='progress-bar'>
                <div class='progress-fill' style='width: ${student.progress || 0}%'></div>
              </div>
              <small>${student.progress || 0}%</small>
            </td>
            <td>
              <span class='badge ${getStatusBadge(student.status || 'active')}'>${student.status || 'active'}</span>
            </td>
            <td>
              <div class='student-actions'>
                <button class='btn btn-sm btn-secondary' onclick='event.stopPropagation(); messageStudent(${index})'>
                  <i class='fas fa-envelope'></i>
                </button>
                <button class='btn btn-sm btn-secondary' onclick='event.stopPropagation(); editStudent(${index})'>
                  <i class='fas fa-edit'></i>
                </button>
                <button class='btn btn-sm btn-danger' onclick='event.stopPropagation(); removeStudent(${index})'>
                  <i class='fas fa-trash'></i>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // ===== ASSIGNMENT MANAGEMENT SECTION =====
    function renderAssessmentTools() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Assignment Management & Assessment</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='exportAssignments()'>Export Data</button>
              <button class='btn' onclick='openAssignmentModal()'>+ Create Assignment</button>
            </div>
          </div>
          
          <!-- Assignment Statistics -->
          <div class='grid-4 mb-20'>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-tasks'></i></div>
              <div class='card-title'>Total Assignments</div>
              <div class='card-count'>${assignments.length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-clock'></i></div>
              <div class='card-title'>Pending Grading</div>
              <div class='card-count'>${assignments.filter(a => !a.graded).length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-check-circle'></i></div>
              <div class='card-title'>Graded</div>
              <div class='card-count'>${assignments.filter(a => a.graded).length}</div>
            </div>
            <div class='card'>
              <div class='card-icon'><i class='fas fa-exclamation-triangle'></i></div>
              <div class='card-title'>Overdue</div>
              <div class='card-count'>${getOverdueAssignments().length}</div>
            </div>
          </div>

          <!-- Assignments List -->
          <div class='card'>
            <div class='flex flex-between flex-center mb-20'>
              <h4><i class='fas fa-list'></i> All Assignments</h4>
              <div class='flex gap-10'>
                <input type='text' id='assignment-search' class='form-control' placeholder='Search assignments...' style='width: 200px;'>
                <select id='assignment-course-filter' class='form-control' style='width: 150px;'>
                  <option value=''>All Courses</option>
                  ${courses.map(course => `<option value='${course.id}'>${course.title}</option>`).join('')}
                </select>
                <select id='assignment-status-filter' class='form-control' style='width: 120px;'>
                  <option value=''>All Status</option>
                  <option value='pending'>Pending</option>
                  <option value='graded'>Graded</option>
                  <option value='overdue'>Overdue</option>
                </select>
              </div>
            </div>
            
            <div class='assignments-grid'>
              ${assignments.length === 0 ? `
                <div class='card text-center'>
                  <div class='card-icon'><i class='fas fa-plus-circle'></i></div>
                  <h4>No Assignments Yet</h4>
                  <p class='text-muted mb-20'>Create your first assignment to get started</p>
                  <button class='btn' onclick='openAssignmentModal()'>Create First Assignment</button>
                </div>
              ` : assignments.map((assignment, index) => `
                <div class='assignment-card' id='assignment-${assignment.id}'>
                  <div class='assignment-header'>
                    <div class='assignment-info'>
                      <h4>${assignment.title}</h4>
                      <p class='text-muted'>${assignment.description || 'No description available'}</p>
                      <div class='assignment-meta'>
                        <span class='badge badge-primary'><i class='fas fa-book'></i> ${assignment.courseName || 'Unknown Course'}</span>
                        <span class='badge badge-info'><i class='fas fa-calendar'></i> Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                        <span class='badge ${assignment.graded ? 'badge-success' : 'badge-warning'}'>
                          <i class='fas ${assignment.graded ? 'fa-check-circle' : 'fa-clock'}'></i> 
                          ${assignment.graded ? 'Graded' : 'Pending'}
                        </span>
                      </div>
                    </div>
                    <div class='assignment-actions'>
                      <button class='btn btn-secondary' onclick='viewAssignmentDetails(${assignment.id})'>View Details</button>
                      <button class='btn btn-secondary' onclick='editAssignment(${assignment.id})'>Edit</button>
                      <button class='btn btn-danger' onclick='deleteAssignment(${assignment.id})'>Delete</button>
                    </div>
                  </div>
                  
                  <!-- Assignment Progress -->
                  <div class='assignment-progress mb-16'>
                    <div class='progress-info'>
                      <span>Submissions: ${assignment.submissions?.length || 0}/${assignment.totalStudents || 0}</span>
                      <span>${assignment.submissions?.length > 0 ? Math.round((assignment.submissions.length / assignment.totalStudents) * 100) : 0}%</span>
                    </div>
                    <div class='progress-bar'>
                      <div class='progress-fill' style='width: ${assignment.submissions?.length > 0 ? (assignment.submissions.length / assignment.totalStudents) * 100 : 0}%'></div>
                    </div>
                  </div>

                  <!-- Quick Actions -->
                  <div class='assignment-quick-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='gradeAssignment(${assignment.id})'>
                      <i class='fas fa-star'></i> Grade Submissions
                    </button>
                    <button class='btn btn-sm btn-secondary' onclick='viewSubmissions(${assignment.id})'>
                      <i class='fas fa-eye'></i> View Submissions
                    </button>
                    <button class='btn btn-sm btn-secondary' onclick='downloadAssignment(${assignment.id})'>
                      <i class='fas fa-download'></i> Download
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>

        <!-- Assignment Modal -->
        <div id='assignment-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("assignment-modal")'><i class='fas fa-times'></i></button>
            <h2 id='assignment-modal-title'>Create New Assignment</h2>
            <form id='assignment-form'>
              <div class='form-group'>
                <label>Assignment Title *</label>
                <input type='text' id='assignment-title' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Description</label>
                <textarea id='assignment-description' class='form-control' rows='3' placeholder='Assignment description and requirements...'></textarea>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Course *</label>
                  <select id='assignment-course' class='form-control' required>
                    <option value=''>Select Course</option>
                    ${courses.map(course => `<option value='${course.id}'>${course.title} (${course.code})</option>`).join('')}
                  </select>
                </div>
                <div class='form-group'>
                  <label>Due Date *</label>
                  <input type='datetime-local' id='assignment-due-date' class='form-control' required>
                </div>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Total Points</label>
                  <input type='number' id='assignment-points' class='form-control' value='100' min='1' max='1000'>
                </div>
                <div class='form-group'>
                  <label>Assignment Type</label>
                  <select id='assignment-type' class='form-control'>
                    <option value='homework'>Homework</option>
                    <option value='quiz'>Quiz</option>
                    <option value='project'>Project</option>
                    <option value='exam'>Exam</option>
                    <option value='essay'>Essay</option>
                    <option value='presentation'>Presentation</option>
                  </select>
                </div>
              </div>
              <div class='form-group'>
                <label>Attached File (Mock)</label>
                <div class='file-upload-area'>
                  <input type='file' id='assignment-file' class='form-control' accept='.pdf,.doc,.docx,.txt'>
                  <small class='text-muted'>Supported formats: PDF, DOC, DOCX, TXT (Max 10MB)</small>
                </div>
              </div>
              <div class='form-group'>
                <label>Instructions for Students</label>
                <textarea id='assignment-instructions' class='form-control' rows='4' placeholder='Detailed instructions for students...'></textarea>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("assignment-modal")'>Cancel</button>
                <button type='submit' class='btn'>Save Assignment</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Assignment Details Modal -->
        <div id='assignment-details-modal' class='modal'>
          <div class='modal-content' style='max-width: 800px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("assignment-details-modal")'><i class='fas fa-times'></i></button>
            <div id='assignment-details-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Submissions Modal -->
        <div id='submissions-modal' class='modal'>
          <div class='modal-content' style='max-width: 900px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("submissions-modal")'><i class='fas fa-times'></i></button>
            <div id='submissions-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Grading Modal -->
        <div id='grading-modal' class='modal'>
          <div class='modal-content' style='max-width: 800px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("grading-modal")'><i class='fas fa-times'></i></button>
            <div id='grading-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <style>
          .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
          .assignments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
          }
          .assignment-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
          }
          .assignment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
          }
          .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
          }
          .assignment-info h4 {
            margin-bottom: 8px;
            color: var(--text);
          }
          .assignment-meta {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            flex-wrap: wrap;
          }
          .assignment-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
          }
          .assignment-progress {
            margin: 16px 0;
          }
          .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
          }
          .assignment-quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
          }
          .file-upload-area {
            border: 2px dashed var(--glass-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: var(--medium-gray);
          }
          .submission-item {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
          }
          .submission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
          }
          .submission-student {
            display: flex;
            align-items: center;
            gap: 12px;
          }
          .submission-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
          }
          .status-submitted { background: var(--success); color: white; }
          .status-late { background: var(--warning); color: white; }
          .status-missing { background: var(--danger); color: white; }
          .grading-form {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
          }
          .grade-input {
            width: 80px;
            text-align: center;
          }
        </style>
      `;
      
      // Initialize sample assignments if none exist
      if (assignments.length === 0) {
        initializeSampleAssignments();
      }
      
      setTimeout(initAssignmentEvents, 0);
    }

    // Grades & Assessment
    function loadGrades() {
      const content = `
        <div class="card" style="grid-column: 1 / -1;">
          <div class="flex flex-between flex-center mb-20">
            <h3>Grades & Assessment</h3>
            <div class="flex gap-10">
              <button class="btn btn-secondary" onclick="exportGradebook()">Export Gradebook</button>
              <button class="btn btn-secondary" onclick="openGradebookSettings()">Gradebook Settings</button>
              <button class="btn" onclick="createAssignment()">+ Create Assignment</button>
            </div>
          </div>
          
          <!-- Assessment Overview -->
          <div class="grid-3 mb-20">
            <div class="card">
              <h4>Total Assessments</h4>
              <div class="card-count">${getTotalAssessments()}</div>
              <p class="text-muted">Assignments & Quizzes</p>
            </div>
            <div class="card">
              <h4>Average Grade</h4>
              <div class="card-count">${calculateAverageGrade()}%</div>
              <p class="text-muted">Across all courses</p>
            </div>
            <div class="card">
              <h4>Pending Grading</h4>
              <div class="card-count">${getPendingGrading()}</div>
              <p class="text-muted">Submissions to review</p>
            </div>
          </div>

          <!-- Assessment Types -->
          <div class="grid-2 mb-20">
            <div class="card">
              <h4>Grade Distribution</h4>
              <div id="grade-chart">
                <div class="flex flex-between mb-16">
                  <span>A (90-100)</span>
                  <span>${calculateGradeDistribution('A')}%</span>
                </div>
                <div class="flex flex-between mb-16">
                  <span>B (80-89)</span>
                  <span>${calculateGradeDistribution('B')}%</span>
                </div>
                <div class="flex flex-between mb-16">
                  <span>C (70-79)</span>
                  <span>${calculateGradeDistribution('C')}%</span>
                </div>
                <div class="flex flex-between mb-16">
                  <span>D (60-69)</span>
                  <span>${calculateGradeDistribution('D')}%</span>
                </div>
                <div class="flex flex-between">
                  <span>F (0-59)</span>
                  <span>${calculateGradeDistribution('F')}%</span>
                </div>
              </div>
            </div>
            <div class="card">
              <h4>Recent Assessments</h4>
              <div id="recent-assessments">
                ${renderRecentAssessments()}
              </div>
            </div>
          </div>

          <!-- Assessment Management Tabs -->
          <div class="card">
            <div class="tab-navigation mb-20">
              <button class="tab-btn active" onclick="switchAssessmentTab('assignments')">Assignments</button>
              <button class="tab-btn" onclick="switchAssessmentTab('gradebook')">Gradebook</button>
              <button class="tab-btn" onclick="switchAssessmentTab('grading')">Manual Grading</button>
            </div>
            
            <div id="assignments-tab" class="tab-content active">
              ${renderAssignmentsTab()}
            </div>
            
            <div id="gradebook-tab" class="tab-content">
              ${renderGradebookTab()}
            </div>
            
            <div id="grading-tab" class="tab-content">
              ${renderGradingTab()}
            </div>
          </div>
        </div>
      `;
      document.getElementById('content-area').innerHTML = content;
      initAssessmentEvents();
    }

    // Exams Module
    function loadExams() {
      const content = `
        <div class="card" style="grid-column: 1 / -1;">
          <div class="flex flex-between flex-center mb-20">
            <h3><i class="fas fa-file-alt"></i> Exams & MCQ Tests</h3>
            <div class="flex gap-10">
              <button class="btn btn-secondary" onclick="openExamsModule()">Open Exams Module</button>
              <button class="btn" onclick="createExam()">+ Create New Exam</button>
            </div>
          </div>
          
          <!-- Exams Overview -->
          <div class="grid-3 mb-20">
            <div class="card">
              <h4>Total Exams</h4>
              <div class="card-count">${getTotalExams()}</div>
              <p class="text-muted">MCQ Tests Created</p>
            </div>
            <div class="card">
              <h4>Active Exams</h4>
              <div class="card-count">${getActiveExams()}</div>
              <p class="text-muted">Currently Available</p>
            </div>
            <div class="card">
              <h4>Average Score</h4>
              <div class="card-count">${getAverageExamScore()}%</div>
              <p class="text-muted">Across all exams</p>
            </div>
          </div>

          <!-- Recent Exams -->
          <div class="card">
            <h4>Recent Exams</h4>
            <div id="recent-exams">
              ${renderRecentExams()}
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card">
            <h4>Quick Actions</h4>
            <div class="grid-2">
              <div class="flex flex-column gap-10">
                <button class="btn btn-secondary" onclick="openExamsModule()">
                  <i class="fas fa-external-link-alt"></i> Open Full Exams Module
                </button>
                <button class="btn btn-secondary" onclick="importExam()">
                  <i class="fas fa-upload"></i> Import Exam
                </button>
                <button class="btn btn-secondary" onclick="exportExams()">
                  <i class="fas fa-download"></i> Export All Exams
                </button>
              </div>
              <div class="flex flex-column gap-10">
                <button class="btn btn-secondary" onclick="viewExamResults()">
                  <i class="fas fa-chart-bar"></i> View Results
                </button>
                <button class="btn btn-secondary" onclick="examAnalytics()">
                  <i class="fas fa-chart-line"></i> Exam Analytics
                </button>
                <button class="btn btn-secondary" onclick="examSettings()">
                  <i class="fas fa-cog"></i> Exam Settings
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('content-area').innerHTML = content;
    }

    // Communication
    function loadCommunication() {
      const content = `
        <div class="card" style="grid-column: 1 / -1;">
          <div class="flex flex-between flex-center mb-20">
            <h3>Communication Center</h3>
            <button class="btn" onclick="sendAnnouncement()">+ Send Announcement</button>
          </div>
          <div class="grid-2">
            <div class="card">
              <h4>Recent Announcements</h4>
              <div id="announcements-list">
                ${renderAnnouncements()}
              </div>
            </div>
            <div class="card">
              <h4>Quick Actions</h4>
              <div class="flex flex-column gap-10">
                <button class="btn btn-secondary" onclick="sendEmail()">Send Email</button>
                <button class="btn btn-secondary" onclick="scheduleMeeting()">Schedule Meeting</button>
                <button class="btn btn-secondary" onclick="createDiscussion()">Create Discussion</button>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('content-area').innerHTML = content;
    }

    // Analytics
    function loadAnalytics() {
      const content = `
        <div class="card" style="grid-column: 1 / -1;">
          <h3>Analytics Dashboard</h3>
          <div class="grid-3">
            <div class="card">
              <h4>Student Engagement</h4>
              <div class="card-count">${calculateEngagement()}%</div>
              <p class="text-muted">Average across all courses</p>
            </div>
            <div class="card">
              <h4>Course Completion</h4>
              <div class="card-count">${calculateCompletion()}%</div>
              <p class="text-muted">Students completing courses</p>
            </div>
            <div class="card">
              <h4>Assignment Submission Rate</h4>
              <div class="card-count">${calculateSubmissionRate()}%</div>
              <p class="text-muted">On-time submissions</p>
            </div>
          </div>
          <div class="card mt-20">
            <h4>Performance Trends</h4>
            <div id="performance-chart">
              <p class="text-muted text-center">Performance visualization would go here</p>
            </div>
          </div>
        </div>
      `;
      document.getElementById('content-area').innerHTML = content;
    }

    // Settings
    function loadSettings() {
      const content = `
        <div class="card" style="grid-column: 1 / -1;">
          <h3>Settings</h3>
          <div class="grid-2">
            <div class="card">
              <h4>Account Settings</h4>
              <div class="form-group">
                <label>Email Notifications</label>
                <input type="checkbox" id="email-notifications" checked>
              </div>
              <div class="form-group">
                <label>Auto-save</label>
                <input type="checkbox" id="auto-save" checked>
              </div>
              <button class="btn" onclick="saveSettings()">Save Settings</button>
            </div>
            <div class="card">
              <h4>Course Settings</h4>
              <div class="form-group">
                <label>Default Course Duration (weeks)</label>
                <input type="number" class="form-control" value="12">
              </div>
              <div class="form-group">
                <label>Grading Scale</label>
                <select class="form-control">
                  <option>Letter Grades (A-F)</option>
                  <option>Percentage (0-100)</option>
                  <option>Pass/Fail</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      `;
      document.getElementById('content-area').innerHTML = content;
    }

    // Utility Functions
    function calculateAverageGrade() {
      const gradedAssignments = assignments.filter(a => a.graded);
      if (gradedAssignments.length === 0) return 0;
      const total = gradedAssignments.reduce((sum, a) => sum + (a.averageGrade || 0), 0);
      return Math.round(total / gradedAssignments.length);
    }

    function getUpcomingDeadlines() {
      const now = new Date();
      return assignments.filter(a => new Date(a.dueDate) > now);
    }

    function getOverdueAssignments() {
      const now = new Date();
      return assignments.filter(a => new Date(a.dueDate) < now && !a.graded);
    }

    function calculateGradeDistribution(grade) {
      // Simplified calculation
      return Math.floor(Math.random() * 30) + 10;
    }

    function calculateEngagement() {
      return Math.floor(Math.random() * 30) + 70;
    }

    function calculateCompletion() {
      return Math.floor(Math.random() * 20) + 80;
    }

    function calculateSubmissionRate() {
      return Math.floor(Math.random() * 15) + 85;
    }

    function renderRecentAssessments() {
      return assignments.slice(0, 5).map(a => `
        <div class="flex flex-between flex-center mb-16">
          <span>${a.title}</span>
          <span class="badge badge-primary">${a.averageGrade || 0}%</span>
        </div>
      `).join('');
    }

    function renderAnnouncements() {
      if (announcements.length === 0) {
        return '<p class="text-muted">No announcements yet</p>';
      }
      return announcements.slice(0, 5).map(a => `
        <div class="mb-16">
          <h5>${a.title}</h5>
          <p class="text-muted">${a.content}</p>
          <small>${new Date(a.date).toLocaleDateString()}</small>
        </div>
      `).join('');
    }

    // Modal Functions
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Profile Functions
    function loadProfile() {
      const name = localStorage.getItem('teacher-fullname') || 'Harshwardhan';
      const email = localStorage.getItem('teacher-email') || 'harshwardhan06@gmail.com';
      
      document.getElementById('teacher-name').textContent = name;
      document.getElementById('edit-fullname').value = name;
      document.getElementById('edit-email').value = email;
      
      const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
      document.getElementById('teacher-avatar').textContent = initials;
    }

    function saveProfile() {
      const name = document.getElementById('edit-fullname').value;
      const email = document.getElementById('edit-email').value;
      
      localStorage.setItem('teacher-fullname', name);
      localStorage.setItem('teacher-email', email);
      
      loadProfile();
      closeModal('profile-modal');
    }

    // Theme Functions
    function toggleTheme() {
      const currentTheme = getData(STORAGE_KEYS.CURRENT_THEME) || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      setData(STORAGE_KEYS.CURRENT_THEME, newTheme);
      applyTheme(newTheme);
    }
    
    function applyTheme(theme) {
      const icon = document.querySelector('#theme-toggle-btn i');
      
      if (theme === 'light') {
        document.body.classList.remove('dark-theme');
        document.body.classList.add('light-theme');
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      } else {
        document.body.classList.remove('light-theme');
        document.body.classList.add('dark-theme');
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      }
    }
    
    function initializeTheme() {
      const savedTheme = getData(STORAGE_KEYS.CURRENT_THEME) || 'light';
      applyTheme(savedTheme);
    }

    // Sidebar Functions
    function toggleSidebar() {
      document.body.classList.toggle('sidebar-collapsed');
    }

    // ===== STUDENT MANAGEMENT FUNCTIONS =====
    function initializeSampleStudents() {
      const sampleStudents = [
        { id: 1, name: 'Sarah Johnson', email: 'sarah.johnson@university.edu', phone: '+1-555-0101', dob: '2000-03-15', status: 'active', attendance: 95, progress: 87, enrollmentDate: '2024-01-10' },
        { id: 2, name: 'Michael Chen', email: 'michael.chen@university.edu', phone: '+1-555-0102', dob: '1999-07-22', status: 'active', attendance: 88, progress: 92, enrollmentDate: '2024-01-12' },
        { id: 3, name: 'Emily Rodriguez', email: 'emily.rodriguez@university.edu', phone: '+1-555-0103', dob: '2001-11-08', status: 'active', attendance: 92, progress: 78, enrollmentDate: '2024-01-08' },
        { id: 4, name: 'David Kim', email: 'david.kim@university.edu', phone: '+1-555-0104', dob: '2000-05-30', status: 'active', attendance: 85, progress: 85, enrollmentDate: '2024-01-15' },
        { id: 5, name: 'Lisa Thompson', email: 'lisa.thompson@university.edu', phone: '+1-555-0105', dob: '1999-12-14', status: 'active', attendance: 90, progress: 91, enrollmentDate: '2024-01-11' },
        { id: 6, name: 'Robert Zhang', email: 'robert.zhang@university.edu', phone: '+1-555-0106', dob: '2000-09-03', status: 'active', attendance: 87, progress: 83, enrollmentDate: '2024-01-13' },
        { id: 7, name: 'Jennifer Davis', email: 'jennifer.davis@university.edu', phone: '+1-555-0107', dob: '2001-01-25', status: 'active', attendance: 93, progress: 89, enrollmentDate: '2024-01-14' },
        { id: 8, name: 'Christopher Lee', email: 'christopher.lee@university.edu', phone: '+1-555-0108', dob: '1999-08-17', status: 'active', attendance: 89, progress: 76, enrollmentDate: '2024-01-16' },
        { id: 9, name: 'Amanda Wilson', email: 'amanda.wilson@university.edu', phone: '+1-555-0109', dob: '2000-04-12', status: 'active', attendance: 91, progress: 94, enrollmentDate: '2024-01-17' },
        { id: 10, name: 'Kevin Patel', email: 'kevin.patel@university.edu', phone: '+1-555-0110', dob: '2001-06-28', status: 'active', attendance: 86, progress: 81, enrollmentDate: '2024-01-18' },
        { id: 11, name: 'Alex Martinez', email: 'alex.martinez@university.edu', phone: '+1-555-0111', dob: '2000-02-09', status: 'active', attendance: 94, progress: 88, enrollmentDate: '2024-01-18' },
        { id: 12, name: 'Jessica Wang', email: 'jessica.wang@university.edu', phone: '+1-555-0112', dob: '1999-10-31', status: 'active', attendance: 90, progress: 85, enrollmentDate: '2024-01-19' },
        { id: 13, name: 'Ryan O\'Connor', email: 'ryan.oconnor@university.edu', phone: '+1-555-0113', dob: '2001-03-07', status: 'active', attendance: 88, progress: 79, enrollmentDate: '2024-01-20' },
        { id: 14, name: 'Maria Garcia', email: 'maria.garcia@university.edu', phone: '+1-555-0114', dob: '2000-07-19', status: 'active', attendance: 92, progress: 87, enrollmentDate: '2024-01-21' },
        { id: 15, name: 'James Wilson', email: 'james.wilson@university.edu', phone: '+1-555-0115', dob: '1999-12-05', status: 'active', attendance: 85, progress: 82, enrollmentDate: '2024-01-22' }
      ];
      
      setData(STORAGE_KEYS.STUDENTS, sampleStudents);
      renderStudentManagement();
    }

    function openStudentModal(editId = null) {
      const modal = document.getElementById('student-modal');
      const title = document.getElementById('student-modal-title');
      const form = document.getElementById('student-form');
      
      if (editId !== null) {
        title.textContent = 'Edit Student';
        const students = JSON.parse(localStorage.getItem('students') || '[]');
        const student = students[editId];
        if (student) {
          const [firstName, ...lastNameParts] = student.name.split(' ');
          const lastName = lastNameParts.join(' ');
          document.getElementById('student-firstname').value = firstName;
          document.getElementById('student-lastname').value = lastName;
          document.getElementById('student-email').value = student.email;
          document.getElementById('student-phone').value = student.phone || '';
          document.getElementById('student-dob').value = student.dob || '';
          document.getElementById('student-status').value = student.status || 'active';
          form.dataset.editId = editId;
        }
      } else {
        title.textContent = 'Add New Student';
        form.reset();
        delete form.dataset.editId;
      }
      
      modal.style.display = 'flex';
    }

    function saveStudent() {
      const form = document.getElementById('student-form');
      const editId = form.dataset.editId;
      
      const studentData = {
        firstName: document.getElementById('student-firstname').value.trim(),
        lastName: document.getElementById('student-lastname').value.trim(),
        email: document.getElementById('student-email').value.trim(),
        phone: document.getElementById('student-phone').value.trim(),
        dob: document.getElementById('student-dob').value,
        status: document.getElementById('student-status').value,
        attendance: 0,
        progress: 0,
        enrollmentDate: new Date().toISOString().split('T')[0]
      };
      
      if (!studentData.firstName || !studentData.lastName || !studentData.email) {
        alert('First name, last name, and email are required!');
        return;
      }
      
      studentData.name = `${studentData.firstName} ${studentData.lastName}`;
      
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      
      if (editId !== undefined) {
        // Update existing student
        const index = parseInt(editId);
        if (index >= 0 && index < students.length) {
          studentData.id = students[index].id;
          studentData.attendance = students[index].attendance || 0;
          studentData.progress = students[index].progress || 0;
          studentData.enrollmentDate = students[index].enrollmentDate;
          students[index] = studentData;
        }
      } else {
        // Create new student
        studentData.id = students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1;
        students.push(studentData);
      }
      
      setData(STORAGE_KEYS.STUDENTS, students);
      closeModal('student-modal');
      renderStudentManagement();
      showNotification(editId !== undefined ? 'Student updated successfully!' : 'Student added successfully!', 'success');
    }

    function viewStudentDetails(studentIndex) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const student = students[studentIndex];
      
      if (!student) return;
      
      const enrolledCourses = courses.filter(course => 
        course.students && course.students.some(s => s.email === student.email)
      );
      
      const modal = document.getElementById('student-details-modal');
      const content = document.getElementById('student-details-content');
      
      content.innerHTML = `
        <div class='student-details'>
          <div class='student-header mb-20'>
            <div class='flex flex-center gap-16'>
              <div class='student-avatar-large'>${student.name.split(' ').map(n => n[0]).join('')}</div>
              <div>
                <h2>${student.name}</h2>
                <p class='text-muted'>Student ID: ${student.id}</p>
                <p class='text-muted'>${student.email}</p>
              </div>
            </div>
            <div class='student-actions-header'>
              <button class='btn btn-secondary' onclick='messageStudent(${studentIndex})'>
                <i class='fas fa-envelope'></i> Message
              </button>
              <button class='btn btn-secondary' onclick='editStudent(${studentIndex})'>
                <i class='fas fa-edit'></i> Edit
              </button>
            </div>
          </div>
          
          <div class='grid-2 gap-20 mb-20'>
            <div class='card'>
              <h4>Personal Information</h4>
              <div class='info-grid'>
                <div class='info-item'>
                  <label>Phone:</label>
                  <span>${student.phone || 'Not provided'}</span>
                </div>
                <div class='info-item'>
                  <label>Date of Birth:</label>
                  <span>${student.dob ? new Date(student.dob).toLocaleDateString() : 'Not provided'}</span>
                </div>
                <div class='info-item'>
                  <label>Status:</label>
                  <span class='badge ${getStatusBadge(student.status)}'>${student.status}</span>
                </div>
                <div class='info-item'>
                  <label>Enrollment Date:</label>
                  <span>${new Date(student.enrollmentDate).toLocaleDateString()}</span>
                </div>
              </div>
            </div>
            
            <div class='card'>
              <h4>Academic Performance</h4>
              <div class='performance-grid'>
                <div class='performance-item'>
                  <label>Attendance Rate:</label>
                  <div class='flex flex-center gap-10'>
                    <div class='progress-bar' style='width: 100px;'>
                      <div class='progress-fill' style='width: ${student.attendance || 0}%'></div>
                    </div>
                    <span>${student.attendance || 0}%</span>
                  </div>
                </div>
                <div class='performance-item'>
                  <label>Overall Progress:</label>
                  <div class='flex flex-center gap-10'>
                    <div class='progress-bar' style='width: 100px;'>
                      <div class='progress-fill' style='width: ${student.progress || 0}%'></div>
                    </div>
                    <span>${student.progress || 0}%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class='card'>
            <h4>Enrolled Courses (${enrolledCourses.length})</h4>
            ${enrolledCourses.length > 0 ? enrolledCourses.map(course => `
              <div class='enrolled-course-item'>
                <div class='course-info'>
                  <h5>${course.title} <span class='course-code'>${course.code}</span></h5>
                  <p class='text-muted'>${course.description || 'No description'}</p>
                </div>
                <div class='course-progress'>
                  <div class='progress-bar'>
                    <div class='progress-fill' style='width: ${Math.floor(Math.random() * 30) + 70}%'></div>
                  </div>
                  <small>${Math.floor(Math.random() * 30) + 70}% complete</small>
                </div>
              </div>
            `).join('') : '<p class="text-muted">No courses enrolled</p>'}
          </div>
        </div>
        
        <style>
          .student-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: 600;
          }
          .student-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
          }
          .student-actions-header {
            display: flex;
            gap: 8px;
          }
          .info-grid {
            display: grid;
            gap: 12px;
          }
          .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--glass-border);
          }
          .performance-grid {
            display: grid;
            gap: 16px;
          }
          .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          .enrolled-course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            margin-bottom: 12px;
          }
          .course-info h5 {
            margin-bottom: 4px;
          }
          .course-progress {
            text-align: right;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function openAttendanceModal() {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      const modal = document.getElementById('attendance-modal');
      const content = document.getElementById('attendance-content');
      
      content.innerHTML = `
        <div class='attendance-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Mark Attendance</h3>
            <div class='flex gap-10'>
              <input type='date' id='attendance-date' class='form-control' value='${new Date().toISOString().split('T')[0]}'>
              <select id='attendance-course' class='form-control'>
                <option value=''>Select Course</option>
                ${courses.map(course => `<option value='${course.id}'>${course.title}</option>`).join('')}
              </select>
            </div>
          </div>
          
          <div id='attendance-list'>
            <p class='text-muted text-center'>Select a course to mark attendance</p>
          </div>
        </div>
      `;
      
      modal.style.display = 'flex';
      
      // Handle course selection
      document.getElementById('attendance-course').addEventListener('change', function() {
        const courseId = this.value;
        if (!courseId) {
          document.getElementById('attendance-list').innerHTML = '<p class="text-muted text-center">Select a course to mark attendance</p>';
          return;
        }
        
        const course = courses.find(c => c.id === parseInt(courseId));
        if (!course || !course.students) {
          document.getElementById('attendance-list').innerHTML = '<p class="text-muted text-center">No students enrolled in this course</p>';
          return;
        }
        
        const attendanceList = course.students.map(student => `
          <div class='attendance-item'>
            <div class='student-info'>
              <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
              <div>
                <div class='student-name'>${student.name}</div>
                <div class='student-email'>${student.email}</div>
              </div>
            </div>
            <div class='attendance-options'>
              <label class='attendance-option'>
                <input type='radio' name='attendance-${student.id}' value='present' checked>
                <span class='attendance-status status-present'>Present</span>
              </label>
              <label class='attendance-option'>
                <input type='radio' name='attendance-${student.id}' value='absent'>
                <span class='attendance-status status-absent'>Absent</span>
              </label>
              <label class='attendance-option'>
                <input type='radio' name='attendance-${student.id}' value='late'>
                <span class='attendance-status status-late'>Late</span>
              </label>
            </div>
          </div>
        `).join('');
        
        document.getElementById('attendance-list').innerHTML = `
          <div class='attendance-grid'>
            ${attendanceList}
          </div>
          <button class='btn' onclick='saveAttendance()'>Save Attendance</button>
        `;
      });
    }

    function saveAttendance() {
      const courseId = document.getElementById('attendance-course').value;
      const date = document.getElementById('attendance-date').value;
      
      if (!courseId || !date) {
        alert('Please select a course and date');
        return;
      }
      
      // In a real application, you would save attendance to a database
      // For now, we'll just show a success message
      showNotification('Attendance saved successfully!', 'success');
      closeModal('attendance-modal');
    }

    function messageStudent(studentIndex) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students[studentIndex];
      
      if (!student) return;
      
      // Store the student index for the send function
      document.getElementById('message-modal').dataset.studentIndex = studentIndex;
      
      // Update modal title
      document.querySelector('#message-modal h2').textContent = `Send Message to ${student.name}`;
      
      // Clear previous message
      document.getElementById('message-subject').value = '';
      document.getElementById('message-content').value = '';
      document.getElementById('message-priority').value = 'normal';
      
      document.getElementById('message-modal').style.display = 'flex';
    }

    function sendMessage() {
      const studentIndex = document.getElementById('message-modal').dataset.studentIndex;
      const subject = document.getElementById('message-subject').value.trim();
      const content = document.getElementById('message-content').value.trim();
      const priority = document.getElementById('message-priority').value;
      
      if (!subject || !content) {
        alert('Subject and message are required!');
        return;
      }
      
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students[studentIndex];
      
      // In a real application, you would send the message via email/SMS
      // For now, we'll just show a success message
      showNotification(`Message sent to ${student.name}!`, 'success');
      closeModal('message-modal');
    }

    function sendBulkAnnouncement() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      
      const modal = document.getElementById('announcement-modal');
      const title = document.getElementById('announcement-modal-title');
      const recipientsSelect = document.getElementById('announcement-recipients-input');
      
      title.textContent = 'Send Announcement to Students';
      
      // Update recipients options
      recipientsSelect.innerHTML = `
        <option value='all'>All Students (${students.length})</option>
        ${courses.map(course => `<option value='course-${course.id}'>${course.title} Students (${course.students?.length || 0})</option>`).join('')}
        <option value='active'>Active Students Only</option>
      `;
      
      modal.style.display = 'flex';
      document.getElementById('save-announcement-btn').onclick = saveBulkAnnouncement;
    }

    function saveBulkAnnouncement() {
      const title = document.getElementById('announcement-title-input').value.trim();
      const content = document.getElementById('announcement-content-input').value.trim();
      const recipients = document.getElementById('announcement-recipients-input').value;
      const priority = document.getElementById('announcement-priority-input').value;
      
      if (!title || !content) {
        alert('Title and content are required!');
        return;
      }
      
      let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      const announcement = {
        title,
        content,
        recipients,
        priority,
        date: new Date().toISOString(),
        type: 'bulk'
      };
      
      announcements.push(announcement);
      setData(STORAGE_KEYS.ANNOUNCEMENTS, announcements);
      
      closeModal('announcement-modal');
      showNotification('Announcement sent successfully!', 'success');
    }

    function editStudent(studentIndex) {
      openStudentModal(studentIndex);
    }

    function removeStudent(studentIndex) {
      if (confirm('Are you sure you want to remove this student? This action cannot be undone.')) {
        let students = JSON.parse(localStorage.getItem('students') || '[]');
        students.splice(studentIndex, 1);
        localStorage.setItem('students', JSON.stringify(students));
        renderStudentManagement();
        showNotification('Student removed successfully!', 'success');
      }
    }

    function viewCourseStudents(courseId) {
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === courseId);
      
      if (!course) return;
      
      const modal = document.getElementById('student-details-modal');
      const content = document.getElementById('student-details-content');
      
      content.innerHTML = `
        <div class='course-students-view'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Students in ${course.title}</h3>
            <button class='btn btn-secondary' onclick='closeModal("student-details-modal")'>Close</button>
          </div>
          
          <div class='students-grid'>
            ${course.students?.length > 0 ? course.students.map(student => `
              <div class='student-card'>
                <div class='student-card-header'>
                  <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                  <div class='student-info'>
                    <h5>${student.name}</h5>
                    <p>${student.email}</p>
                  </div>
                </div>
                <div class='student-card-actions'>
                  <button class='btn btn-sm btn-secondary' onclick='messageStudent(${students.findIndex(s => s.email === student.email)})'>
                    <i class='fas fa-envelope'></i>
                  </button>
                  <button class='btn btn-sm btn-secondary' onclick='viewStudentDetails(${students.findIndex(s => s.email === student.email)})'>
                    <i class='fas fa-eye'></i>
                  </button>
                </div>
              </div>
            `).join('') : '<p class="text-muted text-center">No students enrolled in this course</p>'}
          </div>
        </div>
        
        <style>
          .students-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
          }
          .student-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
          }
          .student-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
          }
          .student-card-actions {
            display: flex;
            gap: 8px;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    // Utility functions
    function calculateAverageAttendance() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      const total = students.reduce((sum, student) => sum + (student.attendance || 0), 0);
      return Math.round(total / students.length);
    }

    function calculateAverageProgress() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      const total = students.reduce((sum, student) => sum + (student.progress || 0), 0);
      return Math.round(total / students.length);
    }

    function getAttendanceBadge(attendance) {
      if (attendance >= 90) return 'badge-success';
      if (attendance >= 80) return 'badge-primary';
      if (attendance >= 70) return 'badge-warning';
      return 'badge-danger';
    }

    function getStatusBadge(status) {
      switch (status) {
        case 'active': return 'badge-success';
        case 'inactive': return 'badge-warning';
        case 'suspended': return 'badge-danger';
        default: return 'badge-secondary';
      }
    }

    function initStudentManagementEvents() {
      // Student form submission
      document.getElementById('student-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveStudent();
      });
      
      // Search functionality
      document.getElementById('student-search').addEventListener('input', function() {
        filterStudents();
      });
      
      // Course filter
      document.getElementById('course-filter').addEventListener('change', function() {
        filterStudents();
      });
    }

    function filterStudents() {
      const searchTerm = document.getElementById('student-search').value.toLowerCase();
      const courseFilter = document.getElementById('course-filter').value;
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      
      let filteredStudents = students;
      
      // Apply search filter
      if (searchTerm) {
        filteredStudents = filteredStudents.filter(student => 
          student.name.toLowerCase().includes(searchTerm) || 
          student.email.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply course filter
      if (courseFilter) {
        const course = courses.find(c => c.id === parseInt(courseFilter));
        if (course && course.students) {
          const courseStudentEmails = course.students.map(s => s.email);
          filteredStudents = filteredStudents.filter(student => 
            courseStudentEmails.includes(student.email)
          );
        }
      }
      
      // Update table
      const tbody = document.getElementById('students-table-body');
      if (filteredStudents.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No students found</td></tr>';
      } else {
        tbody.innerHTML = filteredStudents.map((student, index) => {
          const originalIndex = students.findIndex(s => s.id === student.id);
          const enrolledCourses = courses.filter(course => 
            course.students && course.students.some(s => s.email === student.email)
          );
          
          return `
            <tr class='student-row' onclick='viewStudentDetails(${originalIndex})'>
              <td>
                <div class='flex flex-center gap-10'>
                  <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                  <div>
                    <div class='student-name'>${student.name}</div>
                    <div class='student-id'>ID: ${student.id || 'N/A'}</div>
                  </div>
                </div>
              </td>
              <td>${student.email}</td>
              <td>
                <div class='enrolled-courses'>
                  ${enrolledCourses.length > 0 ? enrolledCourses.map(course => 
                    `<span class='badge badge-primary'>${course.code}</span>`
                  ).join(' ') : '<span class="text-muted">No courses</span>'}
                </div>
              </td>
              <td>
                <span class='badge ${getAttendanceBadge(student.attendance || 0)}'>${student.attendance || 0}%</span>
              </td>
              <td>
                <div class='progress-bar'>
                  <div class='progress-fill' style='width: ${student.progress || 0}%'></div>
                </div>
                <small>${student.progress || 0}%</small>
              </td>
              <td>
                <span class='badge ${getStatusBadge(student.status || 'active')}'>${student.status || 'active'}</span>
              </td>
              <td>
                <div class='student-actions'>
                  <button class='btn btn-sm btn-secondary' onclick='event.stopPropagation(); messageStudent(${originalIndex})'>
                    <i class='fas fa-envelope'></i>
                  </button>
                  <button class='btn btn-sm btn-secondary' onclick='event.stopPropagation(); editStudent(${originalIndex})'>
                    <i class='fas fa-edit'></i>
                  </button>
                  <button class='btn btn-sm btn-danger' onclick='event.stopPropagation(); removeStudent(${originalIndex})'>
                    <i class='fas fa-trash'></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      }
    }

    // Course management functions are already implemented above
    // These placeholder functions have been removed to prevent conflicts
    // ===== ASSIGNMENT MANAGEMENT FUNCTIONS =====
    function initializeSampleAssignments() {
      const sampleAssignments = [
        {
          id: 1,
          title: 'Calculus Problem Set 1',
          description: 'Complete problems 1-15 from Chapter 2. Focus on limits and continuity.',
          courseId: 1,
          courseName: 'Advanced Mathematics',
          dueDate: '2024-02-15T23:59:00',
          points: 100,
          type: 'homework',
          instructions: 'Show all work clearly. Use proper mathematical notation. Submit as PDF.',
          totalStudents: 10,
          submissions: [
            { studentId: 1, studentName: 'Sarah Johnson', submittedAt: '2024-02-14T15:30:00', status: 'submitted', grade: 95, feedback: 'Excellent work! Clear solutions and proper notation.' },
            { studentId: 2, studentName: 'Michael Chen', submittedAt: '2024-02-15T10:15:00', status: 'submitted', grade: 88, feedback: 'Good work overall. Minor errors in problem 7.' },
            { studentId: 3, studentName: 'Emily Rodriguez', submittedAt: '2024-02-15T22:45:00', status: 'late', grade: 82, feedback: 'Submitted late. Solutions are correct but incomplete.' },
            { studentId: 4, studentName: 'David Kim', submittedAt: '2024-02-14T18:20:00', status: 'submitted', grade: 91, feedback: 'Very good work. Clear understanding of concepts.' },
            { studentId: 5, studentName: 'Lisa Thompson', submittedAt: '2024-02-15T23:30:00', status: 'submitted', grade: 87, feedback: 'Good effort. Need more practice with limits.' }
          ],
          graded: true,
          createdAt: '2024-01-20T10:00:00'
        },
        {
          id: 2,
          title: 'Python Programming Project',
          description: 'Create a simple calculator application using Python with GUI.',
          courseId: 2,
          courseName: 'Introduction to Computer Science',
          dueDate: '2024-02-20T23:59:00',
          points: 150,
          type: 'project',
          instructions: 'Use tkinter for GUI. Include basic arithmetic operations. Add error handling.',
          totalStudents: 10,
          submissions: [
            { studentId: 11, studentName: 'Alex Martinez', submittedAt: '2024-02-19T14:20:00', status: 'submitted', grade: 145, feedback: 'Excellent project! Clean code and great UI design.' },
            { studentId: 12, studentName: 'Jessica Wang', submittedAt: '2024-02-20T16:45:00', status: 'submitted', grade: 138, feedback: 'Very good implementation. Minor UI improvements needed.' },
            { studentId: 13, studentName: 'Ryan O\'Connor', submittedAt: '2024-02-20T22:10:00', status: 'submitted', grade: 132, feedback: 'Good work. Error handling could be improved.' },
            { studentId: 14, studentName: 'Maria Garcia', submittedAt: '2024-02-21T01:15:00', status: 'late', grade: 120, feedback: 'Submitted late. Basic functionality works but needs refinement.' }
          ],
          graded: true,
          createdAt: '2024-01-25T09:00:00'
        },
        {
          id: 3,
          title: 'Literary Analysis Essay',
          description: 'Write a 1500-word essay analyzing themes in Shakespeare\'s "Hamlet".',
          courseId: 3,
          courseName: 'World Literature',
          dueDate: '2024-02-25T23:59:00',
          points: 100,
          type: 'essay',
          instructions: 'Focus on one major theme. Use proper citations. Include thesis statement.',
          totalStudents: 10,
          submissions: [
            { studentId: 21, studentName: 'Sophie Anderson', submittedAt: '2024-02-24T11:30:00', status: 'submitted', grade: 92, feedback: 'Excellent analysis! Strong thesis and well-supported arguments.' },
            { studentId: 22, studentName: 'Daniel Brown', submittedAt: '2024-02-25T20:15:00', status: 'submitted', grade: 85, feedback: 'Good essay. Could strengthen the conclusion.' },
            { studentId: 23, studentName: 'Rachel Green', submittedAt: '2024-02-26T02:30:00', status: 'late', grade: 78, feedback: 'Submitted late. Good content but needs better organization.' }
          ],
          graded: false,
          createdAt: '2024-02-01T14:00:00'
        },
        {
          id: 4,
          title: 'Physics Lab Report',
          description: 'Write a lab report on the pendulum experiment.',
          courseId: 4,
          courseName: 'Physics for Engineers',
          dueDate: '2024-02-28T23:59:00',
          points: 80,
          type: 'lab',
          instructions: 'Include data analysis, graphs, and conclusions. Follow lab report format.',
          totalStudents: 10,
          submissions: [],
          graded: false,
          createdAt: '2024-02-05T16:00:00'
        },
        {
          id: 5,
          title: 'Business Ethics Case Study',
          description: 'Analyze the ethical implications of a corporate decision.',
          courseId: 5,
          courseName: 'Business Ethics and Corporate Social Responsibility',
          dueDate: '2024-03-05T23:59:00',
          points: 120,
          type: 'case-study',
          instructions: 'Choose a recent business case. Apply ethical frameworks. Provide recommendations.',
          totalStudents: 10,
          submissions: [],
          graded: false,
          createdAt: '2024-02-10T11:00:00'
        }
      ];
      
      localStorage.setItem('assignments', JSON.stringify(sampleAssignments));
      renderAssessmentTools();
    }

    function openAssignmentModal(editId = null) {
      const modal = document.getElementById('assignment-modal');
      const title = document.getElementById('assignment-modal-title');
      const form = document.getElementById('assignment-form');
      
      if (editId !== null) {
        title.textContent = 'Edit Assignment';
        const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
        const assignment = assignments.find(a => a.id === editId);
        if (assignment) {
          document.getElementById('assignment-title').value = assignment.title;
          document.getElementById('assignment-description').value = assignment.description || '';
          document.getElementById('assignment-course').value = assignment.courseId;
          document.getElementById('assignment-due-date').value = assignment.dueDate.replace(' ', 'T');
          document.getElementById('assignment-points').value = assignment.points;
          document.getElementById('assignment-type').value = assignment.type;
          document.getElementById('assignment-instructions').value = assignment.instructions || '';
          form.dataset.editId = editId;
        }
      } else {
        title.textContent = 'Create New Assignment';
        form.reset();
        delete form.dataset.editId;
      }
      
      modal.style.display = 'flex';
    }

    function saveAssignment() {
      const form = document.getElementById('assignment-form');
      const editId = form.dataset.editId;
      
      const assignmentData = {
        title: document.getElementById('assignment-title').value.trim(),
        description: document.getElementById('assignment-description').value.trim(),
        courseId: parseInt(document.getElementById('assignment-course').value),
        dueDate: document.getElementById('assignment-due-date').value,
        points: parseInt(document.getElementById('assignment-points').value),
        type: document.getElementById('assignment-type').value,
        instructions: document.getElementById('assignment-instructions').value.trim(),
        submissions: [],
        graded: false,
        createdAt: new Date().toISOString()
      };
      
      // Get course name
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === assignmentData.courseId);
      assignmentData.courseName = course ? course.title : 'Unknown Course';
      assignmentData.totalStudents = course ? (course.students?.length || 0) : 0;
      
      if (!assignmentData.title || !assignmentData.courseId || !assignmentData.dueDate) {
        alert('Title, course, and due date are required!');
        return;
      }
      
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      if (editId !== undefined) {
        // Update existing assignment
        const index = assignments.findIndex(a => a.id === parseInt(editId));
        if (index !== -1) {
          assignmentData.id = parseInt(editId);
          assignmentData.submissions = assignments[index].submissions || [];
          assignmentData.graded = assignments[index].graded;
          assignmentData.createdAt = assignments[index].createdAt;
          assignments[index] = assignmentData;
        }
      } else {
        // Create new assignment
        assignmentData.id = assignments.length > 0 ? Math.max(...assignments.map(a => a.id)) + 1 : 1;
        assignments.push(assignmentData);
      }
      
      localStorage.setItem('assignments', JSON.stringify(assignments));
      closeModal('assignment-modal');
      renderAssessmentTools();
      showNotification(editId !== undefined ? 'Assignment updated successfully!' : 'Assignment created successfully!', 'success');
    }

    function viewAssignmentDetails(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('assignment-details-modal');
      const content = document.getElementById('assignment-details-content');
      
      content.innerHTML = `
        <div class='assignment-details'>
          <div class='assignment-header-details mb-20'>
            <h2>${assignment.title}</h2>
            <p class='text-muted'>${assignment.description || 'No description available'}</p>
            <div class='assignment-meta-details'>
              <span class='badge badge-primary'><i class='fas fa-book'></i> ${assignment.courseName}</span>
              <span class='badge badge-info'><i class='fas fa-calendar'></i> Due: ${new Date(assignment.dueDate).toLocaleString()}</span>
              <span class='badge badge-warning'><i class='fas fa-star'></i> ${assignment.points} Points</span>
              <span class='badge badge-secondary'><i class='fas fa-tag'></i> ${assignment.type}</span>
            </div>
          </div>
          
          <div class='grid-2 gap-20 mb-20'>
            <div class='card'>
              <h4>Submission Statistics</h4>
              <div class='stats-grid'>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.length || 0}</div>
                  <div class='stat-label'>Submitted</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.totalStudents - (assignment.submissions?.length || 0)}</div>
                  <div class='stat-label'>Missing</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.filter(s => s.status === 'late').length || 0}</div>
                  <div class='stat-label'>Late</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.filter(s => s.grade).length || 0}</div>
                  <div class='stat-label'>Graded</div>
                </div>
              </div>
            </div>
            
            <div class='card'>
              <h4>Instructions</h4>
              <div class='instructions-content'>
                ${assignment.instructions || 'No specific instructions provided.'}
              </div>
            </div>
          </div>
          
          <div class='assignment-actions-details'>
            <button class='btn btn-secondary' onclick='viewSubmissions(${assignment.id})'>View Submissions</button>
            <button class='btn btn-secondary' onclick='gradeAssignment(${assignment.id})'>Grade Submissions</button>
            <button class='btn btn-secondary' onclick='editAssignment(${assignment.id})'>Edit Assignment</button>
            <button class='btn btn-danger' onclick='deleteAssignment(${assignment.id})'>Delete Assignment</button>
          </div>
        </div>
        
        <style>
          .assignment-header-details h2 {
            margin-bottom: 8px;
          }
          .assignment-meta-details {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
          }
          .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
          }
          .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--glass);
            border-radius: 8px;
          }
          .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
          }
          .stat-label {
            font-size: 0.9em;
            color: var(--text-light);
          }
          .instructions-content {
            line-height: 1.6;
            color: var(--text-light);
          }
          .assignment-actions-details {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function viewSubmissions(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('submissions-modal');
      const content = document.getElementById('submissions-content');
      
      // Get all students enrolled in the course
      const courseStudents = students.filter(student => {
        const courses = JSON.parse(localStorage.getItem('courses') || '[]');
        const course = courses.find(c => c.id === assignment.courseId);
        return course && course.students && course.students.some(s => s.email === student.email);
      });
      
      content.innerHTML = `
        <div class='submissions-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Submissions - ${assignment.title}</h3>
            <div class='flex gap-10'>
              <span class='badge badge-primary'>${assignment.submissions?.length || 0} Submitted</span>
              <span class='badge badge-warning'>${courseStudents.length - (assignment.submissions?.length || 0)} Missing</span>
            </div>
          </div>
          
          <div class='submissions-list'>
            ${courseStudents.map(student => {
              const submission = assignment.submissions?.find(s => s.studentId === student.id);
              const isLate = submission && new Date(submission.submittedAt) > new Date(assignment.dueDate);
              
              return `
                <div class='submission-item'>
                  <div class='submission-header'>
                    <div class='submission-student'>
                      <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                      <div>
                        <div class='student-name'>${student.name}</div>
                        <div class='student-email'>${student.email}</div>
                      </div>
                    </div>
                    <div class='submission-status-group'>
                      ${submission ? `
                        <span class='submission-status ${isLate ? 'status-late' : 'status-submitted'}'>
                          ${isLate ? 'Late' : 'Submitted'}
                        </span>
                        <span class='text-muted'>${new Date(submission.submittedAt).toLocaleString()}</span>
                      ` : `
                        <span class='submission-status status-missing'>Missing</span>
                      `}
                    </div>
                  </div>
                  
                  ${submission ? `
                    <div class='submission-content'>
                      <div class='submission-file'>
                        <i class='fas fa-file-pdf'></i>
                        <span>${student.name}_assignment_${assignment.id}.pdf</span>
                        <button class='btn btn-sm btn-secondary' onclick='downloadSubmission(${assignment.id}, ${student.id})'>
                          <i class='fas fa-download'></i> Download
                        </button>
                      </div>
                      ${submission.grade ? `
                        <div class='submission-grade'>
                          <strong>Grade: ${submission.grade}/${assignment.points}</strong>
                          <div class='grade-feedback'>${submission.feedback}</div>
                        </div>
                      ` : `
                        <button class='btn btn-sm btn-primary' onclick='gradeSubmission(${assignment.id}, ${student.id})'>
                          <i class='fas fa-star'></i> Grade
                        </button>
                      `}
                    </div>
                  ` : `
                    <div class='submission-missing'>
                      <p class='text-muted'>No submission received</p>
                    </div>
                  `}
                </div>
              `;
            }).join('')}
          </div>
        </div>
        
        <style>
          .submission-status-group {
            text-align: right;
          }
          .submission-content {
            margin-top: 12px;
          }
          .submission-file {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
          }
          .submission-grade {
            margin-top: 8px;
            padding: 8px;
            background: var(--medium-gray);
            border-radius: 4px;
          }
          .grade-feedback {
            margin-top: 4px;
            font-size: 0.9em;
            color: var(--text-light);
          }
          .submission-missing {
            margin-top: 12px;
            padding: 12px;
            background: var(--medium-gray);
            border-radius: 4px;
            text-align: center;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function gradeAssignment(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('grading-modal');
      const content = document.getElementById('grading-content');
      
      // Get students with submissions
      const submissions = assignment.submissions || [];
      
      content.innerHTML = `
        <div class='grading-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Grade Submissions - ${assignment.title}</h3>
            <span class='badge badge-primary'>${submissions.length} Submissions</span>
          </div>
          
          <div class='grading-forms'>
            ${submissions.map(submission => `
              <div class='grading-form'>
                <div class='grading-header'>
                  <div class='grading-student'>
                    <div class='student-avatar'>${submission.studentName.split(' ').map(n => n[0]).join('')}</div>
                    <div>
                      <div class='student-name'>${submission.studentName}</div>
                      <div class='submission-time'>Submitted: ${new Date(submission.submittedAt).toLocaleString()}</div>
                    </div>
                  </div>
                  <div class='grading-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='downloadSubmission(${assignment.id}, ${submission.studentId})'>
                      <i class='fas fa-download'></i> Download
                    </button>
                  </div>
                </div>
                
                <div class='grading-inputs'>
                  <div class='form-group'>
                    <label>Grade (out of ${assignment.points})</label>
                    <input type='number' class='form-control grade-input' id='grade-${submission.studentId}' 
                           value='${submission.grade || ''}' min='0' max='${assignment.points}'>
                  </div>
                  <div class='form-group'>
                    <label>Feedback</label>
                    <textarea class='form-control' id='feedback-${submission.studentId}' rows='3' 
                              placeholder='Provide feedback for this student...'>${submission.feedback || ''}</textarea>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
          
          <div class='grading-actions-footer'>
            <button class='btn btn-secondary' onclick='closeModal("grading-modal")'>Cancel</button>
            <button class='btn' onclick='saveGrades(${assignment.id})'>Save All Grades</button>
          </div>
        </div>
        
        <style>
          .grading-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
          }
          .grading-student {
            display: flex;
            align-items: center;
            gap: 12px;
          }
          .submission-time {
            font-size: 0.9em;
            color: var(--text-light);
          }
          .grading-inputs {
            display: grid;
            gap: 12px;
          }
          .grading-actions-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function saveGrades(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignmentIndex = assignments.findIndex(a => a.id === assignmentId);
      
      if (assignmentIndex === -1) return;
      
      const assignment = assignments[assignmentIndex];
      let allGraded = true;
      
      // Update grades for each submission
      assignment.submissions.forEach(submission => {
        const grade = document.getElementById(`grade-${submission.studentId}`).value;
        const feedback = document.getElementById(`feedback-${submission.studentId}`).value;
        
        if (grade && grade >= 0 && grade <= assignment.points) {
          submission.grade = parseInt(grade);
          submission.feedback = feedback;
        } else {
          allGraded = false;
        }
      });
      
      assignment.graded = allGraded;
      assignments[assignmentIndex] = assignment;
      
      localStorage.setItem('assignments', JSON.stringify(assignments));
      closeModal('grading-modal');
      renderAssessmentTools();
      showNotification('Grades saved successfully!', 'success');
    }

    function gradeSubmission(assignmentId, studentId) {
      // This would open a focused grading interface for a single student
      alert('Individual grading interface would open here');
    }

    function downloadSubmission(assignmentId, studentId) {
      // Mock download functionality
      showNotification('Download started...', 'info');
    }

    function downloadAssignment(assignmentId) {
      // Mock download functionality
      showNotification('Assignment file download started...', 'info');
    }

    function editAssignment(assignmentId) {
      openAssignmentModal(assignmentId);
    }

    function deleteAssignment(assignmentId) {
      if (confirm('Are you sure you want to delete this assignment? This action cannot be undone.')) {
        let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
        assignments = assignments.filter(a => a.id !== assignmentId);
        localStorage.setItem('assignments', JSON.stringify(assignments));
        renderAssessmentTools();
        showNotification('Assignment deleted successfully!', 'success');
      }
    }

    function exportAssignments() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      let csv = 'Assignment Title,Course,Due Date,Type,Points,Submissions,Graded\n';
      assignments.forEach(assignment => {
        csv += `"${assignment.title}","${assignment.courseName}","${new Date(assignment.dueDate).toLocaleDateString()}","${assignment.type}",${assignment.points},${assignment.submissions?.length || 0},${assignment.graded ? 'Yes' : 'No'}\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'assignments_export.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function getOverdueAssignments() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const now = new Date();
      return assignments.filter(a => new Date(a.dueDate) < now && !a.graded);
    }

    function initAssignmentEvents() {
      // Assignment form submission
      document.getElementById('assignment-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveAssignment();
      });
      
      // Search functionality
      document.getElementById('assignment-search').addEventListener('input', function() {
        filterAssignments();
      });
      
      // Course filter
      document.getElementById('assignment-course-filter').addEventListener('change', function() {
        filterAssignments();
      });
      
      // Status filter
      document.getElementById('assignment-status-filter').addEventListener('change', function() {
        filterAssignments();
      });
    }

    function filterAssignments() {
      const searchTerm = document.getElementById('assignment-search').value.toLowerCase();
      const courseFilter = document.getElementById('assignment-course-filter').value;
      const statusFilter = document.getElementById('assignment-status-filter').value;
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      let filteredAssignments = assignments;
      
      // Apply search filter
      if (searchTerm) {
        filteredAssignments = filteredAssignments.filter(assignment => 
          assignment.title.toLowerCase().includes(searchTerm) || 
          assignment.description.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply course filter
      if (courseFilter) {
        filteredAssignments = filteredAssignments.filter(assignment => 
          assignment.courseId === parseInt(courseFilter)
        );
      }
      
      // Apply status filter
      if (statusFilter) {
        if (statusFilter === 'pending') {
          filteredAssignments = filteredAssignments.filter(assignment => !assignment.graded);
        } else if (statusFilter === 'graded') {
          filteredAssignments = filteredAssignments.filter(assignment => assignment.graded);
        } else if (statusFilter === 'overdue') {
          filteredAssignments = filteredAssignments.filter(assignment => 
            new Date(assignment.dueDate) < new Date() && !assignment.graded
          );
        }
      }
      
      // Update the assignments grid
      const assignmentsGrid = document.querySelector('.assignments-grid');
      if (filteredAssignments.length === 0) {
        assignmentsGrid.innerHTML = `
          <div class='card text-center'>
            <div class='card-icon'><i class='fas fa-search'></i></div>
            <h4>No Assignments Found</h4>
            <p class='text-muted mb-20'>Try adjusting your search criteria</p>
          </div>
        `;
      } else {
        assignmentsGrid.innerHTML = filteredAssignments.map((assignment, index) => `
          <div class='assignment-card' id='assignment-${assignment.id}'>
            <div class='assignment-header'>
              <div class='assignment-info'>
                <h4>${assignment.title}</h4>
                <p class='text-muted'>${assignment.description || 'No description available'}</p>
                <div class='assignment-meta'>
                  <span class='badge badge-primary'><i class='fas fa-book'></i> ${assignment.courseName || 'Unknown Course'}</span>
                  <span class='badge badge-info'><i class='fas fa-calendar'></i> Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                  <span class='badge ${assignment.graded ? 'badge-success' : 'badge-warning'}'>
                    <i class='fas ${assignment.graded ? 'fa-check-circle' : 'fa-clock'}'></i> 
                    ${assignment.graded ? 'Graded' : 'Pending'}
                  </span>
                </div>
              </div>
              <div class='assignment-actions'>
                <button class='btn btn-secondary' onclick='viewAssignmentDetails(${assignment.id})'>View Details</button>
                <button class='btn btn-secondary' onclick='editAssignment(${assignment.id})'>Edit</button>
                <button class='btn btn-danger' onclick='deleteAssignment(${assignment.id})'>Delete</button>
              </div>
            </div>
            
            <div class='assignment-progress mb-16'>
              <div class='progress-info'>
                <span>Submissions: ${assignment.submissions?.length || 0}/${assignment.totalStudents || 0}</span>
                <span>${assignment.submissions?.length > 0 ? Math.round((assignment.submissions.length / assignment.totalStudents) * 100) : 0}%</span>
              </div>
              <div class='progress-bar'>
                <div class='progress-fill' style='width: ${assignment.submissions?.length > 0 ? (assignment.submissions.length / assignment.totalStudents) * 100 : 0}%'></div>
              </div>
            </div>

            <div class='assignment-quick-actions'>
              <button class='btn btn-sm btn-secondary' onclick='gradeAssignment(${assignment.id})'>
                <i class='fas fa-star'></i> Grade Submissions
              </button>
              <button class='btn btn-sm btn-secondary' onclick='viewSubmissions(${assignment.id})'>
                <i class='fas fa-eye'></i> View Submissions
              </button>
              <button class='btn btn-sm btn-secondary' onclick='downloadAssignment(${assignment.id})'>
                <i class='fas fa-download'></i> Download
              </button>
            </div>
          </div>
        `).join('');
      }
    }

    // ===== ASSIGNMENT MANAGEMENT FUNCTIONS =====
    function initializeSampleAssignments() {
      const sampleAssignments = [
        {
          id: 1,
          title: 'Calculus Problem Set 1',
          description: 'Complete problems 1-15 from Chapter 2. Focus on limits and continuity.',
          courseId: 1,
          courseName: 'Advanced Mathematics',
          dueDate: '2024-02-15T23:59:00',
          points: 100,
          type: 'homework',
          instructions: 'Show all work clearly. Use proper mathematical notation. Submit as PDF.',
          totalStudents: 10,
          submissions: [
            { studentId: 1, studentName: 'Sarah Johnson', submittedAt: '2024-02-14T15:30:00', status: 'submitted', grade: 95, feedback: 'Excellent work! Clear solutions and proper notation.' },
            { studentId: 2, studentName: 'Michael Chen', submittedAt: '2024-02-15T10:15:00', status: 'submitted', grade: 88, feedback: 'Good work overall. Minor errors in problem 7.' },
            { studentId: 3, studentName: 'Emily Rodriguez', submittedAt: '2024-02-15T22:45:00', status: 'late', grade: 82, feedback: 'Submitted late. Solutions are correct but incomplete.' },
            { studentId: 4, studentName: 'David Kim', submittedAt: '2024-02-14T18:20:00', status: 'submitted', grade: 91, feedback: 'Very good work. Clear understanding of concepts.' },
            { studentId: 5, studentName: 'Lisa Thompson', submittedAt: '2024-02-15T23:30:00', status: 'submitted', grade: 87, feedback: 'Good effort. Need more practice with limits.' }
          ],
          graded: true,
          createdAt: '2024-01-20T10:00:00'
        },
        {
          id: 2,
          title: 'Python Programming Project',
          description: 'Create a simple calculator application using Python with GUI.',
          courseId: 2,
          courseName: 'Introduction to Computer Science',
          dueDate: '2024-02-20T23:59:00',
          points: 150,
          type: 'project',
          instructions: 'Use tkinter for GUI. Include basic arithmetic operations. Add error handling.',
          totalStudents: 10,
          submissions: [
            { studentId: 11, studentName: 'Alex Martinez', submittedAt: '2024-02-19T14:20:00', status: 'submitted', grade: 145, feedback: 'Excellent project! Clean code and great UI design.' },
            { studentId: 12, studentName: 'Jessica Wang', submittedAt: '2024-02-20T16:45:00', status: 'submitted', grade: 138, feedback: 'Very good implementation. Minor UI improvements needed.' },
            { studentId: 13, studentName: 'Ryan O\'Connor', submittedAt: '2024-02-20T22:10:00', status: 'submitted', grade: 132, feedback: 'Good work. Error handling could be improved.' },
            { studentId: 14, studentName: 'Maria Garcia', submittedAt: '2024-02-21T01:15:00', status: 'late', grade: 120, feedback: 'Submitted late. Basic functionality works but needs refinement.' }
          ],
          graded: true,
          createdAt: '2024-01-25T09:00:00'
        },
        {
          id: 3,
          title: 'Literary Analysis Essay',
          description: 'Write a 1500-word essay analyzing themes in Shakespeare\'s "Hamlet".',
          courseId: 3,
          courseName: 'World Literature',
          dueDate: '2024-02-25T23:59:00',
          points: 100,
          type: 'essay',
          instructions: 'Focus on one major theme. Use proper citations. Include thesis statement.',
          totalStudents: 10,
          submissions: [
            { studentId: 21, studentName: 'Sophie Anderson', submittedAt: '2024-02-24T11:30:00', status: 'submitted', grade: 92, feedback: 'Excellent analysis! Strong thesis and well-supported arguments.' },
            { studentId: 22, studentName: 'Daniel Brown', submittedAt: '2024-02-25T20:15:00', status: 'submitted', grade: 85, feedback: 'Good essay. Could strengthen the conclusion.' },
            { studentId: 23, studentName: 'Rachel Green', submittedAt: '2024-02-26T02:30:00', status: 'late', grade: 78, feedback: 'Submitted late. Good content but needs better organization.' }
          ],
          graded: false,
          createdAt: '2024-02-01T14:00:00'
        },
        {
          id: 4,
          title: 'Physics Lab Report',
          description: 'Write a lab report on the pendulum experiment.',
          courseId: 4,
          courseName: 'Physics for Engineers',
          dueDate: '2024-02-28T23:59:00',
          points: 80,
          type: 'lab',
          instructions: 'Include data analysis, graphs, and conclusions. Follow lab report format.',
          totalStudents: 10,
          submissions: [],
          graded: false,
          createdAt: '2024-02-05T16:00:00'
        },
        {
          id: 5,
          title: 'Business Ethics Case Study',
          description: 'Analyze the ethical implications of a corporate decision.',
          courseId: 5,
          courseName: 'Business Ethics and Corporate Social Responsibility',
          dueDate: '2024-03-05T23:59:00',
          points: 120,
          type: 'case-study',
          instructions: 'Choose a recent business case. Apply ethical frameworks. Provide recommendations.',
          totalStudents: 10,
          submissions: [],
          graded: false,
          createdAt: '2024-02-10T11:00:00'
        }
      ];
      
      localStorage.setItem('assignments', JSON.stringify(sampleAssignments));
      renderAssessmentTools();
    }

    function openAssignmentModal(editId = null) {
      const modal = document.getElementById('assignment-modal');
      const title = document.getElementById('assignment-modal-title');
      const form = document.getElementById('assignment-form');
      
      if (editId !== null) {
        title.textContent = 'Edit Assignment';
        const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
        const assignment = assignments.find(a => a.id === editId);
        if (assignment) {
          document.getElementById('assignment-title').value = assignment.title;
          document.getElementById('assignment-description').value = assignment.description || '';
          document.getElementById('assignment-course').value = assignment.courseId;
          document.getElementById('assignment-due-date').value = assignment.dueDate.replace(' ', 'T');
          document.getElementById('assignment-points').value = assignment.points;
          document.getElementById('assignment-type').value = assignment.type;
          document.getElementById('assignment-instructions').value = assignment.instructions || '';
          form.dataset.editId = editId;
        }
      } else {
        title.textContent = 'Create New Assignment';
        form.reset();
        delete form.dataset.editId;
      }
      
      modal.style.display = 'flex';
    }

    function saveAssignment() {
      const form = document.getElementById('assignment-form');
      const editId = form.dataset.editId;
      
      const assignmentData = {
        title: document.getElementById('assignment-title').value.trim(),
        description: document.getElementById('assignment-description').value.trim(),
        courseId: parseInt(document.getElementById('assignment-course').value),
        dueDate: document.getElementById('assignment-due-date').value,
        points: parseInt(document.getElementById('assignment-points').value),
        type: document.getElementById('assignment-type').value,
        instructions: document.getElementById('assignment-instructions').value.trim(),
        submissions: [],
        graded: false,
        createdAt: new Date().toISOString()
      };
      
      // Get course name
      const courses = JSON.parse(localStorage.getItem('courses') || '[]');
      const course = courses.find(c => c.id === assignmentData.courseId);
      assignmentData.courseName = course ? course.title : 'Unknown Course';
      assignmentData.totalStudents = course ? (course.students?.length || 0) : 0;
      
      if (!assignmentData.title || !assignmentData.courseId || !assignmentData.dueDate) {
        alert('Title, course, and due date are required!');
        return;
      }
      
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      if (editId !== undefined) {
        // Update existing assignment
        const index = assignments.findIndex(a => a.id === parseInt(editId));
        if (index !== -1) {
          assignmentData.id = parseInt(editId);
          assignmentData.submissions = assignments[index].submissions || [];
          assignmentData.graded = assignments[index].graded;
          assignmentData.createdAt = assignments[index].createdAt;
          assignments[index] = assignmentData;
        }
      } else {
        // Create new assignment
        assignmentData.id = assignments.length > 0 ? Math.max(...assignments.map(a => a.id)) + 1 : 1;
        assignments.push(assignmentData);
      }
      
      localStorage.setItem('assignments', JSON.stringify(assignments));
      closeModal('assignment-modal');
      renderAssessmentTools();
      showNotification(editId !== undefined ? 'Assignment updated successfully!' : 'Assignment created successfully!', 'success');
    }

    function viewAssignmentDetails(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('assignment-details-modal');
      const content = document.getElementById('assignment-details-content');
      
      content.innerHTML = `
        <div class='assignment-details'>
          <div class='assignment-header-details mb-20'>
            <h2>${assignment.title}</h2>
            <p class='text-muted'>${assignment.description || 'No description available'}</p>
            <div class='assignment-meta-details'>
              <span class='badge badge-primary'><i class='fas fa-book'></i> ${assignment.courseName}</span>
              <span class='badge badge-info'><i class='fas fa-calendar'></i> Due: ${new Date(assignment.dueDate).toLocaleString()}</span>
              <span class='badge badge-warning'><i class='fas fa-star'></i> ${assignment.points} Points</span>
              <span class='badge badge-secondary'><i class='fas fa-tag'></i> ${assignment.type}</span>
            </div>
          </div>
          
          <div class='grid-2 gap-20 mb-20'>
            <div class='card'>
              <h4>Submission Statistics</h4>
              <div class='stats-grid'>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.length || 0}</div>
                  <div class='stat-label'>Submitted</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.totalStudents - (assignment.submissions?.length || 0)}</div>
                  <div class='stat-label'>Missing</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.filter(s => s.status === 'late').length || 0}</div>
                  <div class='stat-label'>Late</div>
                </div>
                <div class='stat-item'>
                  <div class='stat-number'>${assignment.submissions?.filter(s => s.grade).length || 0}</div>
                  <div class='stat-label'>Graded</div>
                </div>
              </div>
            </div>
            
            <div class='card'>
              <h4>Instructions</h4>
              <div class='instructions-content'>
                ${assignment.instructions || 'No specific instructions provided.'}
              </div>
            </div>
          </div>
          
          <div class='assignment-actions-details'>
            <button class='btn btn-secondary' onclick='viewSubmissions(${assignment.id})'>View Submissions</button>
            <button class='btn btn-secondary' onclick='gradeAssignment(${assignment.id})'>Grade Submissions</button>
            <button class='btn btn-secondary' onclick='editAssignment(${assignment.id})'>Edit Assignment</button>
            <button class='btn btn-danger' onclick='deleteAssignment(${assignment.id})'>Delete Assignment</button>
          </div>
        </div>
        
        <style>
          .assignment-header-details h2 {
            margin-bottom: 8px;
          }
          .assignment-meta-details {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
          }
          .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
          }
          .stat-item {
            text-align: center;
            padding: 16px;
            background: var(--glass);
            border-radius: 8px;
          }
          .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
          }
          .stat-label {
            font-size: 0.9em;
            color: var(--text-light);
          }
          .instructions-content {
            line-height: 1.6;
            color: var(--text-light);
          }
          .assignment-actions-details {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function viewSubmissions(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('submissions-modal');
      const content = document.getElementById('submissions-content');
      
      // Get all students enrolled in the course
      const courseStudents = students.filter(student => {
        const courses = JSON.parse(localStorage.getItem('courses') || '[]');
        const course = courses.find(c => c.id === assignment.courseId);
        return course && course.students && course.students.some(s => s.email === student.email);
      });
      
      content.innerHTML = `
        <div class='submissions-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Submissions - ${assignment.title}</h3>
            <div class='flex gap-10'>
              <span class='badge badge-primary'>${assignment.submissions?.length || 0} Submitted</span>
              <span class='badge badge-warning'>${courseStudents.length - (assignment.submissions?.length || 0)} Missing</span>
            </div>
          </div>
          
          <div class='submissions-list'>
            ${courseStudents.map(student => {
              const submission = assignment.submissions?.find(s => s.studentId === student.id);
              const isLate = submission && new Date(submission.submittedAt) > new Date(assignment.dueDate);
              
              return `
                <div class='submission-item'>
                  <div class='submission-header'>
                    <div class='submission-student'>
                      <div class='student-avatar'>${student.name.split(' ').map(n => n[0]).join('')}</div>
                      <div>
                        <div class='student-name'>${student.name}</div>
                        <div class='student-email'>${student.email}</div>
                      </div>
                    </div>
                    <div class='submission-status-group'>
                      ${submission ? `
                        <span class='submission-status ${isLate ? 'status-late' : 'status-submitted'}'>
                          ${isLate ? 'Late' : 'Submitted'}
                        </span>
                        <span class='text-muted'>${new Date(submission.submittedAt).toLocaleString()}</span>
                      ` : `
                        <span class='submission-status status-missing'>Missing</span>
                      `}
                    </div>
                  </div>
                  
                  ${submission ? `
                    <div class='submission-content'>
                      <div class='submission-file'>
                        <i class='fas fa-file-pdf'></i>
                        <span>${student.name}_assignment_${assignment.id}.pdf</span>
                        <button class='btn btn-sm btn-secondary' onclick='downloadSubmission(${assignment.id}, ${student.id})'>
                          <i class='fas fa-download'></i> Download
                        </button>
                      </div>
                      ${submission.grade ? `
                        <div class='submission-grade'>
                          <strong>Grade: ${submission.grade}/${assignment.points}</strong>
                          <div class='grade-feedback'>${submission.feedback}</div>
                        </div>
                      ` : `
                        <button class='btn btn-sm btn-primary' onclick='gradeSubmission(${assignment.id}, ${student.id})'>
                          <i class='fas fa-star'></i> Grade
                        </button>
                      `}
                    </div>
                  ` : `
                    <div class='submission-missing'>
                      <p class='text-muted'>No submission received</p>
                    </div>
                  `}
                </div>
              `;
            }).join('')}
          </div>
        </div>
        
        <style>
          .submission-status-group {
            text-align: right;
          }
          .submission-content {
            margin-top: 12px;
          }
          .submission-file {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
          }
          .submission-grade {
            margin-top: 8px;
            padding: 8px;
            background: var(--medium-gray);
            border-radius: 4px;
          }
          .grade-feedback {
            margin-top: 4px;
            font-size: 0.9em;
            color: var(--text-light);
          }
          .submission-missing {
            margin-top: 12px;
            padding: 12px;
            background: var(--medium-gray);
            border-radius: 4px;
            text-align: center;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function gradeAssignment(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const assignment = assignments.find(a => a.id === assignmentId);
      
      if (!assignment) return;
      
      const modal = document.getElementById('grading-modal');
      const content = document.getElementById('grading-content');
      
      // Get students with submissions
      const submissions = assignment.submissions || [];
      
      content.innerHTML = `
        <div class='grading-management'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Grade Submissions - ${assignment.title}</h3>
            <span class='badge badge-primary'>${submissions.length} Submissions</span>
          </div>
          
          <div class='grading-forms'>
            ${submissions.map(submission => `
              <div class='grading-form'>
                <div class='grading-header'>
                  <div class='grading-student'>
                    <div class='student-avatar'>${submission.studentName.split(' ').map(n => n[0]).join('')}</div>
                    <div>
                      <div class='student-name'>${submission.studentName}</div>
                      <div class='submission-time'>Submitted: ${new Date(submission.submittedAt).toLocaleString()}</div>
                    </div>
                  </div>
                  <div class='grading-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='downloadSubmission(${assignment.id}, ${submission.studentId})'>
                      <i class='fas fa-download'></i> Download
                    </button>
                  </div>
                </div>
                
                <div class='grading-inputs'>
                  <div class='form-group'>
                    <label>Grade (out of ${assignment.points})</label>
                    <input type='number' class='form-control grade-input' id='grade-${submission.studentId}' 
                           value='${submission.grade || ''}' min='0' max='${assignment.points}'>
                  </div>
                  <div class='form-group'>
                    <label>Feedback</label>
                    <textarea class='form-control' id='feedback-${submission.studentId}' rows='3' 
                              placeholder='Provide feedback for this student...'>${submission.feedback || ''}</textarea>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
          
          <div class='grading-actions-footer'>
            <button class='btn btn-secondary' onclick='closeModal("grading-modal")'>Cancel</button>
            <button class='btn' onclick='saveGrades(${assignment.id})'>Save All Grades</button>
          </div>
        </div>
        
        <style>
          .grading-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
          }
          .grading-student {
            display: flex;
            align-items: center;
            gap: 12px;
          }
          .submission-time {
            font-size: 0.9em;
            color: var(--text-light);
          }
          .grading-inputs {
            display: grid;
            gap: 12px;
          }
          .grading-actions-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
          }
        </style>
      `;
      
      modal.style.display = 'flex';
    }

    function saveGrades(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignmentIndex = assignments.findIndex(a => a.id === assignmentId);
      
      if (assignmentIndex === -1) return;
      
      const assignment = assignments[assignmentIndex];
      let allGraded = true;
      
      // Update grades for each submission
      assignment.submissions.forEach(submission => {
        const grade = document.getElementById(`grade-${submission.studentId}`).value;
        const feedback = document.getElementById(`feedback-${submission.studentId}`).value;
        
        if (grade && grade >= 0 && grade <= assignment.points) {
          submission.grade = parseInt(grade);
          submission.feedback = feedback;
        } else {
          allGraded = false;
        }
      });
      
      assignment.graded = allGraded;
      assignments[assignmentIndex] = assignment;
      
      localStorage.setItem('assignments', JSON.stringify(assignments));
      closeModal('grading-modal');
      renderAssessmentTools();
      showNotification('Grades saved successfully!', 'success');
    }

    function gradeSubmission(assignmentId, studentId) {
      // This would open a focused grading interface for a single student
      alert('Individual grading interface would open here');
    }

    function downloadSubmission(assignmentId, studentId) {
      // Mock download functionality
      showNotification('Download started...', 'info');
    }

    function downloadAssignment(assignmentId) {
      // Mock download functionality
      showNotification('Assignment file download started...', 'info');
    }

    function editAssignment(assignmentId) {
      openAssignmentModal(assignmentId);
    }

    function deleteAssignment(assignmentId) {
      if (confirm('Are you sure you want to delete this assignment? This action cannot be undone.')) {
        let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
        assignments = assignments.filter(a => a.id !== assignmentId);
        localStorage.setItem('assignments', JSON.stringify(assignments));
        renderAssessmentTools();
        showNotification('Assignment deleted successfully!', 'success');
      }
    }

    function exportAssignments() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      let csv = 'Assignment Title,Course,Due Date,Type,Points,Submissions,Graded\n';
      assignments.forEach(assignment => {
        csv += `"${assignment.title}","${assignment.courseName}","${new Date(assignment.dueDate).toLocaleDateString()}","${assignment.type}",${assignment.points},${assignment.submissions?.length || 0},${assignment.graded ? 'Yes' : 'No'}\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'assignments_export.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function getOverdueAssignments() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const now = new Date();
      return assignments.filter(a => new Date(a.dueDate) < now && !a.graded);
    }

    function initAssignmentEvents() {
      // Assignment form submission
      document.getElementById('assignment-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveAssignment();
      });
      
      // Search functionality
      document.getElementById('assignment-search').addEventListener('input', function() {
        filterAssignments();
      });
      
      // Course filter
      document.getElementById('assignment-course-filter').addEventListener('change', function() {
        filterAssignments();
      });
      
      // Status filter
      document.getElementById('assignment-status-filter').addEventListener('change', function() {
        filterAssignments();
      });
    }

    function filterAssignments() {
      const searchTerm = document.getElementById('assignment-search').value.toLowerCase();
      const courseFilter = document.getElementById('assignment-course-filter').value;
      const statusFilter = document.getElementById('assignment-status-filter').value;
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      let filteredAssignments = assignments;
      
      // Apply search filter
      if (searchTerm) {
        filteredAssignments = filteredAssignments.filter(assignment => 
          assignment.title.toLowerCase().includes(searchTerm) || 
          assignment.description.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply course filter
      if (courseFilter) {
        filteredAssignments = filteredAssignments.filter(assignment => 
          assignment.courseId === parseInt(courseFilter)
        );
      }
      
      // Apply status filter
      if (statusFilter) {
        if (statusFilter === 'pending') {
          filteredAssignments = filteredAssignments.filter(assignment => !assignment.graded);
        } else if (statusFilter === 'graded') {
          filteredAssignments = filteredAssignments.filter(assignment => assignment.graded);
        } else if (statusFilter === 'overdue') {
          filteredAssignments = filteredAssignments.filter(assignment => 
            new Date(assignment.dueDate) < new Date() && !assignment.graded
          );
        }
      }
      
      // Update the assignments grid
      const assignmentsGrid = document.querySelector('.assignments-grid');
      if (filteredAssignments.length === 0) {
        assignmentsGrid.innerHTML = `
          <div class='card text-center'>
            <div class='card-icon'><i class='fas fa-search'></i></div>
            <h4>No Assignments Found</h4>
            <p class='text-muted mb-20'>Try adjusting your search criteria</p>
          </div>
        `;
      } else {
        assignmentsGrid.innerHTML = filteredAssignments.map((assignment, index) => `
          <div class='assignment-card' id='assignment-${assignment.id}'>
            <div class='assignment-header'>
              <div class='assignment-info'>
                <h4>${assignment.title}</h4>
                <p class='text-muted'>${assignment.description || 'No description available'}</p>
                <div class='assignment-meta'>
                  <span class='badge badge-primary'><i class='fas fa-book'></i> ${assignment.courseName || 'Unknown Course'}</span>
                  <span class='badge badge-info'><i class='fas fa-calendar'></i> Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                  <span class='badge ${assignment.graded ? 'badge-success' : 'badge-warning'}'>
                    <i class='fas ${assignment.graded ? 'fa-check-circle' : 'fa-clock'}'></i> 
                    ${assignment.graded ? 'Graded' : 'Pending'}
                  </span>
                </div>
              </div>
              <div class='assignment-actions'>
                <button class='btn btn-secondary' onclick='viewAssignmentDetails(${assignment.id})'>View Details</button>
                <button class='btn btn-secondary' onclick='editAssignment(${assignment.id})'>Edit</button>
                <button class='btn btn-danger' onclick='deleteAssignment(${assignment.id})'>Delete</button>
              </div>
            </div>
            
            <div class='assignment-progress mb-16'>
              <div class='progress-info'>
                <span>Submissions: ${assignment.submissions?.length || 0}/${assignment.totalStudents || 0}</span>
                <span>${assignment.submissions?.length > 0 ? Math.round((assignment.submissions.length / assignment.totalStudents) * 100) : 0}%</span>
              </div>
              <div class='progress-bar'>
                <div class='progress-fill' style='width: ${assignment.submissions?.length > 0 ? (assignment.submissions.length / assignment.totalStudents) * 100 : 0}%'></div>
              </div>
            </div>

            <div class='assignment-quick-actions'>
              <button class='btn btn-sm btn-secondary' onclick='gradeAssignment(${assignment.id})'>
                <i class='fas fa-star'></i> Grade Submissions
              </button>
              <button class='btn btn-sm btn-secondary' onclick='viewSubmissions(${assignment.id})'>
                <i class='fas fa-eye'></i> View Submissions
              </button>
              <button class='btn btn-sm btn-secondary' onclick='downloadAssignment(${assignment.id})'>
                <i class='fas fa-download'></i> Download
              </button>
            </div>
          </div>
        `).join('');
      }
    }

    function createAssignment() { openAssignmentModal(); }

    // ===== EXAMS MODULE FUNCTIONS =====
    function openExamsModule() {
      // Open the standalone exams module in a new window/tab
      window.open('exams.html', '_blank');
    }

    function createExam() {
      // Open the exams module with create mode
      const examsWindow = window.open('exams.html', '_blank');
      // The exams module will handle the creation
    }

    function editExamInModule(examIndex) {
      // Open the exams module with edit mode
      const examsWindow = window.open('exams.html', '_blank');
      // The exams module will handle the editing
    }

    function importExam() {
      // Create a file input for importing exam data
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const examData = JSON.parse(e.target.result);
              const exams = JSON.parse(localStorage.getItem('exams') || '[]');
              exams.push(examData);
              localStorage.setItem('exams', JSON.stringify(exams));
              showNotification('Exam imported successfully!', 'success');
              loadExams(); // Refresh the exams view
            } catch (error) {
              showNotification('Error importing exam: Invalid file format', 'error');
            }
          };
          reader.readAsText(file);
        }
      };
      input.click();
    }

    function exportExams() {
      const exams = JSON.parse(localStorage.getItem('exams') || '[]');
      if (exams.length === 0) {
        showNotification('No exams to export', 'warning');
        return;
      }
      
      const dataStr = JSON.stringify(exams, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'exams_export.json';
      link.click();
      URL.revokeObjectURL(url);
      showNotification('Exams exported successfully!', 'success');
    }

    function viewExamResults() {
      showNotification('Opening exam results...', 'info');
      // This would open a detailed results view
      // For now, just show a notification
    }

    function examAnalytics() {
      showNotification('Opening exam analytics...', 'info');
      // This would open analytics dashboard
      // For now, just show a notification
    }

    function examSettings() {
      showNotification('Opening exam settings...', 'info');
      // This would open settings modal
      // For now, just show a notification
    }

    // ===== GRADES & GRADEBOOK SECTION =====
    function renderGradebook() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Grades & Gradebook</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='exportGrades()'>Export Grades</button>
              <button class='btn' onclick='openWeightageModal()'>Set Weightage</button>
            </div>
          </div>
          <div class='grid-3 mb-20'>
            <div class='card'>
              <h4>Class Average</h4>
              <div class='card-count'>${calculateClassAverage()}%</div>
            </div>
            <div class='card'>
              <h4>Highest Grade</h4>
              <div class='card-count'>${calculateHighestGrade()}%</div>
            </div>
            <div class='card'>
              <h4>Lowest Grade</h4>
              <div class='card-count'>${calculateLowestGrade()}%</div>
            </div>
          </div>
          <div class='grid-2 mb-20'>
            <div class='card'>
              <h4>Grade Distribution</h4>
              <div id='grade-distribution'>
                <div class='grade-bar'>
                  <span>A (90-100)</span>
                  <div class='grade-bar-fill' style='width: ${calculateGradeDistribution('A')}%'></div>
                  <span>${calculateGradeDistribution('A')}%</span>
                </div>
                <div class='grade-bar'>
                  <span>B (80-89)</span>
                  <div class='grade-bar-fill' style='width: ${calculateGradeDistribution('B')}%'></div>
                  <span>${calculateGradeDistribution('B')}%</span>
                </div>
                <div class='grade-bar'>
                  <span>C (70-79)</span>
                  <div class='grade-bar-fill' style='width: ${calculateGradeDistribution('C')}%'></div>
                  <span>${calculateGradeDistribution('C')}%</span>
                </div>
                <div class='grade-bar'>
                  <span>D (60-69)</span>
                  <div class='grade-bar-fill' style='width: ${calculateGradeDistribution('D')}%'></div>
                  <span>${calculateGradeDistribution('D')}%</span>
                </div>
                <div class='grade-bar'>
                  <span>F (0-59)</span>
                  <div class='grade-bar-fill' style='width: ${calculateGradeDistribution('F')}%'></div>
                  <span>${calculateGradeDistribution('F')}%</span>
                </div>
              </div>
            </div>
            <div class='card'>
              <h4>Recent Assignments</h4>
              <div id='recent-assignments'>
                ${renderRecentAssignments()}
              </div>
            </div>
          </div>
          <div class='table-responsive'>
            <table class='table'>
              <thead>
                <tr>
                  <th>Student</th>
                  ${assignments.map(a => `<th>${a.title}</th>`).join('')}
                  <th>Final Grade</th>
                  <th>Letter Grade</th>
                </tr>
              </thead>
              <tbody>
                ${students.length === 0 ? `<tr><td colspan='${assignments.length + 3}' class='text-center text-muted'>No students enrolled</td></tr>` : students.map((student, sidx) => `
                  <tr>
                    <td>${student.name}</td>
                    ${assignments.map(assignment => {
                      const grade = assignment.grades?.[sidx] || '';
                      return `<td>${grade ? grade + '%' : '-'}</td>`;
                    }).join('')}
                    <td><strong>${calculateStudentFinalGrade(sidx)}%</strong></td>
                    <td><span class='badge ${getLetterGradeBadge(calculateStudentFinalGrade(sidx))}'>${getLetterGrade(calculateStudentFinalGrade(sidx))}</span></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
        <div id='weightage-modal' class='modal'>
          <div class='modal-content'>
            <button class='modal-close' onclick='closeModal("weightage-modal")'><i class='fas fa-times'></i></button>
            <h2>Set Assignment Weightage</h2>
            <div id='weightage-form'>
              ${assignments.map((assignment, idx) => `
                <div class='form-group'>
                  <label>${assignment.title}</label>
                  <input type='number' class='form-control weightage-input' data-idx='${idx}' value='${assignment.weightage || 100}' min='0' max='100'>
                </div>
              `).join('')}
            </div>
            <button class='btn' onclick='saveWeightage()'>Save Weightage</button>
          </div>
        </div>
        <style>
          .grade-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
          }
          .grade-bar-fill {
            height: 20px;
            background: var(--primary);
            border-radius: 10px;
            min-width: 20px;
          }
          .weightage-input {
            width: 100px;
          }
        </style>
      `;
      setTimeout(initGradebookEvents, 0);
    }

    // ===== GRADEBOOK LOGIC =====
    function calculateClassAverage() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      let total = 0;
      students.forEach((_, sidx) => {
        total += calculateStudentFinalGrade(sidx);
      });
      return Math.round(total / students.length);
    }
    function calculateHighestGrade() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      let highest = 0;
      students.forEach((_, sidx) => {
        const grade = calculateStudentFinalGrade(sidx);
        if (grade > highest) highest = grade;
      });
      return highest;
    }
    function calculateLowestGrade() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      let lowest = 100;
      students.forEach((_, sidx) => {
        const grade = calculateStudentFinalGrade(sidx);
        if (grade < lowest) lowest = grade;
      });
      return lowest;
    }
    function calculateStudentFinalGrade(studentIdx) {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let totalWeighted = 0;
      let totalWeightage = 0;
      assignments.forEach(assignment => {
        if (assignment.grades && assignment.grades[studentIdx]) {
          const weightage = assignment.weightage || 100;
          totalWeighted += (assignment.grades[studentIdx] * weightage);
          totalWeightage += weightage;
        }
      });
      return totalWeightage > 0 ? Math.round(totalWeighted / totalWeightage) : 0;
    }
    function calculateGradeDistribution(letter) {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      let count = 0;
      students.forEach((_, sidx) => {
        const grade = calculateStudentFinalGrade(sidx);
        if (letter === 'A' && grade >= 90) count++;
        else if (letter === 'B' && grade >= 80 && grade < 90) count++;
        else if (letter === 'C' && grade >= 70 && grade < 80) count++;
        else if (letter === 'D' && grade >= 60 && grade < 70) count++;
        else if (letter === 'F' && grade < 60) count++;
      });
      return Math.round((count / students.length) * 100);
    }
    function getLetterGrade(percentage) {
      if (percentage >= 90) return 'A';
      if (percentage >= 80) return 'B';
      if (percentage >= 70) return 'C';
      if (percentage >= 60) return 'D';
      return 'F';
    }
    function getLetterGradeBadge(percentage) {
      if (percentage >= 90) return 'badge-success';
      if (percentage >= 80) return 'badge-primary';
      if (percentage >= 70) return 'badge-warning';
      if (percentage >= 60) return 'badge-warning';
      return 'badge-danger';
    }
    function renderRecentAssignments() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const recent = assignments.slice(-5).reverse();
      if (recent.length === 0) return '<p class="text-muted">No assignments yet</p>';
      return recent.map(assignment => `
        <div class='flex flex-between flex-center mb-16'>
          <span>${assignment.title}</span>
          <span class='badge ${assignment.graded ? 'badge-success' : 'badge-warning'}'>${assignment.graded ? 'Graded' : 'Pending'}</span>
        </div>
      `).join('');
    }
    function openWeightageModal() {
      document.getElementById('weightage-modal').style.display = 'flex';
    }
    function saveWeightage() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      document.querySelectorAll('.weightage-input').forEach(input => {
        const idx = parseInt(input.getAttribute('data-idx'));
        assignments[idx].weightage = parseInt(input.value) || 100;
      });
      localStorage.setItem('assignments', JSON.stringify(assignments));
      closeModal('weightage-modal');
      renderGradebook();
    }
    function exportGrades() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let csv = 'Student Name,';
      assignments.forEach(a => csv += `${a.title},`);
      csv += 'Final Grade,Letter Grade\n';
      students.forEach(student => {
        csv += `${student.name},`;
        assignments.forEach(assignment => {
          const grade = assignment.grades?.[students.indexOf(student)] || '';
          csv += `${grade},`;
        });
        const finalGrade = calculateStudentFinalGrade(students.indexOf(student));
        csv += `${finalGrade},${getLetterGrade(finalGrade)}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'grades_export.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }
    function initGradebookEvents() {
      window.openWeightageModal = openWeightageModal;
      window.saveWeightage = saveWeightage;
      window.exportGrades = exportGrades;
    }

    // ===== ENHANCED COMMUNICATION & COLLABORATION SECTION =====
    function renderCommunication() {
      let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      let discussions = JSON.parse(localStorage.getItem('discussions') || '[]');
      let messages = JSON.parse(localStorage.getItem('messages') || '[]');
      
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Communication & Collaboration</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='openInAppMessaging()'>
                <i class='fas fa-comments'></i> In-App Messages
              </button>
              <button class='btn btn-secondary' onclick='openDiscussionModal()'>
                <i class='fas fa-comments'></i> Create Discussion
              </button>
              <button class='btn' onclick='openAnnouncementModal()'>
                <i class='fas fa-bullhorn'></i> + Send Announcement
              </button>
            </div>
          </div>
          
          <!-- Communication Overview -->
          <div class='grid-4 mb-20'>
            <div class='card'>
              <h4>Total Announcements</h4>
              <div class='card-count'>${announcements.length}</div>
              <p class='text-muted'>Sent this semester</p>
            </div>
            <div class='card'>
              <h4>Active Discussions</h4>
              <div class='card-count'>${discussions.length}</div>
              <p class='text-muted'>Ongoing forums</p>
            </div>
            <div class='card'>
              <h4>Unread Messages</h4>
              <div class='card-count'>${messages.filter(m => !m.read).length}</div>
              <p class='text-muted'>Require attention</p>
            </div>
            <div class='card'>
              <h4>Total Students</h4>
              <div class='card-count'>${students.length}</div>
              <p class='text-muted'>In communication</p>
            </div>
          </div>

          <!-- Communication Tabs -->
          <div class='card'>
            <div class='tab-navigation mb-20'>
              <button class='tab-btn active' onclick='switchCommunicationTab("announcements")'>Announcements & Notifications</button>
              <button class='tab-btn' onclick='switchCommunicationTab("discussions")'>Discussion Moderation</button>
              <button class='tab-btn' onclick='switchCommunicationTab("messaging")'>In-App Messaging</button>
              <button class='tab-btn' onclick='switchCommunicationTab("quick-actions")'>Quick Actions</button>
            </div>
            
            <div id='announcements-tab' class='tab-content active'>
              ${renderAnnouncementsTab(announcements, students, courses)}
            </div>
            
            <div id='discussions-tab' class='tab-content'>
              ${renderDiscussionsTab(discussions, courses)}
            </div>
            
            <div id='messaging-tab' class='tab-content'>
              ${renderMessagingTab(messages, students)}
            </div>
            
            <div id='quick-actions-tab' class='tab-content'>
              ${renderQuickActionsTab(students, courses)}
            </div>
          </div>
        </div>

        <!-- Announcement Modal -->
        <div id='announcement-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("announcement-modal")'><i class='fas fa-times'></i></button>
            <h2 id='announcement-modal-title'>Send Announcement</h2>
            <form id='announcement-form'>
              <div class='form-group'>
                <label>Title *</label>
                <input type='text' id='announcement-title-input' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Message *</label>
                <textarea id='announcement-content-input' class='form-control' rows='4' required></textarea>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Recipients</label>
                  <select id='announcement-recipients-input' class='form-control' onchange='toggleSpecificStudents()'>
                    <option value='all'>All Students</option>
                    ${courses.map((course, idx) => `<option value='course-${course.id}'>${course.title} Students</option>`).join('')}
                    <option value='specific'>Specific Students</option>
                    <option value='parents'>Parents/Guardians</option>
                  </select>
                </div>
                <div class='form-group'>
                  <label>Priority</label>
                  <select id='announcement-priority-input' class='form-control'>
                    <option value='normal'>Normal</option>
                    <option value='important'>Important</option>
                    <option value='urgent'>Urgent</option>
                  </select>
                </div>
              </div>
              <div class='form-group' id='specific-students-group' style='display:none;'>
                <label>Select Students</label>
                <div class='student-checkboxes'>
                  ${students.map((student, idx) => `
                    <label class='checkbox-item'>
                      <input type='checkbox' value='${student.id}' name='selected-students'>
                      <span>${student.name} (${student.email})</span>
                    </label>
                  `).join('')}
                </div>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Delivery Method</label>
                  <div class='checkbox-group'>
                    <label><input type='checkbox' id='delivery-app' checked> In-App Notification</label>
                    <label><input type='checkbox' id='delivery-email'> Email</label>
                    <label><input type='checkbox' id='delivery-sms'> SMS (if available)</label>
                  </div>
                </div>
                <div class='form-group'>
                  <label>Schedule (Optional)</label>
                  <input type='datetime-local' id='announcement-schedule' class='form-control'>
                </div>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("announcement-modal")'>Cancel</button>
                <button type='submit' class='btn'>Send Announcement</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Discussion Modal -->
        <div id='discussion-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("discussion-modal")'><i class='fas fa-times'></i></button>
            <h2>Create Discussion Forum</h2>
            <form id='discussion-form'>
              <div class='form-group'>
                <label>Topic *</label>
                <input type='text' id='discussion-topic-input' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Description</label>
                <textarea id='discussion-desc-input' class='form-control' rows='3'></textarea>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Course</label>
                  <select id='discussion-course-input' class='form-control'>
                    <option value=''>General Discussion</option>
                    ${courses.map((course, idx) => `<option value='${course.id}'>${course.title}</option>`).join('')}
                  </select>
                </div>
                <div class='form-group'>
                  <label>Discussion Type</label>
                  <select id='discussion-type-input' class='form-control'>
                    <option value='qna'>Q&A Forum</option>
                    <option value='debate'>Debate</option>
                    <option value='collaboration'>Collaboration</option>
                    <option value='general'>General Discussion</option>
                  </select>
                </div>
              </div>
              <div class='form-group'>
                <label>Moderation Settings</label>
                <div class='checkbox-group'>
                  <label><input type='checkbox' id='discussion-allow-posts' checked> Allow Student Posts</label>
                  <label><input type='checkbox' id='discussion-moderate-posts'> Moderate Posts Before Publishing</label>
                  <label><input type='checkbox' id='discussion-allow-replies'> Allow Replies to Posts</label>
                  <label><input type='checkbox' id='discussion-anonymous'> Allow Anonymous Posts</label>
                </div>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("discussion-modal")'>Cancel</button>
                <button type='submit' class='btn'>Create Forum</button>
              </div>
            </form>
          </div>
        </div>

        <!-- In-App Messaging Modal -->
        <div id='messaging-modal' class='modal'>
          <div class='modal-content' style='max-width: 900px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("messaging-modal")'><i class='fas fa-times'></i></button>
            <div id='messaging-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>

        <!-- Email Modal -->
        <div id='email-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("email-modal")'><i class='fas fa-times'></i></button>
            <h2>Send Email</h2>
            <form id='email-form'>
              <div class='form-group'>
                <label>To *</label>
                <select id='email-recipients' class='form-control' multiple>
                  ${students.map(student => `<option value='${student.email}'>${student.name} (${student.email})</option>`).join('')}
                </select>
              </div>
              <div class='form-group'>
                <label>Subject *</label>
                <input type='text' id='email-subject' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Message *</label>
                <textarea id='email-message' class='form-control' rows='6' required></textarea>
              </div>
              <div class='form-group'>
                <label>Attachments</label>
                <input type='file' id='email-attachments' class='form-control' multiple>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("email-modal")'>Cancel</button>
                <button type='submit' class='btn'>Send Email</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Meeting Scheduler Modal -->
        <div id='meeting-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("meeting-modal")'><i class='fas fa-times'></i></button>
            <h2>Schedule Meeting</h2>
            <form id='meeting-form'>
              <div class='form-group'>
                <label>Meeting Title *</label>
                <input type='text' id='meeting-title' class='form-control' required>
              </div>
              <div class='form-group'>
                <label>Description</label>
                <textarea id='meeting-description' class='form-control' rows='3'></textarea>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Date *</label>
                  <input type='date' id='meeting-date' class='form-control' required>
                </div>
                <div class='form-group'>
                  <label>Time *</label>
                  <input type='time' id='meeting-time' class='form-control' required>
                </div>
              </div>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Duration (minutes)</label>
                  <input type='number' id='meeting-duration' class='form-control' value='60' min='15' max='480'>
                </div>
                <div class='form-group'>
                  <label>Meeting Type</label>
                  <select id='meeting-type' class='form-control'>
                    <option value='virtual'>Virtual Meeting</option>
                    <option value='in-person'>In-Person</option>
                    <option value='hybrid'>Hybrid</option>
                  </select>
                </div>
              </div>
              <div class='form-group'>
                <label>Participants</label>
                <select id='meeting-participants' class='form-control' multiple>
                  ${students.map(student => `<option value='${student.id}'>${student.name}</option>`).join('')}
                </select>
              </div>
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("meeting-modal")'>Cancel</button>
                <button type='submit' class='btn'>Schedule Meeting</button>
              </div>
            </form>
          </div>
        </div>

        <style>
          .announcement-item {
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            background: var(--glass);
            margin-bottom: 16px;
          }
          .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
          }
          .announcement-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
          }
          .student-checkboxes {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            background: var(--medium-gray);
          }
          .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding: 4px;
            border-radius: 4px;
          }
          .checkbox-item:hover {
            background: var(--light-gray);
          }
          .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
          }
          .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
          }
          .discussion-item {
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            background: var(--glass);
            margin-bottom: 16px;
          }
          .discussion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
          }
          .discussion-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
          }
          .message-item {
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            background: var(--glass);
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
          }
          .message-item:hover {
            background: var(--light-gray);
          }
          .message-item.unread {
            border-left: 4px solid var(--primary);
            background: var(--medium-gray);
          }
          .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
          }
          .message-preview {
            color: var(--text-light);
            font-size: 0.9em;
          }
          .chat-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            height: 500px;
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            overflow: hidden;
          }
          .chat-contacts {
            background: var(--medium-gray);
            border-right: 1px solid var(--glass-border);
            overflow-y: auto;
          }
          .chat-contact {
            padding: 12px;
            border-bottom: 1px solid var(--glass-border);
            cursor: pointer;
            transition: background 0.3s;
          }
          .chat-contact:hover {
            background: var(--light-gray);
          }
          .chat-contact.active {
            background: var(--primary);
            color: white;
          }
          .chat-messages {
            display: flex;
            flex-direction: column;
            background: var(--glass);
          }
          .chat-header {
            padding: 12px;
            background: var(--medium-gray);
            border-bottom: 1px solid var(--glass-border);
            font-weight: 600;
          }
          .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
          }
          .message-bubble {
            max-width: 70%;
            padding: 8px 12px;
            border-radius: 12px;
            margin-bottom: 8px;
          }
          .message-bubble.sent {
            background: var(--primary);
            color: white;
            margin-left: auto;
          }
          .message-bubble.received {
            background: var(--medium-gray);
            color: var(--text);
          }
          .chat-input {
            padding: 12px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            gap: 8px;
          }
          .chat-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--glass-border);
            border-radius: 6px;
            background: var(--medium-gray);
            color: var(--text);
          }
          .quick-action-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
          }
          .quick-action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          }
          .quick-action-icon {
            font-size: 2em;
            margin-bottom: 12px;
            color: var(--primary);
          }
          
          /* Tab Navigation Styles */
          .tab-navigation {
            display: flex;
            border-bottom: 1px solid var(--glass-border);
            margin-bottom: 20px;
          }
          .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
          }
          .tab-btn:hover {
            color: var(--text);
            background: var(--light-gray);
          }
          .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--glass);
          }
          .tab-content {
            display: none;
          }
          .tab-content.active {
            display: block;
          }
          .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--glass-border);
          }
        </style>
      `;
      setTimeout(initCommunicationEvents, 0);
      
      // Add form event listeners
      setTimeout(() => {
        const announcementForm = document.getElementById('announcement-form');
        if (announcementForm) {
          announcementForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveAnnouncement();
          });
        }
        
        const discussionForm = document.getElementById('discussion-form');
        if (discussionForm) {
          discussionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            saveDiscussion();
          });
        }
        
        const emailForm = document.getElementById('email-form');
        if (emailForm) {
          emailForm.addEventListener('submit', function(e) {
            e.preventDefault();
            sendEmail();
          });
        }
        
        const meetingForm = document.getElementById('meeting-form');
        if (meetingForm) {
          meetingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            scheduleMeeting();
          });
        }
      }, 100);
    }

    // ===== COMMUNICATION LOGIC =====
    let editingAnnouncementIdx = null;
    function openAnnouncementModal(editIdx) {
      let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      editingAnnouncementIdx = typeof editIdx === 'number' ? editIdx : null;
      document.getElementById('announcement-modal-title').textContent = editingAnnouncementIdx !== null ? 'Edit Announcement' : 'Send Announcement';
      if (editingAnnouncementIdx !== null) {
        const announcement = announcements[editingAnnouncementIdx];
        document.getElementById('announcement-title-input').value = announcement.title;
        document.getElementById('announcement-content-input').value = announcement.content;
        document.getElementById('announcement-recipients-input').value = announcement.recipients || 'all';
        document.getElementById('announcement-priority-input').value = announcement.priority || 'normal';
      } else {
        document.getElementById('announcement-title-input').value = '';
        document.getElementById('announcement-content-input').value = '';
        document.getElementById('announcement-recipients-input').value = 'all';
        document.getElementById('announcement-priority-input').value = 'normal';
      }
      document.getElementById('announcement-modal').style.display = 'flex';
      document.getElementById('save-announcement-btn').onclick = saveAnnouncement;
      
      // Handle recipients dropdown
      document.getElementById('announcement-recipients-input').onchange = function() {
        const specificGroup = document.getElementById('specific-students-group');
        specificGroup.style.display = this.value === 'specific' ? 'block' : 'none';
      };
    }
    function saveAnnouncement() {
      let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      const title = document.getElementById('announcement-title-input').value.trim();
      const content = document.getElementById('announcement-content-input').value.trim();
      const recipients = document.getElementById('announcement-recipients-input').value;
      const priority = document.getElementById('announcement-priority-input').value;
      
      if (!title || !content) return alert('Title and content required!');
      
      // Get delivery methods
      const delivery = [];
      if (document.getElementById('delivery-app').checked) delivery.push('app');
      if (document.getElementById('delivery-email').checked) delivery.push('email');
      if (document.getElementById('delivery-sms').checked) delivery.push('sms');
      
      // Get scheduled date if provided
      const schedule = document.getElementById('announcement-schedule').value;
      
      const announcementObj = { 
        id: editingAnnouncementIdx !== null ? announcements[editingAnnouncementIdx].id : Date.now(),
        title, 
        content, 
        recipients, 
        priority, 
        delivery,
        schedule: schedule || null,
        date: new Date().toISOString() 
      };
      
      if (editingAnnouncementIdx !== null) {
        announcements[editingAnnouncementIdx] = announcementObj;
      } else {
        announcements.push(announcementObj);
      }
      
      localStorage.setItem('announcements', JSON.stringify(announcements));
      closeModal('announcement-modal');
      renderCommunication();
      
      // Show success message
      showNotification('Announcement sent successfully!', 'success');
    }
    function editAnnouncement(idx) { openAnnouncementModal(idx); }
    function deleteAnnouncement(idx) {
      if (!confirm('Delete this announcement?')) return;
      let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
      announcements.splice(idx, 1);
      localStorage.setItem('announcements', JSON.stringify(announcements));
      renderCommunication();
    }
    function openDiscussionModal() {
      document.getElementById('discussion-topic-input').value = '';
      document.getElementById('discussion-desc-input').value = '';
      document.getElementById('discussion-course-input').selectedIndex = 0;
      document.getElementById('discussion-allow-posts').checked = true;
      document.getElementById('discussion-modal').style.display = 'flex';
      document.getElementById('save-discussion-btn').onclick = saveDiscussion;
    }
    function saveDiscussion() {
      let discussions = JSON.parse(localStorage.getItem('discussions') || '[]');
      const topic = document.getElementById('discussion-topic-input').value.trim();
      const description = document.getElementById('discussion-desc-input').value.trim();
      const courseId = document.getElementById('discussion-course-input').value ? parseInt(document.getElementById('discussion-course-input').value) : null;
      const type = document.getElementById('discussion-type-input').value;
      const allowPosts = document.getElementById('discussion-allow-posts').checked;
      const moderatePosts = document.getElementById('discussion-moderate-posts').checked;
      const allowReplies = document.getElementById('discussion-allow-replies').checked;
      const anonymous = document.getElementById('discussion-anonymous').checked;
      
      if (!topic) return alert('Topic required!');
      
      const discussionObj = { 
        id: Date.now(),
        topic, 
        description, 
        courseId, 
        type,
        allowPosts, 
        moderatePosts,
        allowReplies,
        anonymous,
        posts: [], 
        date: new Date().toISOString() 
      };
      
      discussions.push(discussionObj);
      localStorage.setItem('discussions', JSON.stringify(discussions));
      closeModal('discussion-modal');
      renderCommunication();
      
      // Show success message
      showNotification('Discussion forum created successfully!', 'success');
    }
    function renderDiscussions() {
      let discussions = JSON.parse(localStorage.getItem('discussions') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      if (discussions.length === 0) return '<p class="text-muted">No discussion forums created</p>';
      return discussions.map((discussion, idx) => `
        <div class='discussion-item mb-16'>
          <div class='flex flex-between flex-center'>
            <h5>${discussion.topic}</h5>
            <span class='text-muted'>${new Date(discussion.date).toLocaleDateString()}</span>
          </div>
          <p class='text-muted'>${discussion.description}</p>
          <div class='flex gap-10'>
            <span class='badge badge-primary'>${courses[discussion.courseId]?.title || 'Unknown Course'}</span>
            <span class='badge ${discussion.allowPosts ? 'badge-success' : 'badge-warning'}'>${discussion.allowPosts ? 'Student Posts Allowed' : 'Teacher Only'}</span>
            <span class='badge badge-secondary'>${discussion.posts?.length || 0} posts</span>
            <button class='btn btn-secondary btn-sm' onclick='viewDiscussion(${idx})'>View</button>
            <button class='btn btn-danger btn-sm' onclick='deleteDiscussion(${idx})'>Delete</button>
          </div>
        </div>
      `).join('');
    }
    function viewDiscussion(idx) {
      alert('Discussion view would open here with posts and moderation tools');
    }
    function deleteDiscussion(idx) {
      if (!confirm('Delete this discussion forum?')) return;
      let discussions = JSON.parse(localStorage.getItem('discussions') || '[]');
      discussions.splice(idx, 1);
      localStorage.setItem('discussions', JSON.stringify(discussions));
      renderCommunication();
    }
    function sendEmail() {
      const recipients = Array.from(document.getElementById('email-recipients').selectedOptions).map(option => option.value);
      const subject = document.getElementById('email-subject').value.trim();
      const message = document.getElementById('email-message').value.trim();
      
      if (!recipients.length || !subject || !message) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Simulate email sending
      showNotification(`Email sent to ${recipients.length} recipient(s)`, 'success');
      closeModal('email-modal');
      
      // Clear form
      document.getElementById('email-subject').value = '';
      document.getElementById('email-message').value = '';
      document.getElementById('email-recipients').selectedIndex = -1;
    }
    
    function scheduleMeeting() {
      const title = document.getElementById('meeting-title').value.trim();
      const description = document.getElementById('meeting-description').value.trim();
      const date = document.getElementById('meeting-date').value;
      const time = document.getElementById('meeting-time').value;
      const duration = document.getElementById('meeting-duration').value;
      const type = document.getElementById('meeting-type').value;
      const participants = Array.from(document.getElementById('meeting-participants').selectedOptions).map(option => option.value);
      
      if (!title || !date || !time) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      
      // Simulate meeting scheduling
      showNotification(`Meeting "${title}" scheduled for ${date} at ${time}`, 'success');
      closeModal('meeting-modal');
      
      // Clear form
      document.getElementById('meeting-title').value = '';
      document.getElementById('meeting-description').value = '';
      document.getElementById('meeting-date').value = '';
      document.getElementById('meeting-time').value = '';
      document.getElementById('meeting-duration').value = '60';
      document.getElementById('meeting-type').selectedIndex = 0;
      document.getElementById('meeting-participants').selectedIndex = -1;
    }
    
    function createDiscussion() {
      openDiscussionModal();
    }
    
    function sendBulkMessage() {
      sendBulkEmail();
    }
    
    // Notification function
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="notification-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      // Add notification styles if not already present
      if (!document.getElementById('notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
          .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          }
          .notification-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
          }
          .notification-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
          }
          .notification-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
          }
          .notification-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
          }
          .notification-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            margin-left: 12px;
            opacity: 0.7;
          }
          .notification-close:hover {
            opacity: 1;
          }
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
        `;
        document.head.appendChild(style);
      }
      
      document.body.appendChild(notification);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }
    function initCommunicationEvents() {
      window.openAnnouncementModal = openAnnouncementModal;
      window.editAnnouncement = editAnnouncement;
      window.deleteAnnouncement = deleteAnnouncement;
      window.openDiscussionModal = openDiscussionModal;
      window.viewDiscussion = viewDiscussion;
      window.deleteDiscussion = deleteDiscussion;
      window.sendEmail = sendEmail;
      window.scheduleMeeting = scheduleMeeting;
      window.createDiscussion = createDiscussion;
      window.sendBulkMessage = sendBulkMessage;
      window.switchCommunicationTab = switchCommunicationTab;
      window.openInAppMessaging = openInAppMessaging;
      window.toggleSpecificStudents = toggleSpecificStudents;
      window.openEmailModal = openEmailModal;
      window.openMeetingModal = openMeetingModal;
      window.sendBulkEmail = sendBulkEmail;
      window.sendBulkSMS = sendBulkSMS;
      window.createParentMeeting = createParentMeeting;
      window.sendProgressReport = sendProgressReport;
      window.openChat = openChat;
      window.sendMessage = sendMessage;
    }

    // ===== ENHANCED COMMUNICATION FUNCTIONS =====

    // Tab switching for communication
    function switchCommunicationTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Render announcements tab
    function renderAnnouncementsTab(announcements, students, courses) {
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Announcements & Notifications</h4>
          <button class="btn" onclick="openAnnouncementModal()">
            <i class="fas fa-plus"></i> New Announcement
          </button>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Filter by Priority:</label>
            <select id="announcement-priority-filter" class="form-control" onchange="filterAnnouncements()">
              <option value="">All Priorities</option>
              <option value="urgent">Urgent</option>
              <option value="important">Important</option>
              <option value="normal">Normal</option>
            </select>
          </div>
          <div>
            <label>Search:</label>
            <input type="text" id="announcement-search" class="form-control" placeholder="Search announcements..." onkeyup="filterAnnouncements()">
          </div>
        </div>
        
        <div id="announcements-list">
          ${announcements.length === 0 ? '<p class="text-muted text-center">No announcements yet</p>' : announcements.slice(-10).reverse().map(announcement => `
            <div class="announcement-item">
              <div class="announcement-header">
                <div>
                  <h5>${announcement.title}</h5>
                  <div class="announcement-meta">
                    <span class="badge badge-${getPriorityBadge(announcement.priority)}">${announcement.priority || 'normal'}</span>
                    <span class="text-muted">${announcement.recipients || 'All Students'}</span>
                    <span class="text-muted">${new Date(announcement.date).toLocaleDateString()}</span>
                  </div>
                </div>
                <div class="flex gap-8">
                  <button class="btn btn-secondary btn-sm" onclick="editAnnouncement(${announcements.indexOf(announcement)})">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteAnnouncement(${announcements.indexOf(announcement)})">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </div>
              </div>
              <p class="text-muted">${announcement.content}</p>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Render discussions tab
    function renderDiscussionsTab(discussions, courses) {
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Discussion Moderation</h4>
          <button class="btn" onclick="openDiscussionModal()">
            <i class="fas fa-plus"></i> Create Discussion
          </button>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Filter by Course:</label>
            <select id="discussion-course-filter" class="form-control" onchange="filterDiscussions()">
              <option value="">All Courses</option>
              ${courses.map(course => `<option value="${course.id}">${course.title}</option>`).join('')}
            </select>
          </div>
          <div>
            <label>Search:</label>
            <input type="text" id="discussion-search" class="form-control" placeholder="Search discussions..." onkeyup="filterDiscussions()">
          </div>
        </div>
        
        <div id="discussions-list">
          ${discussions.length === 0 ? '<p class="text-muted text-center">No discussion forums created</p>' : discussions.map((discussion, idx) => `
            <div class="discussion-item">
              <div class="discussion-header">
                <div>
                  <h5>${discussion.topic}</h5>
                  <div class="discussion-meta">
                    <span class="badge badge-primary">${courses.find(c => c.id == discussion.courseId)?.title || 'General Discussion'}</span>
                    <span class="badge ${discussion.allowPosts ? 'badge-success' : 'badge-warning'}">${discussion.allowPosts ? 'Student Posts Allowed' : 'Teacher Only'}</span>
                    <span class="badge badge-secondary">${discussion.posts?.length || 0} posts</span>
                    <span class="text-muted">${new Date(discussion.date).toLocaleDateString()}</span>
                  </div>
                </div>
                <div class="flex gap-8">
                  <button class="btn btn-secondary btn-sm" onclick="viewDiscussion(${idx})">
                    <i class="fas fa-eye"></i> View
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="moderateDiscussion(${idx})">
                    <i class="fas fa-shield-alt"></i> Moderate
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteDiscussion(${idx})">
                    <i class="fas fa-trash"></i> Delete
                  </button>
                </div>
              </div>
              <p class="text-muted">${discussion.description || 'No description'}</p>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Render messaging tab
    function renderMessagingTab(messages, students) {
      const unreadCount = messages.filter(m => !m.read).length;
      
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>In-App Messaging</h4>
          <div class="flex gap-10">
            <span class="badge badge-primary">${unreadCount} unread</span>
            <button class="btn" onclick="openInAppMessaging()">
              <i class="fas fa-comments"></i> Open Chat
            </button>
          </div>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Filter by Status:</label>
            <select id="message-status-filter" class="form-control" onchange="filterMessages()">
              <option value="">All Messages</option>
              <option value="unread">Unread Only</option>
              <option value="read">Read Only</option>
            </select>
          </div>
          <div>
            <label>Search:</label>
            <input type="text" id="message-search" class="form-control" placeholder="Search messages..." onkeyup="filterMessages()">
          </div>
        </div>
        
        <div id="messages-list">
          ${messages.length === 0 ? '<p class="text-muted text-center">No messages yet</p>' : messages.slice(-10).reverse().map((message, idx) => `
            <div class="message-item ${!message.read ? 'unread' : ''}" onclick="openChat(${message.studentId})">
              <div class="message-header">
                <div>
                  <strong>${students.find(s => s.id == message.studentId)?.name || 'Unknown Student'}</strong>
                  <span class="text-muted">${new Date(message.date).toLocaleDateString()}</span>
                </div>
                ${!message.read ? '<span class="badge badge-primary">New</span>' : ''}
              </div>
              <div class="message-preview">${message.content.substring(0, 100)}${message.content.length > 100 ? '...' : ''}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Render quick actions tab
    function renderQuickActionsTab(students, courses) {
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Quick Actions</h4>
          <p class="text-muted">Common communication tasks</p>
        </div>
        
        <div class="grid-4">
          <div class="quick-action-card" onclick="openEmailModal()">
            <div class="quick-action-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <h5>Send Email</h5>
            <p class="text-muted">Send emails to students or parents</p>
          </div>
          
          <div class="quick-action-card" onclick="openMeetingModal()">
            <div class="quick-action-icon">
              <i class="fas fa-calendar"></i>
            </div>
            <h5>Schedule Meeting</h5>
            <p class="text-muted">Schedule virtual or in-person meetings</p>
          </div>
          
          <div class="quick-action-card" onclick="sendBulkEmail()">
            <div class="quick-action-icon">
              <i class="fas fa-users"></i>
            </div>
            <h5>Bulk Email</h5>
            <p class="text-muted">Send emails to multiple recipients</p>
          </div>
          
          <div class="quick-action-card" onclick="sendBulkSMS()">
            <div class="quick-action-icon">
              <i class="fas fa-sms"></i>
            </div>
            <h5>Bulk SMS</h5>
            <p class="text-muted">Send SMS to students/parents</p>
          </div>
          
          <div class="quick-action-card" onclick="createParentMeeting()">
            <div class="quick-action-icon">
              <i class="fas fa-handshake"></i>
            </div>
            <h5>Parent Meeting</h5>
            <p class="text-muted">Schedule parent-teacher conferences</p>
          </div>
          
          <div class="quick-action-card" onclick="sendProgressReport()">
            <div class="quick-action-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <h5>Progress Report</h5>
            <p class="text-muted">Send progress reports to parents</p>
          </div>
          
          <div class="quick-action-card" onclick="openInAppMessaging()">
            <div class="quick-action-icon">
              <i class="fas fa-comments"></i>
            </div>
            <h5>Direct Chat</h5>
            <p class="text-muted">Chat directly with students</p>
          </div>
          
          <div class="quick-action-card" onclick="openDiscussionModal()">
            <div class="quick-action-icon">
              <i class="fas fa-comments"></i>
            </div>
            <h5>Create Forum</h5>
            <p class="text-muted">Create discussion forums</p>
          </div>
        </div>
      `;
    }

    // Enhanced announcement functions
    function toggleSpecificStudents() {
      const recipientsSelect = document.getElementById('announcement-recipients-input');
      const specificGroup = document.getElementById('specific-students-group');
      specificGroup.style.display = recipientsSelect.value === 'specific' ? 'block' : 'none';
    }

    // Enhanced email functions
    function openEmailModal() {
      document.getElementById('email-modal').style.display = 'flex';
    }

    function sendBulkEmail() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
          <button class="modal-close" onclick="closeModal('bulk-email-modal')"><i class="fas fa-times"></i></button>
          <h2>Send Bulk Email</h2>
          <form id="bulk-email-form">
            <div class="form-group">
              <label>Recipients</label>
              <select id="bulk-email-recipients" class="form-control" multiple>
                <option value="all-students">All Students</option>
                <option value="all-parents">All Parents</option>
                ${JSON.parse(localStorage.getItem('courses') || '[]').map(course => 
                  `<option value="course-${course.id}">${course.title} Students</option>`
                ).join('')}
              </select>
            </div>
            <div class="form-group">
              <label>Subject *</label>
              <input type="text" id="bulk-email-subject" class="form-control" required>
            </div>
            <div class="form-group">
              <label>Message *</label>
              <textarea id="bulk-email-message" class="form-control" rows="6" required></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="closeModal('bulk-email-modal')">Cancel</button>
              <button type="submit" class="btn">Send Bulk Email</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);
      modal.id = 'bulk-email-modal';
    }

    // Enhanced meeting functions
    function openMeetingModal() {
      document.getElementById('meeting-modal').style.display = 'flex';
    }

    function createParentMeeting() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 700px;">
          <button class="modal-close" onclick="closeModal('parent-meeting-modal')"><i class="fas fa-times"></i></button>
          <h2>Schedule Parent Meeting</h2>
          <form id="parent-meeting-form">
            <div class="form-group">
              <label>Student</label>
              <select id="parent-meeting-student" class="form-control">
                ${JSON.parse(localStorage.getItem('students') || '[]').map(student => 
                  `<option value="${student.id}">${student.name}</option>`
                ).join('')}
              </select>
            </div>
            <div class="form-group">
              <label>Meeting Type</label>
              <select id="parent-meeting-type" class="form-control">
                <option value="academic">Academic Progress</option>
                <option value="behavioral">Behavioral Discussion</option>
                <option value="general">General Discussion</option>
                <option value="emergency">Emergency Meeting</option>
              </select>
            </div>
            <div class="grid-2 gap-16">
              <div class="form-group">
                <label>Date *</label>
                <input type="date" id="parent-meeting-date" class="form-control" required>
              </div>
              <div class="form-group">
                <label>Time *</label>
                <input type="time" id="parent-meeting-time" class="form-control" required>
              </div>
            </div>
            <div class="form-group">
              <label>Duration (minutes)</label>
              <input type="number" id="parent-meeting-duration" class="form-control" value="30" min="15" max="120">
            </div>
            <div class="form-group">
              <label>Notes</label>
              <textarea id="parent-meeting-notes" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="closeModal('parent-meeting-modal')">Cancel</button>
              <button type="submit" class="btn">Schedule Meeting</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);
      modal.id = 'parent-meeting-modal';
    }

    // In-app messaging functions
    function openInAppMessaging() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const messages = JSON.parse(localStorage.getItem('messages') || '[]');
      
      document.getElementById('messaging-content').innerHTML = `
        <div class="chat-container">
          <div class="chat-contacts">
            <div class="chat-header">Contacts</div>
            ${students.map(student => `
              <div class="chat-contact" onclick="openChat(${student.id})">
                <div><strong>${student.name}</strong></div>
                <div class="text-muted">${student.email}</div>
                ${messages.filter(m => m.studentId == student.id && !m.read).length > 0 ? 
                  `<span class="badge badge-primary">${messages.filter(m => m.studentId == student.id && !m.read).length}</span>` : ''}
              </div>
            `).join('')}
          </div>
          <div class="chat-messages">
            <div class="chat-header">Select a contact to start chatting</div>
            <div class="messages-area" id="messages-area">
              <p class="text-muted text-center">Choose a student to view messages</p>
            </div>
            <div class="chat-input" style="display: none;" id="chat-input">
              <input type="text" id="message-input" placeholder="Type your message..." onkeypress="handleMessageKeyPress(event)">
              <button class="btn" onclick="sendMessage()">Send</button>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('messaging-modal').style.display = 'flex';
    }

    function openChat(studentId) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const messages = JSON.parse(localStorage.getItem('messages') || '[]');
      const student = students.find(s => s.id == studentId);
      
      if (!student) return;
      
      // Update active contact
      document.querySelectorAll('.chat-contact').forEach(contact => contact.classList.remove('active'));
      event.target.closest('.chat-contact').classList.add('active');
      
      // Show chat input
      document.getElementById('chat-input').style.display = 'flex';
      
      // Load messages
      const studentMessages = messages.filter(m => m.studentId == studentId);
      const messagesArea = document.getElementById('messages-area');
      
      messagesArea.innerHTML = studentMessages.length === 0 ? 
        '<p class="text-muted text-center">No messages yet. Start the conversation!</p>' :
        studentMessages.map(message => `
          <div class="message-bubble ${message.sender === 'teacher' ? 'sent' : 'received'}">
            <div>${message.content}</div>
            <small class="text-muted">${new Date(message.date).toLocaleTimeString()}</small>
          </div>
        `).join('');
      
      messagesArea.scrollTop = messagesArea.scrollHeight;
      
      // Store current chat student
      window.currentChatStudentId = studentId;
    }

    function sendMessage() {
      const messageInput = document.getElementById('message-input');
      const content = messageInput.value.trim();
      
      if (!content || !window.currentChatStudentId) return;
      
      const messages = JSON.parse(localStorage.getItem('messages') || '[]');
      const newMessage = {
        id: Date.now(),
        studentId: window.currentChatStudentId,
        sender: 'teacher',
        content: content,
        date: new Date().toISOString(),
        read: true
      };
      
      messages.push(newMessage);
      localStorage.setItem('messages', JSON.stringify(messages));
      
      // Add message to chat
      const messagesArea = document.getElementById('messages-area');
      messagesArea.innerHTML += `
        <div class="message-bubble sent">
          <div>${content}</div>
          <small class="text-muted">${new Date().toLocaleTimeString()}</small>
        </div>
      `;
      
      messageInput.value = '';
      messagesArea.scrollTop = messagesArea.scrollHeight;
    }

    function handleMessageKeyPress(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }

    // Utility functions
    function getPriorityBadge(priority) {
      switch(priority) {
        case 'urgent': return 'danger';
        case 'important': return 'warning';
        default: return 'primary';
      }
    }

    function filterAnnouncements() {
      // Implementation for filtering announcements
      console.log('Filtering announcements...');
    }

    function filterDiscussions() {
      // Implementation for filtering discussions
      console.log('Filtering discussions...');
    }

    function filterMessages() {
      // Implementation for filtering messages
      console.log('Filtering messages...');
    }

    function moderateDiscussion(idx) {
      alert('Discussion moderation interface would open here');
    }

    function sendBulkSMS() {
      alert('Bulk SMS functionality would be implemented here');
    }

    function sendProgressReport() {
      alert('Progress report functionality would be implemented here');
    }

    // ===== ENHANCED ANALYTICS & REPORTING SECTION =====
    function renderAnalytics() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Analytics & Reporting</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='openStudentDashboard()'>
                <i class='fas fa-user-chart'></i> Student Dashboards
              </button>
              <button class='btn btn-secondary' onclick='generateReport()'>
                <i class='fas fa-file-alt'></i> Generate Report
              </button>
              <button class='btn' onclick='exportAnalytics()'>
                <i class='fas fa-download'></i> Export Data
              </button>
            </div>
          </div>
          
          <!-- Enhanced Overview Cards -->
          <div class='grid-4 mb-20'>
            <div class='card'>
              <h4>Student Engagement</h4>
              <div class='card-count'>${calculateEngagement()}%</div>
              <p class='text-muted'>Average across all courses</p>
              <div class='progress-bar mt-10'>
                <div class='progress-fill' style='width: ${calculateEngagement()}%'></div>
              </div>
            </div>
            <div class='card'>
              <h4>Course Completion</h4>
              <div class='card-count'>${calculateCompletion()}%</div>
              <p class='text-muted'>Students completing courses</p>
              <div class='progress-bar mt-10'>
                <div class='progress-fill' style='width: ${calculateCompletion()}%'></div>
              </div>
            </div>
            <div class='card'>
              <h4>Assignment Submission Rate</h4>
              <div class='card-count'>${calculateSubmissionRate()}%</div>
              <p class='text-muted'>On-time submissions</p>
              <div class='progress-bar mt-10'>
                <div class='progress-fill' style='width: ${calculateSubmissionRate()}%'></div>
              </div>
            </div>
            <div class='card'>
              <h4>Average Grade</h4>
              <div class='card-count'>${calculateAverageGrade()}%</div>
              <p class='text-muted'>Class average</p>
              <div class='progress-bar mt-10'>
                <div class='progress-fill' style='width: ${calculateAverageGrade()}%'></div>
              </div>
            </div>
          </div>

          <!-- Analytics Tabs -->
          <div class='card'>
            <div class='tab-navigation mb-20'>
              <button class='tab-btn active' onclick='switchAnalyticsTab("overview")'>Overview</button>
              <button class='tab-btn' onclick='switchAnalyticsTab("performance")'>Performance Trends</button>
              <button class='tab-btn' onclick='switchAnalyticsTab("students")'>Student Analytics</button>
              <button class='tab-btn' onclick='switchAnalyticsTab("courses")'>Course Analytics</button>
              <button class='tab-btn' onclick='switchAnalyticsTab("assignments")'>Assignment Analytics</button>
            </div>
            
            <div id='overview-tab' class='tab-content active'>
              <div class='grid-2 mb-20'>
                <div class='card'>
                  <h4>Performance Trends</h4>
                  <div id='performance-chart'>
                    <canvas id='performance-canvas' width='400' height='200'></canvas>
                  </div>
                </div>
                <div class='card'>
                  <h4>Student Performance Distribution</h4>
                  <div id='student-distribution'>
                    ${renderStudentDistribution()}
                  </div>
                </div>
              </div>
              <div class='grid-2'>
                <div class='card'>
                  <h4>Course Analytics</h4>
                  <div id='course-analytics'>
                    ${renderCourseAnalytics()}
                  </div>
                </div>
                <div class='card'>
                  <h4>Assignment Performance</h4>
                  <div id='assignment-performance'>
                    ${renderAssignmentPerformance()}
                  </div>
                </div>
              </div>
            </div>
            
            <div id='performance-tab' class='tab-content'>
              ${renderPerformanceTrendsTab()}
            </div>
            
            <div id='students-tab' class='tab-content'>
              ${renderStudentAnalyticsTab(students)}
            </div>
            
            <div id='courses-tab' class='tab-content'>
              ${renderCourseAnalyticsTab(courses)}
            </div>
            
            <div id='assignments-tab' class='tab-content'>
              ${renderAssignmentAnalyticsTab(assignments)}
            </div>
          </div>
        </div>

        <!-- Enhanced Report Modal -->
        <div id='report-modal' class='modal'>
          <div class='modal-content' style='max-width: 700px;'>
            <button class='modal-close' onclick='closeModal("report-modal")'><i class='fas fa-times'></i></button>
            <h2>Generate Custom Report</h2>
            <form id='report-form'>
              <div class='grid-2 gap-16'>
                <div class='form-group'>
                  <label>Report Type *</label>
                  <select id='report-type-input' class='form-control' required>
                    <option value=''>Select Report Type</option>
                    <option value='student'>Individual Student Report</option>
                    <option value='class'>Class Performance Report</option>
                    <option value='course'>Course Analytics Report</option>
                    <option value='assignment'>Assignment Analysis Report</option>
                    <option value='engagement'>Engagement Report</option>
                    <option value='parent'>Parent Meeting Report</option>
                    <option value='institutional'>Institutional Review Report</option>
                  </select>
                </div>
                <div class='form-group'>
                  <label>Date Range *</label>
                  <select id='report-date-input' class='form-control' required>
                    <option value=''>Select Date Range</option>
                    <option value='week'>Last Week</option>
                    <option value='month'>Last Month</option>
                    <option value='quarter'>Last Quarter</option>
                    <option value='semester'>This Semester</option>
                    <option value='year'>This Year</option>
                    <option value='custom'>Custom Range</option>
                  </select>
                </div>
              </div>
              
              <div class='form-group' id='custom-date-range' style='display:none;'>
                <label>Custom Date Range</label>
                <div class='grid-2 gap-16'>
                  <input type='date' id='report-start-date' class='form-control'>
                  <input type='date' id='report-end-date' class='form-control'>
                </div>
              </div>
              
              <div class='form-group' id='student-select-group' style='display:none;'>
                <label>Select Student</label>
                <select id='report-student-input' class='form-control'>
                  <option value=''>All Students</option>
                  ${students.map(student => `<option value='${student.id}'>${student.name}</option>`).join('')}
                </select>
              </div>
              
              <div class='form-group' id='course-select-group' style='display:none;'>
                <label>Select Course</label>
                <select id='report-course-input' class='form-control'>
                  <option value=''>All Courses</option>
                  ${courses.map(course => `<option value='${course.id}'>${course.title}</option>`).join('')}
                </select>
              </div>
              
              <div class='form-group'>
                <label>Report Options</label>
                <div class='checkbox-group'>
                  <label><input type='checkbox' id='report-charts-input' checked> Include Charts & Graphs</label>
                  <label><input type='checkbox' id='report-comments-input' checked> Include Teacher Comments</label>
                  <label><input type='checkbox' id='report-recommendations-input' checked> Include Recommendations</label>
                  <label><input type='checkbox' id='report-comparison-input'> Include Peer Comparison</label>
                </div>
              </div>
              
              <div class='form-group'>
                <label>Export Format</label>
                <select id='report-format-input' class='form-control'>
                  <option value='pdf'>PDF Report</option>
                  <option value='excel'>Excel Spreadsheet</option>
                  <option value='csv'>CSV Data</option>
                  <option value='html'>HTML Report</option>
                </select>
              </div>
              
              <div class='form-actions'>
                <button type='button' class='btn btn-secondary' onclick='closeModal("report-modal")'>Cancel</button>
                <button type='submit' class='btn'>Generate Report</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Student Dashboard Modal -->
        <div id='student-dashboard-modal' class='modal'>
          <div class='modal-content' style='max-width: 1000px; max-height: 90vh;'>
            <button class='modal-close' onclick='closeModal("student-dashboard-modal")'><i class='fas fa-times'></i></button>
            <div id='student-dashboard-content'>
              <!-- Content will be loaded dynamically -->
            </div>
          </div>
        </div>
        <style>
          .analytics-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
          }
          .analytics-bar-fill {
            height: 16px;
            background: var(--primary);
            border-radius: 8px;
            min-width: 16px;
          }
          .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: var(--glass);
            border-radius: 6px;
          }
          
          /* Enhanced Analytics Styles */
          .student-analytics-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
          }
          .student-analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          }
          .student-analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
          }
          .student-analytics-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
          }
          .stat-item {
            text-align: center;
          }
          .stat-label {
            display: block;
            font-size: 0.8em;
            color: var(--text-light);
            margin-bottom: 4px;
          }
          .stat-value {
            display: block;
            font-weight: 600;
            color: var(--text);
          }
          .student-analytics-progress {
            margin-top: 12px;
          }
          
          .student-dashboard-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
          }
          .student-dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          }
          .dashboard-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
          }
          .student-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
          }
          .student-avatar-large {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
          }
          .student-info {
            flex: 1;
          }
          .performance-indicator {
            margin-left: auto;
          }
          .dashboard-card-stats {
            margin-bottom: 16px;
          }
          .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
          }
          .stat-number {
            display: block;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--primary);
          }
          .dashboard-card-progress {
            margin-top: 12px;
          }
          .progress-label {
            font-size: 0.9em;
            color: var(--text-light);
            margin-bottom: 6px;
          }
          
          .individual-student-dashboard {
            padding: 20px;
          }
          .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
          }
          .student-profile {
            display: flex;
            align-items: center;
            gap: 16px;
          }
          .student-details h3 {
            margin: 0 0 4px 0;
          }
          .student-details p {
            margin: 0;
          }
          .dashboard-actions {
            display: flex;
            gap: 12px;
          }
          
          .analytics-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
          }
          .analytics-table th,
          .analytics-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--glass-border);
          }
          .analytics-table th {
            background: var(--medium-gray);
            font-weight: 600;
            color: var(--text);
          }
          .analytics-table tr:hover {
            background: var(--light-gray);
          }
          .table-responsive {
            overflow-x: auto;
          }
          
          .mt-10 {
            margin-top: 10px;
          }

          /* ===== ENHANCED SETTINGS STYLES ===== */
          .tab-navigation {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
            overflow-x: auto;
          }

          .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
          }

          .tab-btn:hover {
            color: var(--primary);
            background-color: #f8f9fa;
          }

          .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background-color: #f8f9fa;
          }

          .tab-content {
            display: none;
          }

          .tab-content.active {
            display: block;
          }

          /* Profile Picture */
          .profile-picture-section {
            text-align: center;
          }

          .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
          }

          .profile-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #999;
            border: 3px solid var(--primary);
            overflow: hidden;
          }

          .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
          }

          /* Checkbox Groups */
          .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
          }

          .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            cursor: pointer;
          }

          .checkbox-group input[type="checkbox"] {
            margin: 0;
          }

          /* Grid Layouts */
          .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
          }

          /* Accessibility Results */
          .accessibility-results {
            margin: 20px 0;
          }

          .result-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-weight: 500;
          }

          .result-item.pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
          }

          .result-item.fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
          }

          .result-item i {
            font-size: 16px;
          }

          /* Responsive Design */
          @media (max-width: 768px) {
            .tab-navigation {
              flex-wrap: wrap;
            }
            
            .tab-btn {
              flex: 1;
              min-width: 120px;
              text-align: center;
            }
            
            .grid-3 {
              grid-template-columns: 1fr;
            }
          }

          /* Accessibility CSS Variables */
          [data-font-size="small"] {
            font-size: 0.9em;
          }

          [data-font-size="large"] {
            font-size: 1.1em;
          }

          [data-font-size="extra-large"] {
            font-size: 1.3em;
          }

          [data-font-family="arial"] {
            font-family: Arial, sans-serif;
          }

          [data-font-family="times"] {
            font-family: "Times New Roman", serif;
          }

          [data-font-family="courier"] {
            font-family: "Courier New", monospace;
          }

          [data-font-family="dyslexic"] {
            font-family: "OpenDyslexic", Arial, sans-serif;
          }

          [data-line-spacing="relaxed"] {
            line-height: 1.6;
          }

          [data-line-spacing="double"] {
            line-height: 2;
          }

          /* High Contrast Mode */
          [data-theme="high-contrast"] {
            --primary-color: #000000;
            --secondary-color: #ffffff;
            --background-color: #ffffff;
            --text-color: #000000;
            --border-color: #000000;
          }

          [data-theme="high-contrast"] .card {
            border: 2px solid #000000;
            background-color: #ffffff;
          }

          /* Color Blind Support */
          [data-color-scheme="protanopia"] {
            --primary-color: #0066cc;
            --secondary-color: #ff6600;
          }

          [data-color-scheme="deuteranopia"] {
            --primary-color: #0066cc;
            --secondary-color: #ff6600;
          }

          [data-color-scheme="tritanopia"] {
            --primary-color: #cc0066;
            --secondary-color: #00cc66;
          }

          /* Focus Indicators */
          [data-focus-indicators="true"] *:focus {
            outline: 3px solid #ff6600;
            outline-offset: 2px;
          }

          /* Reduce Motion */
          [data-reduce-motion="true"] * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
          }

          /* ===== ENHANCED DASHBOARD STYLES ===== */
          .current-date {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
          }

          /* Stats Boxes */
          .stat-box {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
          }

          .stat-box:hover {
            transform: translateY(-2px);
          }

          .stat-box.primary { border-left: 4px solid var(--primary); }
          .stat-box.secondary { border-left: 4px solid var(--secondary); }
          .stat-box.warning { border-left: 4px solid var(--warning); }
          .stat-box.success { border-left: 4px solid var(--success); }

          .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
          }

          .stat-box.primary .stat-icon { background: var(--primary); }
          .stat-box.secondary .stat-icon { background: var(--secondary); }
          .stat-box.warning .stat-icon { background: var(--warning); }
          .stat-box.success .stat-icon { background: var(--success); }

          .stat-info {
            flex: 1;
          }

          .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
          }

          .stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
          }

          /* Quick Actions */
          .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
          }

          .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px 10px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--dark);
            text-decoration: none;
          }

          .action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
          }

          .action-btn i {
            font-size: 1.3rem;
            color: var(--primary);
            transition: color 0.3s ease;
          }

          .action-btn:hover i {
            color: white;
          }

          .action-btn span {
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
          }

          /* Announcements List */
          .announcements-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
          }

          .announcement-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.3s ease;
          }

          .announcement-item:hover {
            background: #e9ecef;
          }

          .announcement-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
          }

          .announcement-content {
            flex: 1;
          }

          .announcement-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
            font-size: 0.9rem;
          }

          .announcement-date {
            font-size: 0.8rem;
            color: #666;
          }

          /* Deadlines List */
          .deadlines-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
          }

          .deadline-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.3s ease;
          }

          .deadline-item:hover {
            background: #e9ecef;
          }

          .deadline-info {
            flex: 1;
          }

          .deadline-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
            font-size: 0.9rem;
          }

          .deadline-course {
            font-size: 0.8rem;
            color: #666;
          }

          .deadline-date {
            font-size: 0.8rem;
            color: var(--warning);
            font-weight: 500;
          }

          /* Performance List */
          .performance-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
          }

          .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.3s ease;
          }

          .performance-item:hover {
            background: #e9ecef;
          }

          .performance-info {
            flex: 1;
          }

          .course-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
            font-size: 0.9rem;
          }

          .course-students {
            font-size: 0.8rem;
            color: #666;
          }

          .performance-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
          }

          .progress-bar {
            flex: 1;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
          }

          .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.3s ease;
          }

          .progress-text {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--dark);
            min-width: 35px;
          }

          /* Performance List */
          .performance-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
          }

          .performance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
          }

          .performance-info {
            flex: 1;
          }

          .course-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 3px;
            font-size: 0.9rem;
          }

          .course-students {
            font-size: 0.8rem;
            color: #666;
          }

          .performance-bar {
            display: flex;
            align-items: center;
            gap: 8px;
          }

          .progress-bar {
            width: 80px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
          }

          .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 3px;
            transition: width 0.3s ease;
          }

          .progress-text {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.8rem;
            min-width: 35px;
          }

          /* Grid Layouts */
          .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
          }

          .mb-30 {
            margin-bottom: 30px;
          }

          .mb-15 {
            margin-bottom: 15px;
          }

          /* Responsive Design */
          @media (max-width: 768px) {
            .grid-4 {
              grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-actions {
              grid-template-columns: repeat(2, 1fr);
            }
          }

          @media (max-width: 480px) {
            .grid-4 {
              grid-template-columns: 1fr;
            }
          }
        </style>
      `;
      setTimeout(initAnalyticsEvents, 0);
      setTimeout(drawPerformanceChart, 100);
    }

    // ===== ANALYTICS LOGIC =====
    function calculateEngagement() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return 0;
      let total = 0;
      students.forEach(student => {
        total += (student.attendance || 0) + (student.progress || 0);
      });
      return Math.round(total / (students.length * 2));
    }
    function calculateCompletion() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      if (students.length === 0 || courses.length === 0) return 0;
      let completed = 0;
      students.forEach(student => {
        if (student.progress >= 80) completed++;
      });
      return Math.round((completed / students.length) * 100);
    }
    function calculateSubmissionRate() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (assignments.length === 0 || students.length === 0) return 0;
      let totalSubmissions = 0;
      let totalPossible = assignments.length * students.length;
      assignments.forEach(assignment => {
        if (assignment.submissions) {
          totalSubmissions += assignment.submissions.length;
        }
      });
      return Math.round((totalSubmissions / totalPossible) * 100);
    }
    function renderCourseAnalytics() {
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (courses.length === 0) return '<p class="text-muted">No courses available</p>';
      return courses.map(course => {
        const enrolledStudents = students.filter(s => s.courses && s.courses.includes(courses.indexOf(course))).length;
        const avgProgress = enrolledStudents > 0 ? 
          Math.round(students.filter(s => s.courses && s.courses.includes(courses.indexOf(course)))
            .reduce((sum, s) => sum + (s.progress || 0), 0) / enrolledStudents) : 0;
        return `
          <div class='performance-item'>
            <div>
              <strong>${course.title}</strong>
              <div class='text-muted'>${enrolledStudents} students</div>
            </div>
            <div class='text-right'>
              <div>${avgProgress}% progress</div>
              <div class='progress-bar' style='width:60px;'>
                <div class='progress-fill' style='width: ${avgProgress}%'></div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    function renderStudentDistribution() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      if (students.length === 0) return '<p class="text-muted">No students enrolled</p>';
      const excellent = students.filter(s => (s.progress || 0) >= 90).length;
      const good = students.filter(s => (s.progress || 0) >= 80 && (s.progress || 0) < 90).length;
      const average = students.filter(s => (s.progress || 0) >= 70 && (s.progress || 0) < 80).length;
      const below = students.filter(s => (s.progress || 0) < 70).length;
      return `
        <div class='analytics-bar'>
          <span>Excellent (90%+)</span>
          <div class='analytics-bar-fill' style='width: ${(excellent/students.length)*100}%'></div>
          <span>${excellent}</span>
        </div>
        <div class='analytics-bar'>
          <span>Good (80-89%)</span>
          <div class='analytics-bar-fill' style='width: ${(good/students.length)*100}%'></div>
          <span>${good}</span>
        </div>
        <div class='analytics-bar'>
          <span>Average (70-79%)</span>
          <div class='analytics-bar-fill' style='width: ${(average/students.length)*100}%'></div>
          <span>${average}</span>
        </div>
        <div class='analytics-bar'>
          <span>Below Average (<70%)</span>
          <div class='analytics-bar-fill' style='width: ${(below/students.length)*100}%'></div>
          <span>${below}</span>
        </div>
      `;
    }
    function renderAssignmentPerformance() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      if (assignments.length === 0) return '<p class="text-muted">No assignments available</p>';
      return assignments.slice(-5).reverse().map(assignment => {
        const avgGrade = assignment.grades ? 
          Math.round(Object.values(assignment.grades).reduce((sum, grade) => sum + (grade || 0), 0) / Object.keys(assignment.grades).length) : 0;
        return `
          <div class='performance-item'>
            <div>
              <strong>${assignment.title}</strong>
              <div class='text-muted'>${assignment.type || 'assignment'}</div>
            </div>
            <div class='text-right'>
              <div>${avgGrade}% average</div>
              <span class='badge ${assignment.graded ? 'badge-success' : 'badge-warning'}'>${assignment.graded ? 'Graded' : 'Pending'}</span>
            </div>
          </div>
        `;
      }).join('');
    }
    function drawPerformanceChart() {
      const canvas = document.getElementById('performance-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      // Clear canvas
      ctx.clearRect(0, 0, width, height);
      
      // Draw simple line chart
      ctx.strokeStyle = 'var(--primary)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      
      const data = [65, 72, 68, 75, 80, 78, 82]; // Sample data
      const stepX = width / (data.length - 1);
      const maxValue = Math.max(...data);
      
      data.forEach((value, index) => {
        const x = index * stepX;
        const y = height - (value / maxValue) * height;
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      
      ctx.stroke();
      
      // Draw data points
      ctx.fillStyle = 'var(--primary)';
      data.forEach((value, index) => {
        const x = index * stepX;
        const y = height - (value / maxValue) * height;
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, 2 * Math.PI);
        ctx.fill();
      });
    }
    function generateReport() {
      document.getElementById('report-modal').style.display = 'flex';
    }
    function createReport() {
      const type = document.getElementById('report-type-input').value;
      const dateRange = document.getElementById('report-date-input').value;
      const includeCharts = document.getElementById('report-charts-input').checked;
      
      alert(`Generating ${type} report for ${dateRange}${includeCharts ? ' with charts' : ''}...`);
      closeModal('report-modal');
    }
    function exportAnalytics() {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      async function loadCourses() {
  try {
    const res = await fetch('http://localhost:3001/courses');
    const courses = await res.json();
    // Render courses in your UI
  } catch (err) {
    alert('Failed to load courses');
  }
}
      
      let csv = 'Analytics Report\n';
      csv += 'Metric,Value\n';
      csv += `Student Engagement,${calculateEngagement()}%\n`;
      csv += `Course Completion,${calculateCompletion()}%\n`;
      csv += `Assignment Submission Rate,${calculateSubmissionRate()}%\n`;
      csv += `Total Students,${students.length}\n`;
      csv += `Total Courses,${courses.length}\n`;
      csv += `Total Assignments,${assignments.length}\n`;
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'analytics_report.csv';
      a.click();
      window.URL.revokeObjectURL(url);
    }
    function initAnalyticsEvents() {
      window.generateReport = generateReport;
      window.createReport = createReport;
      window.exportAnalytics = exportAnalytics;
      window.switchAnalyticsTab = switchAnalyticsTab;
      window.openStudentDashboard = openStudentDashboard;
      window.viewStudentAnalytics = viewStudentAnalytics;
      
      // Add form event listeners
      setTimeout(() => {
        const reportForm = document.getElementById('report-form');
        if (reportForm) {
          reportForm.addEventListener('submit', function(e) {
            e.preventDefault();
            createReport();
          });
        }
        
        // Add dynamic form handlers
        const reportTypeInput = document.getElementById('report-type-input');
        const reportDateInput = document.getElementById('report-date-input');
        
        if (reportTypeInput) {
          reportTypeInput.addEventListener('change', handleReportTypeChange);
        }
        
        if (reportDateInput) {
          reportDateInput.addEventListener('change', handleReportDateChange);
        }
      }, 100);
    }

    // ===== ENHANCED ANALYTICS FUNCTIONS =====

    // Tab switching for analytics
    function switchAnalyticsTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Calculate average grade
    function calculateAverageGrade() {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      if (assignments.length === 0) return 0;
      
      let totalGrade = 0;
      let gradeCount = 0;
      
      assignments.forEach(assignment => {
        if (assignment.grades) {
          Object.values(assignment.grades).forEach(grade => {
            if (grade !== null && grade !== undefined) {
              totalGrade += grade;
              gradeCount++;
            }
          });
        }
      });
      
      return gradeCount > 0 ? Math.round(totalGrade / gradeCount) : 0;
    }

    // Render performance trends tab
    function renderPerformanceTrendsTab() {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Grade Trends Over Time</h4>
            <canvas id="grade-trends-canvas" width="400" height="200"></canvas>
          </div>
          <div class="card">
            <h4>Engagement Trends</h4>
            <canvas id="engagement-trends-canvas" width="400" height="200"></canvas>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <h4>Attendance Patterns</h4>
            <div id="attendance-patterns">
              ${renderAttendancePatterns()}
            </div>
          </div>
          <div class="card">
            <h4>Assignment Completion Trends</h4>
            <div id="completion-trends">
              ${renderCompletionTrends()}
            </div>
          </div>
        </div>
      `;
    }

    // Render student analytics tab
    function renderStudentAnalyticsTab(students) {
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Individual Student Analytics</h4>
          <div class="flex gap-10">
            <select id="student-analytics-filter" class="form-control" onchange="filterStudentAnalytics()">
              <option value="">All Students</option>
              <option value="top">Top Performers</option>
              <option value="struggling">Struggling Students</option>
              <option value="improving">Improving Students</option>
            </select>
            <button class="btn btn-secondary" onclick="exportStudentAnalytics()">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
        
        <div class="grid-3">
          ${students.map(student => `
            <div class="student-analytics-card" onclick="viewStudentAnalytics(${student.id})">
              <div class="student-analytics-header">
                <h5>${student.name}</h5>
                <span class="badge badge-${getPerformanceBadge(student.progress || 0)}">${student.progress || 0}%</span>
              </div>
              <div class="student-analytics-stats">
                <div class="stat-item">
                  <span class="stat-label">Attendance</span>
                  <span class="stat-value">${student.attendance || 0}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Avg Grade</span>
                  <span class="stat-value">${calculateStudentAverageGrade(student.id)}%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Assignments</span>
                  <span class="stat-value">${getStudentAssignmentCount(student.id)}</span>
                </div>
              </div>
              <div class="student-analytics-progress">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${student.progress || 0}%"></div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Render course analytics tab
    function renderCourseAnalyticsTab(courses) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Course Performance Overview</h4>
            <canvas id="course-performance-canvas" width="400" height="200"></canvas>
          </div>
          <div class="card">
            <h4>Enrollment Trends</h4>
            <div id="enrollment-trends">
              ${renderEnrollmentTrends()}
            </div>
          </div>
        </div>
        <div class="card">
          <h4>Detailed Course Analytics</h4>
          <div class="table-responsive">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>Course</th>
                  <th>Students</th>
                  <th>Avg Grade</th>
                  <th>Completion Rate</th>
                  <th>Engagement</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                ${courses.map(course => {
                  const stats = calculateCourseStats(course.id);
                  return `
                    <tr>
                      <td><strong>${course.title}</strong></td>
                      <td>${stats.studentCount}</td>
                      <td>${stats.avgGrade}%</td>
                      <td>${stats.completionRate}%</td>
                      <td>${stats.engagement}%</td>
                      <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewCourseAnalytics(${course.id})">
                          <i class="fas fa-chart-line"></i> Details
                        </button>
                      </td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Render assignment analytics tab
    function renderAssignmentAnalyticsTab(assignments) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Assignment Performance Overview</h4>
            <canvas id="assignment-performance-canvas" width="400" height="200"></canvas>
          </div>
          <div class="card">
            <h4>Submission Trends</h4>
            <div id="submission-trends">
              ${renderSubmissionTrends()}
            </div>
          </div>
        </div>
        <div class="card">
          <h4>Assignment Details</h4>
          <div class="table-responsive">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th>Assignment</th>
                  <th>Type</th>
                  <th>Due Date</th>
                  <th>Submissions</th>
                  <th>Avg Grade</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                ${assignments.map(assignment => {
                  const stats = calculateAssignmentStats(assignment.id);
                  return `
                    <tr>
                      <td><strong>${assignment.title}</strong></td>
                      <td>${assignment.type || 'Assignment'}</td>
                      <td>${new Date(assignment.dueDate).toLocaleDateString()}</td>
                      <td>${stats.submissionCount}/${stats.totalStudents}</td>
                      <td>${stats.avgGrade}%</td>
                      <td>
                        <span class="badge badge-${assignment.graded ? 'success' : 'warning'}">
                          ${assignment.graded ? 'Graded' : 'Pending'}
                        </span>
                      </td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
    }

    // Student dashboard functions
    function openStudentDashboard() {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      
      document.getElementById('student-dashboard-content').innerHTML = `
        <div class="student-dashboard">
          <div class="flex flex-between flex-center mb-20">
            <h3>Student Performance Dashboards</h3>
            <div class="flex gap-10">
              <select id="dashboard-student-filter" class="form-control" onchange="filterDashboardStudents()">
                <option value="">All Students</option>
                <option value="course">By Course</option>
                <option value="grade">By Grade Level</option>
                <option value="performance">By Performance</option>
              </select>
              <button class="btn btn-secondary" onclick="exportStudentDashboards()">
                <i class="fas fa-download"></i> Export All
              </button>
            </div>
          </div>
          
          <div class="grid-3">
            ${students.map(student => `
              <div class="student-dashboard-card" onclick="viewStudentDashboard(${student.id})">
                <div class="dashboard-card-header">
                  <div class="student-avatar">
                    <i class="fas fa-user"></i>
                  </div>
                  <div class="student-info">
                    <h5>${student.name}</h5>
                    <p class="text-muted">${student.email}</p>
                  </div>
                  <div class="performance-indicator">
                    <span class="badge badge-${getPerformanceBadge(student.progress || 0)}">${student.progress || 0}%</span>
                  </div>
                </div>
                <div class="dashboard-card-stats">
                  <div class="stat-grid">
                    <div class="stat-item">
                      <span class="stat-number">${student.attendance || 0}%</span>
                      <span class="stat-label">Attendance</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-number">${calculateStudentAverageGrade(student.id)}%</span>
                      <span class="stat-label">Avg Grade</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-number">${getStudentAssignmentCount(student.id)}</span>
                      <span class="stat-label">Assignments</span>
                    </div>
                  </div>
                </div>
                <div class="dashboard-card-progress">
                  <div class="progress-label">Overall Progress</div>
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${student.progress || 0}%"></div>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      document.getElementById('student-dashboard-modal').style.display = 'flex';
    }

    function viewStudentDashboard(studentId) {
      const students = JSON.parse(localStorage.getItem('students') || '[]');
      const student = students.find(s => s.id == studentId);
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      if (!student) return;
      
      document.getElementById('student-dashboard-content').innerHTML = `
        <div class="individual-student-dashboard">
          <div class="dashboard-header">
            <div class="student-profile">
              <div class="student-avatar-large">
                <i class="fas fa-user"></i>
              </div>
              <div class="student-details">
                <h3>${student.name}</h3>
                <p class="text-muted">${student.email}</p>
                <p class="text-muted">Grade ${student.grade || 'N/A'}</p>
              </div>
            </div>
            <div class="dashboard-actions">
              <button class="btn btn-secondary" onclick="generateStudentReport(${studentId})">
                <i class="fas fa-file-alt"></i> Generate Report
              </button>
              <button class="btn" onclick="openStudentDashboard()">
                <i class="fas fa-arrow-left"></i> Back to All Students
              </button>
            </div>
          </div>
          
          <div class="grid-4 mb-20">
            <div class="card">
              <h4>Overall Progress</h4>
              <div class="card-count">${student.progress || 0}%</div>
              <div class="progress-bar mt-10">
                <div class="progress-fill" style="width: ${student.progress || 0}%"></div>
              </div>
            </div>
            <div class="card">
              <h4>Attendance Rate</h4>
              <div class="card-count">${student.attendance || 0}%</div>
              <div class="progress-bar mt-10">
                <div class="progress-fill" style="width: ${student.attendance || 0}%"></div>
              </div>
            </div>
            <div class="card">
              <h4>Average Grade</h4>
              <div class="card-count">${calculateStudentAverageGrade(studentId)}%</div>
              <div class="progress-bar mt-10">
                <div class="progress-fill" style="width: ${calculateStudentAverageGrade(studentId)}%"></div>
              </div>
            </div>
            <div class="card">
              <h4>Assignments Completed</h4>
              <div class="card-count">${getStudentAssignmentCount(studentId)}</div>
              <p class="text-muted">out of ${assignments.length} total</p>
            </div>
          </div>
          
          <div class="grid-2 mb-20">
            <div class="card">
              <h4>Grade Trends</h4>
              <canvas id="student-grade-trends" width="400" height="200"></canvas>
            </div>
            <div class="card">
              <h4>Assignment Performance</h4>
              <div id="student-assignment-performance">
                ${renderStudentAssignmentPerformance(studentId)}
              </div>
            </div>
          </div>
          
          <div class="card">
            <h4>Recent Activity</h4>
            <div id="student-recent-activity">
              ${renderStudentRecentActivity(studentId)}
            </div>
          </div>
        </div>
      `;
      
      // Draw student-specific charts
      setTimeout(() => {
        drawStudentGradeTrends(studentId);
      }, 100);
    }

    // Utility functions for analytics
    function getPerformanceBadge(progress) {
      if (progress >= 90) return 'success';
      if (progress >= 80) return 'primary';
      if (progress >= 70) return 'warning';
      return 'danger';
    }

    function calculateStudentAverageGrade(studentId) {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let totalGrade = 0;
      let gradeCount = 0;
      
      assignments.forEach(assignment => {
        if (assignment.grades && assignment.grades[studentId]) {
          totalGrade += assignment.grades[studentId];
          gradeCount++;
        }
      });
      
      return gradeCount > 0 ? Math.round(totalGrade / gradeCount) : 0;
    }

    function getStudentAssignmentCount(studentId) {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let completed = 0;
      
      assignments.forEach(assignment => {
        if (assignment.submissions && assignment.submissions.find(s => s.studentId == studentId)) {
          completed++;
        }
      });
      
      return completed;
    }

    function calculateCourseStats(courseId) {
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      const courseStudents = students.filter(s => s.courses && s.courses.includes(courseId));
      const courseAssignments = assignments.filter(a => a.courseId == courseId);
      
      let totalGrade = 0;
      let gradeCount = 0;
      
      courseAssignments.forEach(assignment => {
        if (assignment.grades) {
          Object.values(assignment.grades).forEach(grade => {
            if (grade !== null && grade !== undefined) {
              totalGrade += grade;
              gradeCount++;
            }
          });
        }
      });
      
      const avgGrade = gradeCount > 0 ? Math.round(totalGrade / gradeCount) : 0;
      const completionRate = courseStudents.length > 0 ? 
        Math.round(courseStudents.filter(s => s.progress >= 80).length / courseStudents.length * 100) : 0;
      const engagement = courseStudents.length > 0 ? 
        Math.round(courseStudents.reduce((sum, s) => sum + (s.attendance || 0), 0) / courseStudents.length) : 0;
      
      return {
        studentCount: courseStudents.length,
        avgGrade: avgGrade,
        completionRate: completionRate,
        engagement: engagement
      };
    }

    function calculateAssignmentStats(assignmentId) {
      let assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      let students = JSON.parse(localStorage.getItem('students') || '[]');
      
      const assignment = assignments.find(a => a.id == assignmentId);
      if (!assignment) return { submissionCount: 0, totalStudents: 0, avgGrade: 0 };
      
      const submissionCount = assignment.submissions ? assignment.submissions.length : 0;
      const totalStudents = students.length;
      
      let totalGrade = 0;
      let gradeCount = 0;
      
      if (assignment.grades) {
        Object.values(assignment.grades).forEach(grade => {
          if (grade !== null && grade !== undefined) {
            totalGrade += grade;
            gradeCount++;
          }
        });
      }
      
      const avgGrade = gradeCount > 0 ? Math.round(totalGrade / gradeCount) : 0;
      
      return {
        submissionCount: submissionCount,
        totalStudents: totalStudents,
        avgGrade: avgGrade
      };
    }

    // Report form handlers
    function handleReportTypeChange() {
      const reportType = document.getElementById('report-type-input').value;
      const studentGroup = document.getElementById('student-select-group');
      const courseGroup = document.getElementById('course-select-group');
      
      studentGroup.style.display = reportType === 'student' ? 'block' : 'none';
      courseGroup.style.display = reportType === 'course' ? 'block' : 'none';
    }

    function handleReportDateChange() {
      const dateRange = document.getElementById('report-date-input').value;
      const customRange = document.getElementById('custom-date-range');
      
      customRange.style.display = dateRange === 'custom' ? 'block' : 'none';
    }

    // Enhanced report generation
    function createReport() {
      const type = document.getElementById('report-type-input').value;
      const dateRange = document.getElementById('report-date-input').value;
      const includeCharts = document.getElementById('report-charts-input').checked;
      const includeComments = document.getElementById('report-comments-input').checked;
      const includeRecommendations = document.getElementById('report-recommendations-input').checked;
      const includeComparison = document.getElementById('report-comparison-input').checked;
      const format = document.getElementById('report-format-input').value;
      
      if (!type || !dateRange) {
        showNotification('Please select report type and date range', 'error');
        return;
      }
      
      // Show success message
      showNotification(`Generating ${type} report in ${format.toUpperCase()} format...`, 'success');
      closeModal('report-modal');
      
      // Simulate report generation
      setTimeout(() => {
        showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`, 'success');
      }, 2000);
    }

    // Placeholder functions for rendering
    function renderAttendancePatterns() {
      return '<p class="text-muted">Attendance patterns visualization would be displayed here</p>';
    }

    function renderCompletionTrends() {
      return '<p class="text-muted">Completion trends visualization would be displayed here</p>';
    }

    function renderEnrollmentTrends() {
      return '<p class="text-muted">Enrollment trends visualization would be displayed here</p>';
    }

    function renderSubmissionTrends() {
      return '<p class="text-muted">Submission trends visualization would be displayed here</p>';
    }

    function renderStudentAssignmentPerformance(studentId) {
      return '<p class="text-muted">Student assignment performance details would be displayed here</p>';
    }

    function renderStudentRecentActivity(studentId) {
      return '<p class="text-muted">Student recent activity would be displayed here</p>';
    }

    function drawStudentGradeTrends(studentId) {
      // Placeholder for student grade trends chart
      console.log('Drawing grade trends for student:', studentId);
    }

    function filterStudentAnalytics() {
      console.log('Filtering student analytics...');
    }

    function filterDashboardStudents() {
      console.log('Filtering dashboard students...');
    }

    function exportStudentAnalytics() {
      showNotification('Student analytics exported successfully!', 'success');
    }

    function exportStudentDashboards() {
      showNotification('All student dashboards exported successfully!', 'success');
    }

    function generateStudentReport(studentId) {
      showNotification('Student report generated successfully!', 'success');
    }

    function viewStudentAnalytics(studentId) {
      viewStudentDashboard(studentId);
    }

    function viewCourseAnalytics(courseId) {
      showNotification('Course analytics view would open here', 'info');
    }

    // ===== ENHANCED SETTINGS & INTEGRATION SECTION =====
    function renderSettings() {
      let settings = JSON.parse(localStorage.getItem('settings') || '{}');
      let teacherProfile = JSON.parse(localStorage.getItem('teacherProfile') || '{}');
      
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3>Settings & Integration</h3>
            <div class='flex gap-10'>
              <button class='btn btn-secondary' onclick='resetToDefaults()'>Reset to Defaults</button>
              <button class='btn' onclick='saveAllSettings()'>Save All Settings</button>
            </div>
          </div>
          
          <!-- Settings Tabs -->
          <div class='card'>
            <div class='tab-navigation mb-20'>
              <button class='tab-btn active' onclick='switchSettingsTab("profile")'>Profile & Personalization</button>
              <button class='tab-btn' onclick='switchSettingsTab("account")'>Account Settings</button>
              <button class='tab-btn' onclick='switchSettingsTab("accessibility")'>Accessibility & Learning</button>
              <button class='tab-btn' onclick='switchSettingsTab("course")'>Course Settings</button>
              <button class='tab-btn' onclick='switchSettingsTab("integration")'>Integration</button>
              <button class='tab-btn' onclick='switchSettingsTab("security")'>Security & Privacy</button>
              <button class='tab-btn' onclick='switchSettingsTab("automation")'>Automation</button>
              <button class='tab-btn' onclick='switchSettingsTab("data")'>Data Management</button>
            </div>
            
            <!-- Profile & Personalization Tab -->
            <div id='profile-tab' class='tab-content active'>
              ${renderProfileSettings(teacherProfile)}
            </div>
            
            <!-- Account Settings Tab -->
            <div id='account-tab' class='tab-content'>
              ${renderAccountSettings(settings)}
            </div>
            
            <!-- Accessibility & Learning Support Tab -->
            <div id='accessibility-tab' class='tab-content'>
              ${renderAccessibilitySettings(settings)}
            </div>
            
            <!-- Course Settings Tab -->
            <div id='course-tab' class='tab-content'>
              ${renderCourseSettings(settings)}
            </div>
            
            <!-- Integration Settings Tab -->
            <div id='integration-tab' class='tab-content'>
              ${renderIntegrationSettings(settings)}
            </div>
            
            <!-- Security & Privacy Tab -->
            <div id='security-tab' class='tab-content'>
              ${renderSecuritySettings(settings)}
            </div>
            
            <!-- Automation Tab -->
            <div id='automation-tab' class='tab-content'>
              ${renderAutomationSettings(settings)}
            </div>
            
            <!-- Data Management Tab -->
            <div id='data-tab' class='tab-content'>
              ${renderDataManagementSettings()}
            </div>
          </div>
        </div>
        <div id='backup-modal' class='modal'>
          <div class='modal-content'>
            <button class='modal-close' onclick='closeModal("backup-modal")'><i class='fas fa-times'></i></button>
            <h2>Backup Data</h2>
            <div class='form-group'>
              <label>Include in backup:</label>
              <div>
                <label><input type='checkbox' checked> Courses</label>
              </div>
              <div>
                <label><input type='checkbox' checked> Students</label>
              </div>
              <div>
                <label><input type='checkbox' checked> Assignments</label>
              </div>
              <div>
                <label><input type='checkbox' checked> Grades</label>
              </div>
              <div>
                <label><input type='checkbox' checked> Settings</label>
              </div>
            </div>
            <button class='btn' onclick='downloadBackup()'>Download Backup</button>
          </div>
        </div>
      `;
      setTimeout(initSettingsEvents, 0);
    }

    // ===== SETTINGS LOGIC =====
    function saveAllSettings() {
      let settings = {};
      let teacherProfile = {};
      
      // Profile & Personalization Settings
      teacherProfile.fullName = document.getElementById('teacher-name')?.value || '';
      teacherProfile.email = document.getElementById('teacher-email')?.value || '';
      teacherProfile.phone = document.getElementById('teacher-phone')?.value || '';
      teacherProfile.department = document.getElementById('teacher-department')?.value || '';
      teacherProfile.bio = document.getElementById('teacher-bio')?.value || '';
      teacherProfile.officeHours = document.getElementById('teacher-office-hours')?.value || '';
      teacherProfile.dashboardLayout = document.getElementById('dashboard-layout')?.value || 'default';
      teacherProfile.defaultView = document.getElementById('default-view')?.value || 'dashboard';
      teacherProfile.colorScheme = document.getElementById('color-scheme')?.value || 'blue';
      teacherProfile.timezone = document.getElementById('timezone')?.value || 'UTC';
      teacherProfile.dateFormat = document.getElementById('date-format')?.value || 'MM/DD/YYYY';
      
      // Quick Actions
      teacherProfile.quickActions = [];
      if (document.getElementById('quick-grading')?.checked) teacherProfile.quickActions.push('grading');
      if (document.getElementById('quick-announcements')?.checked) teacherProfile.quickActions.push('announcements');
      if (document.getElementById('quick-attendance')?.checked) teacherProfile.quickActions.push('attendance');
      if (document.getElementById('quick-reports')?.checked) teacherProfile.quickActions.push('reports');
      if (document.getElementById('quick-messaging')?.checked) teacherProfile.quickActions.push('messaging');
      
      // Notification Preferences
      teacherProfile.emailNotifications = {
        assignments: document.getElementById('email-assignments')?.checked !== false,
        grades: document.getElementById('email-grades')?.checked !== false,
        attendance: document.getElementById('email-attendance')?.checked !== false,
        messages: document.getElementById('email-messages')?.checked !== false,
        reports: document.getElementById('email-reports')?.checked !== false
      };
      
      teacherProfile.appNotifications = {
        assignments: document.getElementById('app-assignments')?.checked !== false,
        grades: document.getElementById('app-grades')?.checked !== false,
        attendance: document.getElementById('app-attendance')?.checked !== false,
        messages: document.getElementById('app-messages')?.checked !== false,
        reports: document.getElementById('app-reports')?.checked !== false
      };
      
      teacherProfile.notificationTiming = {
        immediate: document.getElementById('notify-immediate')?.checked !== false,
        daily: document.getElementById('notify-daily')?.checked !== false,
        weekly: document.getElementById('notify-weekly')?.checked !== false
      };
      
      // Account settings
      settings.emailNotifications = document.getElementById('email-notifications')?.checked;
      settings.autoSave = document.getElementById('auto-save')?.checked;
      settings.theme = document.getElementById('theme-select')?.value;
      settings.language = document.getElementById('language-select')?.value;
      
      // Accessibility Settings
      settings.accessibility = {
        highContrast: document.getElementById('high-contrast')?.checked || false,
        fontSize: document.getElementById('font-size')?.value || 'medium',
        fontFamily: document.getElementById('font-family')?.value || 'default',
        lineSpacing: document.getElementById('line-spacing')?.value || 'normal',
        reduceMotion: document.getElementById('reduce-motion')?.checked || false,
        focusIndicators: document.getElementById('focus-indicators')?.checked !== false,
        screenReader: document.getElementById('screen-reader')?.checked || false,
        keyboardNavigation: document.getElementById('keyboard-nav')?.checked !== false,
        voiceCommands: document.getElementById('voice-commands')?.checked || false,
        textToSpeech: document.getElementById('text-to-speech')?.checked || false,
        readingGuides: document.getElementById('reading-guides')?.checked || false,
        colorBlindSupport: document.getElementById('color-blind-support')?.value || 'none'
      };
      
      // Learning Accommodations
      settings.accommodations = {
        magnifier: document.getElementById('accommodation-magnifier')?.checked || false,
        highlight: document.getElementById('accommodation-highlight')?.checked || false,
        zoom: document.getElementById('accommodation-zoom')?.checked || false,
        contrast: document.getElementById('accommodation-contrast')?.checked || false,
        captions: document.getElementById('accommodation-captions')?.checked || false,
        transcript: document.getElementById('accommodation-transcript')?.checked || false,
        volume: document.getElementById('accommodation-volume')?.checked || false,
        speed: document.getElementById('accommodation-speed')?.checked || false,
        timer: document.getElementById('accommodation-timer')?.checked || false,
        breaks: document.getElementById('accommodation-breaks')?.checked || false,
        simplified: document.getElementById('accommodation-simplified')?.checked || false,
        reminders: document.getElementById('accommodation-reminders')?.checked || false
      };
      
      // Course settings
      settings.defaultDuration = parseInt(document.getElementById('default-duration')?.value) || 12;
      settings.gradingScale = document.getElementById('grading-scale')?.value || 'letter';
      settings.allowLate = document.getElementById('allow-late')?.checked !== false;
      settings.latePenalty = parseInt(document.getElementById('late-penalty')?.value) || 10;
      
      // Course Features
      settings.courseFeatures = {
        discussions: document.getElementById('enable-discussions')?.checked !== false,
        peerReviews: document.getElementById('enable-peer-reviews')?.checked || false,
        groupAssignments: document.getElementById('enable-group-assignments')?.checked || false,
        attendance: document.getElementById('enable-attendance')?.checked !== false
      };
      
      // Integration settings
      settings.ssoProvider = document.getElementById('sso-provider')?.value || 'none';
      settings.ltiEnabled = document.getElementById('lti-enabled')?.checked || false;
      settings.apiEnabled = document.getElementById('api-enabled')?.checked || false;
      settings.googleSync = document.getElementById('google-sync')?.checked || false;
      settings.teamsSync = document.getElementById('teams-sync')?.checked || false;
      settings.zoomIntegration = document.getElementById('zoom-integration')?.checked || false;
      settings.canvasIntegration = document.getElementById('canvas-integration')?.checked || false;
      
      // Security settings
      settings.twoFactorAuth = document.getElementById('2fa-enabled')?.checked || false;
      settings.sessionTimeout = parseInt(document.getElementById('session-timeout')?.value) || 30;
      settings.passwordPolicy = document.getElementById('password-policy')?.value || 'standard';
      settings.dataRetention = parseInt(document.getElementById('data-retention')?.value) || 365;
      settings.gdprEnabled = document.getElementById('gdpr-enabled')?.checked || false;
      settings.dataEncryption = document.getElementById('data-encryption')?.checked !== false;
      settings.auditLogging = document.getElementById('audit-logging')?.checked || false;
      
      // Automation settings
      settings.assignmentReminders = document.getElementById('assignment-reminders')?.checked !== false;
      settings.gradeNotifications = document.getElementById('grade-notifications')?.checked !== false;
      settings.attendanceAlerts = document.getElementById('attendance-alerts')?.checked || false;
      settings.weeklyReports = document.getElementById('weekly-reports')?.checked || false;
      settings.autoGradeQuizzes = document.getElementById('auto-grade-quizzes')?.checked || false;
      settings.autoWelcome = document.getElementById('auto-welcome')?.checked || false;
      settings.autoProgressReports = document.getElementById('auto-progress-reports')?.checked || false;
      settings.autoBackup = document.getElementById('auto-backup')?.checked || false;
      
      // Save both settings and profile
      setData(STORAGE_KEYS.SETTINGS, settings);
      setData(STORAGE_KEYS.TEACHER_PROFILE, teacherProfile);
      
      // Apply accessibility settings immediately
      applyAccessibilitySettings(settings.accessibility);
      
      // Apply color scheme immediately
      if (teacherProfile.colorScheme) {
        applyColorScheme(teacherProfile.colorScheme);
      }
      
      showNotification('Settings saved successfully!', 'success');
    }

    // Apply accessibility settings to the page
    function applyAccessibilitySettings(accessibility) {
      if (!accessibility) return;
      
      // Apply font size
      if (accessibility.fontSize) {
        document.documentElement.setAttribute('data-font-size', accessibility.fontSize);
      }
      
      // Apply font family
      if (accessibility.fontFamily) {
        document.documentElement.setAttribute('data-font-family', accessibility.fontFamily);
      }
      
      // Apply line spacing
      if (accessibility.lineSpacing) {
        document.documentElement.setAttribute('data-line-spacing', accessibility.lineSpacing);
      }
      
      // Apply high contrast
      if (accessibility.highContrast) {
        document.documentElement.setAttribute('data-theme', 'high-contrast');
      }
      
      // Apply focus indicators
      if (accessibility.focusIndicators) {
        document.documentElement.setAttribute('data-focus-indicators', 'true');
      }
      
      // Apply reduce motion
      if (accessibility.reduceMotion) {
        document.documentElement.setAttribute('data-reduce-motion', 'true');
      }
      
      // Apply color blind support
      if (accessibility.colorBlindSupport && accessibility.colorBlindSupport !== 'none') {
        document.documentElement.setAttribute('data-color-scheme', accessibility.colorBlindSupport);
      }
    }

    // Apply saved settings on page load
    function applySavedSettings() {
      const settings = getData(STORAGE_KEYS.SETTINGS) || {};
      const teacherProfile = getData(STORAGE_KEYS.TEACHER_PROFILE) || {};
      
      // Initialize theme (default to light mode)
      initializeTheme();
      
      // Apply accessibility settings
      if (settings.accessibility) {
        applyAccessibilitySettings(settings.accessibility);
      }
      
      // Apply color scheme
      if (teacherProfile.colorScheme) {
        applyColorScheme(teacherProfile.colorScheme);
      }
    }
    function backupData() {
      document.getElementById('backup-modal').style.display = 'flex';
    }
    function downloadBackup() {
      let backup = {
        courses: JSON.parse(localStorage.getItem('courses') || '[]'),
        students: JSON.parse(localStorage.getItem('students') || '[]'),
        assignments: JSON.parse(localStorage.getItem('assignments') || '[]'),
        announcements: JSON.parse(localStorage.getItem('announcements') || '[]'),
        settings: JSON.parse(localStorage.getItem('settings') || '{}'),
        teacherProfile: JSON.parse(localStorage.getItem('teacherProfile') || '{}'),
        timestamp: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `edusync_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      window.URL.revokeObjectURL(url);
      closeModal('backup-modal');
    }
    function restoreData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const backup = JSON.parse(e.target.result);
            if (confirm('This will overwrite all current data. Continue?')) {
              if (backup.courses) localStorage.setItem('courses', JSON.stringify(backup.courses));
              if (backup.students) localStorage.setItem('students', JSON.stringify(backup.students));
              if (backup.assignments) localStorage.setItem('assignments', JSON.stringify(backup.assignments));
              if (backup.announcements) localStorage.setItem('announcements', JSON.stringify(backup.announcements));
              if (backup.settings) localStorage.setItem('settings', JSON.stringify(backup.settings));
              if (backup.teacherProfile) localStorage.setItem('teacherProfile', JSON.stringify(backup.teacherProfile));
              alert('Data restored successfully!');
              location.reload();
            }
          } catch (error) {
            alert('Invalid backup file');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }
    function exportAllData() {
      let data = {
        courses: JSON.parse(localStorage.getItem('courses') || '[]'),
        students: JSON.parse(localStorage.getItem('students') || '[]'),
        assignments: JSON.parse(localStorage.getItem('assignments') || '[]'),
        announcements: JSON.parse(localStorage.getItem('announcements') || '[]'),
        settings: JSON.parse(localStorage.getItem('settings') || '{}'),
        teacherProfile: JSON.parse(localStorage.getItem('teacherProfile') || '{}')
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'edusync_export.json';
      a.click();
      window.URL.revokeObjectURL(url);
    }
    function clearAllData() {
      if (confirm('This will permanently delete all data. This action cannot be undone. Continue?')) {
        if (confirm('Are you absolutely sure? This will delete everything!')) {
          localStorage.clear();
          alert('All data has been cleared. The page will reload.');
          location.reload();
        }
      }
    }
    function initSettingsEvents() {
      window.saveAllSettings = saveAllSettings;
      window.backupData = backupData;
      window.downloadBackup = downloadBackup;
      window.restoreData = restoreData;
      window.exportAllData = exportAllData;
      window.clearAllData = clearAllData;
      window.switchSettingsTab = switchSettingsTab;
      window.resetToDefaults = resetToDefaults;
      window.uploadProfilePicture = uploadProfilePicture;
      window.saveProfileSettings = saveProfileSettings;
      window.previewTheme = previewTheme;
      window.testAccessibility = testAccessibility;
      window.applyColorScheme = applyColorScheme;
    }

    // ===== ENHANCED SETTINGS FUNCTIONS =====

    // Color scheme selection function
    function selectColorScheme(color) {
      // Remove active class from all color options
      document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('active');
      });
      
      // Add active class to selected color
      document.querySelector(`.color-option.${color}`).classList.add('active');
      
      // Update the hidden select element
      document.getElementById('color-scheme').value = color;
      
      // Preview the theme change
      previewTheme();
    }

    // Tab switching for settings
    function switchSettingsTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Render Profile & Personalization Settings
    function renderProfileSettings(teacherProfile) {
      return `
        <style>
          .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
          }
          
          .settings-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
          }
          
          .settings-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
          }
          
          .settings-card h4 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 600;
          }
          
          .settings-card h4 i {
            font-size: 1.2rem;
          }
          
          .profile-picture-section {
            text-align: center;
            margin-bottom: 24px;
          }
          
          .profile-picture-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
          }
          
          .profile-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            border: 4px solid var(--glass-border);
            overflow: hidden;
          }
          
          .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
          }
          
          .color-scheme-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-top: 8px;
          }
          
          .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
          }
          
          .color-option:hover {
            transform: scale(1.1);
          }
          
          .color-option.active {
            border-color: var(--text);
          }
          
          .color-option.blue { background: #4361ee; }
          .color-option.green { background: #4ad66d; }
          .color-option.purple { background: #7209b7; }
          .color-option.orange { background: #f7b801; }
          .color-option.red { background: #f72585; }
          
          .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 8px;
          }
          
          .quick-action-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--medium-gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
          }
          
          .quick-action-item:hover {
            background: var(--light-gray);
          }
          
          .quick-action-item input[type="checkbox"] {
            margin: 0;
          }
          
          .notification-section {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
          }
          
          .notification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
          }
          
          .notification-card {
            background: var(--medium-gray);
            border-radius: 8px;
            padding: 16px;
          }
          
          .notification-card h5 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--text);
            font-size: 0.95rem;
            font-weight: 600;
          }
          
          .notification-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
          }
          
          .notification-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            cursor: pointer;
          }
          
          .notification-option input[type="checkbox"] {
            margin: 0;
          }
          
          .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
          }
          
          @media (max-width: 768px) {
            .settings-grid {
              grid-template-columns: 1fr;
            }
            .form-row {
              grid-template-columns: 1fr;
            }
            .color-scheme-options {
              grid-template-columns: repeat(3, 1fr);
            }
            .quick-actions-grid {
              grid-template-columns: 1fr;
            }
          }
        </style>
        
        <div class="settings-grid">
          <!-- Teacher Profile Card -->
          <div class="settings-card">
            <h4><i class="fas fa-user-circle"></i> Teacher Profile</h4>
            <div class="profile-picture-section">
              <div class="profile-picture-container">
                <div class="profile-picture" id="profile-picture">
                  ${teacherProfile.profilePicture ? 
                    `<img src="${teacherProfile.profilePicture}" alt="Profile Picture">` : 
                    '<i class="fas fa-user"></i>'
                  }
                </div>
                <button class="btn btn-sm btn-secondary" onclick="uploadProfilePicture()">
                  <i class="fas fa-camera"></i> Change Photo
                </button>
              </div>
            </div>
            <div class="form-group">
              <label>Full Name *</label>
              <input type="text" id="teacher-name" class="form-control" value="${teacherProfile.fullName || ''}" required>
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input type="email" id="teacher-email" class="form-control" value="${teacherProfile.email || ''}" required>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="teacher-phone" class="form-control" value="${teacherProfile.phone || ''}">
              </div>
              <div class="form-group">
                <label>Department</label>
                <input type="text" id="teacher-department" class="form-control" value="${teacherProfile.department || ''}">
              </div>
            </div>
            <div class="form-group">
              <label>Bio</label>
              <textarea id="teacher-bio" class="form-control" rows="3" placeholder="Tell students about yourself...">${teacherProfile.bio || ''}</textarea>
            </div>
            <div class="form-group">
              <label>Office Hours</label>
              <textarea id="teacher-office-hours" class="form-control" rows="2" placeholder="e.g., Mon/Wed 2-4 PM, or by appointment">${teacherProfile.officeHours || ''}</textarea>
            </div>
          </div>
          
          <!-- Interface Preferences Card -->
          <div class="settings-card">
            <h4><i class="fas fa-palette"></i> Interface Preferences</h4>
            <div class="form-group">
              <label>Dashboard Layout</label>
              <select id="dashboard-layout" class="form-control">
                <option value="default" ${teacherProfile.dashboardLayout === 'default' ? 'selected' : ''}>Default Layout</option>
                <option value="compact" ${teacherProfile.dashboardLayout === 'compact' ? 'selected' : ''}>Compact Layout</option>
                <option value="detailed" ${teacherProfile.dashboardLayout === 'detailed' ? 'selected' : ''}>Detailed Layout</option>
                <option value="custom" ${teacherProfile.dashboardLayout === 'custom' ? 'selected' : ''}>Custom Layout</option>
              </select>
            </div>
            <div class="form-group">
              <label>Default View</label>
              <select id="default-view" class="form-control">
                <option value="dashboard" ${teacherProfile.defaultView === 'dashboard' ? 'selected' : ''}>Dashboard</option>
                <option value="courses" ${teacherProfile.defaultView === 'courses' ? 'selected' : ''}>Courses</option>
                <option value="students" ${teacherProfile.defaultView === 'students' ? 'selected' : ''}>Students</option>
                <option value="assignments" ${teacherProfile.defaultView === 'assignments' ? 'selected' : ''}>Assignments</option>
              </select>
            </div>
            <div class="form-group">
              <label>Color Scheme</label>
              <div class="color-scheme-options">
                <div class="color-option blue ${teacherProfile.colorScheme === 'blue' ? 'active' : ''}" onclick="selectColorScheme('blue')" title="Blue"></div>
                <div class="color-option green ${teacherProfile.colorScheme === 'green' ? 'active' : ''}" onclick="selectColorScheme('green')" title="Green"></div>
                <div class="color-option purple ${teacherProfile.colorScheme === 'purple' ? 'active' : ''}" onclick="selectColorScheme('purple')" title="Purple"></div>
                <div class="color-option orange ${teacherProfile.colorScheme === 'orange' ? 'active' : ''}" onclick="selectColorScheme('orange')" title="Orange"></div>
                <div class="color-option red ${teacherProfile.colorScheme === 'red' ? 'active' : ''}" onclick="selectColorScheme('red')" title="Red"></div>
              </div>
              <select id="color-scheme" class="form-control" style="display: none;" onchange="previewTheme()">
                <option value="blue" ${teacherProfile.colorScheme === 'blue' ? 'selected' : ''}>Blue (Default)</option>
                <option value="green" ${teacherProfile.colorScheme === 'green' ? 'selected' : ''}>Green</option>
                <option value="purple" ${teacherProfile.colorScheme === 'purple' ? 'selected' : ''}>Purple</option>
                <option value="orange" ${teacherProfile.colorScheme === 'orange' ? 'selected' : ''}>Orange</option>
                <option value="red" ${teacherProfile.colorScheme === 'red' ? 'selected' : ''}>Red</option>
              </select>
            </div>
          </div>
          
          <!-- Quick Actions Card -->
          <div class="settings-card">
            <h4><i class="fas fa-bolt"></i> Quick Actions</h4>
            <p class="text-muted mb-16">Choose which actions to show on your dashboard for quick access</p>
            <div class="quick-actions-grid">
              <div class="quick-action-item">
                <input type="checkbox" id="quick-grading" ${teacherProfile.quickActions?.includes('grading') ? 'checked' : ''}>
                <i class="fas fa-check-circle"></i>
                <span>Grading</span>
              </div>
              <div class="quick-action-item">
                <input type="checkbox" id="quick-announcements" ${teacherProfile.quickActions?.includes('announcements') ? 'checked' : ''}>
                <i class="fas fa-bullhorn"></i>
                <span>Announcements</span>
              </div>
              <div class="quick-action-item">
                <input type="checkbox" id="quick-attendance" ${teacherProfile.quickActions?.includes('attendance') ? 'checked' : ''}>
                <i class="fas fa-clipboard-check"></i>
                <span>Attendance</span>
              </div>
              <div class="quick-action-item">
                <input type="checkbox" id="quick-reports" ${teacherProfile.quickActions?.includes('reports') ? 'checked' : ''}>
                <i class="fas fa-chart-bar"></i>
                <span>Reports</span>
              </div>
              <div class="quick-action-item">
                <input type="checkbox" id="quick-messaging" ${teacherProfile.quickActions?.includes('messaging') ? 'checked' : ''}>
                <i class="fas fa-comments"></i>
                <span>Messaging</span>
              </div>
            </div>
          </div>
          
          <!-- Regional Settings Card -->
          <div class="settings-card">
            <h4><i class="fas fa-globe"></i> Regional Settings</h4>
            <div class="form-group">
              <label>Time Zone</label>
              <select id="timezone" class="form-control">
                <option value="UTC" ${teacherProfile.timezone === 'UTC' ? 'selected' : ''}>UTC</option>
                <option value="EST" ${teacherProfile.timezone === 'EST' ? 'selected' : ''}>Eastern Time</option>
                <option value="CST" ${teacherProfile.timezone === 'CST' ? 'selected' : ''}>Central Time</option>
                <option value="MST" ${teacherProfile.timezone === 'MST' ? 'selected' : ''}>Mountain Time</option>
                <option value="PST" ${teacherProfile.timezone === 'PST' ? 'selected' : ''}>Pacific Time</option>
              </select>
            </div>
            <div class="form-group">
              <label>Date Format</label>
              <select id="date-format" class="form-control">
                <option value="MM/DD/YYYY" ${teacherProfile.dateFormat === 'MM/DD/YYYY' ? 'selected' : ''}>MM/DD/YYYY</option>
                <option value="DD/MM/YYYY" ${teacherProfile.dateFormat === 'DD/MM/YYYY' ? 'selected' : ''}>DD/MM/YYYY</option>
                <option value="YYYY-MM-DD" ${teacherProfile.dateFormat === 'YYYY-MM-DD' ? 'selected' : ''}>YYYY-MM-DD</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Notification Preferences Section -->
        <div class="notification-section">
          <h4><i class="fas fa-bell"></i> Notification Preferences</h4>
          <div class="notification-grid">
            <div class="notification-card">
              <h5><i class="fas fa-envelope"></i> Email Notifications</h5>
              <div class="notification-options">
                <div class="notification-option">
                  <input type="checkbox" id="email-assignments" ${teacherProfile.emailNotifications?.assignments !== false ? 'checked' : ''}>
                  <span>Assignment Submissions</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="email-grades" ${teacherProfile.emailNotifications?.grades !== false ? 'checked' : ''}>
                  <span>Grade Updates</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="email-attendance" ${teacherProfile.emailNotifications?.attendance !== false ? 'checked' : ''}>
                  <span>Attendance Alerts</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="email-messages" ${teacherProfile.emailNotifications?.messages !== false ? 'checked' : ''}>
                  <span>New Messages</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="email-reports" ${teacherProfile.emailNotifications?.reports !== false ? 'checked' : ''}>
                  <span>Weekly Reports</span>
                </div>
              </div>
            </div>
            
            <div class="notification-card">
              <h5><i class="fas fa-mobile-alt"></i> In-App Notifications</h5>
              <div class="notification-options">
                <div class="notification-option">
                  <input type="checkbox" id="app-assignments" ${teacherProfile.appNotifications?.assignments !== false ? 'checked' : ''}>
                  <span>Assignment Submissions</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="app-grades" ${teacherProfile.appNotifications?.grades !== false ? 'checked' : ''}>
                  <span>Grade Updates</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="app-attendance" ${teacherProfile.appNotifications?.attendance !== false ? 'checked' : ''}>
                  <span>Attendance Alerts</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="app-messages" ${teacherProfile.appNotifications?.messages !== false ? 'checked' : ''}>
                  <span>New Messages</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="app-reports" ${teacherProfile.appNotifications?.reports !== false ? 'checked' : ''}>
                  <span>Weekly Reports</span>
                </div>
              </div>
            </div>
            
            <div class="notification-card">
              <h5><i class="fas fa-clock"></i> Notification Timing</h5>
              <div class="notification-options">
                <div class="notification-option">
                  <input type="checkbox" id="notify-immediate" ${teacherProfile.notificationTiming?.immediate !== false ? 'checked' : ''}>
                  <span>Immediate</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="notify-daily" ${teacherProfile.notificationTiming?.daily !== false ? 'checked' : ''}>
                  <span>Daily Digest</span>
                </div>
                <div class="notification-option">
                  <input type="checkbox" id="notify-weekly" ${teacherProfile.notificationTiming?.weekly !== false ? 'checked' : ''}>
                  <span>Weekly Summary</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // Render Account Settings
    function renderAccountSettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Account Information</h4>
            <div class="form-group">
              <label>Email Notifications</label>
              <input type="checkbox" id="email-notifications" ${settings.emailNotifications !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Auto-save</label>
              <input type="checkbox" id="auto-save" ${settings.autoSave !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Theme</label>
              <select id="theme-select" class="form-control" onchange="previewTheme()">
                <option value="auto" ${settings.theme === 'auto' ? 'selected' : ''}>Auto (System)</option>
                <option value="dark" ${settings.theme === 'dark' ? 'selected' : ''}>Dark</option>
                <option value="light" ${settings.theme === 'light' ? 'selected' : ''}>Light</option>
              </select>
            </div>
            <div class="form-group">
              <label>Language</label>
              <select id="language-select" class="form-control">
                <option value="en" ${settings.language === 'en' ? 'selected' : ''}>English</option>
                <option value="es" ${settings.language === 'es' ? 'selected' : ''}>Spanish</option>
                <option value="fr" ${settings.language === 'fr' ? 'selected' : ''}>French</option>
                <option value="de" ${settings.language === 'de' ? 'selected' : ''}>German</option>
                <option value="zh" ${settings.language === 'zh' ? 'selected' : ''}>Chinese</option>
                <option value="ja" ${settings.language === 'ja' ? 'selected' : ''}>Japanese</option>
              </select>
            </div>
          </div>
          
          <div class="card">
            <h4>Account Security</h4>
            <div class="form-group">
              <label>Change Password</label>
              <button class="btn btn-secondary" onclick="changePassword()">Change Password</button>
            </div>
            <div class="form-group">
              <label>Two-Factor Authentication</label>
              <input type="checkbox" id="2fa-enabled" ${settings.twoFactorAuth ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Login History</label>
              <button class="btn btn-secondary" onclick="viewLoginHistory()">View History</button>
            </div>
            <div class="form-group">
              <label>Active Sessions</label>
              <button class="btn btn-secondary" onclick="manageSessions()">Manage Sessions</button>
            </div>
          </div>
        </div>
      `;
    }

    // Render Accessibility & Learning Support Settings
    function renderAccessibilitySettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Visual Accessibility</h4>
            <div class="form-group">
              <label>High Contrast Mode</label>
              <input type="checkbox" id="high-contrast" ${settings.accessibility?.highContrast ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Font Size</label>
              <select id="font-size" class="form-control" onchange="applyFontSize()">
                <option value="small" ${settings.accessibility?.fontSize === 'small' ? 'selected' : ''}>Small</option>
                <option value="medium" ${settings.accessibility?.fontSize === 'medium' || !settings.accessibility?.fontSize ? 'selected' : ''}>Medium (Default)</option>
                <option value="large" ${settings.accessibility?.fontSize === 'large' ? 'selected' : ''}>Large</option>
                <option value="extra-large" ${settings.accessibility?.fontSize === 'extra-large' ? 'selected' : ''}>Extra Large</option>
              </select>
            </div>
            <div class="form-group">
              <label>Font Family</label>
              <select id="font-family" class="form-control" onchange="applyFontFamily()">
                <option value="default" ${settings.accessibility?.fontFamily === 'default' || !settings.accessibility?.fontFamily ? 'selected' : ''}>Default</option>
                <option value="arial" ${settings.accessibility?.fontFamily === 'arial' ? 'selected' : ''}>Arial</option>
                <option value="times" ${settings.accessibility?.fontFamily === 'times' ? 'selected' : ''}>Times New Roman</option>
                <option value="courier" ${settings.accessibility?.fontFamily === 'courier' ? 'selected' : ''}>Courier New</option>
                <option value="dyslexic" ${settings.accessibility?.fontFamily === 'dyslexic' ? 'selected' : ''}>OpenDyslexic</option>
              </select>
            </div>
            <div class="form-group">
              <label>Line Spacing</label>
              <select id="line-spacing" class="form-control" onchange="applyLineSpacing()">
                <option value="normal" ${settings.accessibility?.lineSpacing === 'normal' || !settings.accessibility?.lineSpacing ? 'selected' : ''}>Normal</option>
                <option value="relaxed" ${settings.accessibility?.lineSpacing === 'relaxed' ? 'selected' : ''}>Relaxed</option>
                <option value="double" ${settings.accessibility?.lineSpacing === 'double' ? 'selected' : ''}>Double</option>
              </select>
            </div>
            <div class="form-group">
              <label>Reduce Motion</label>
              <input type="checkbox" id="reduce-motion" ${settings.accessibility?.reduceMotion ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Focus Indicators</label>
              <input type="checkbox" id="focus-indicators" ${settings.accessibility?.focusIndicators !== false ? 'checked' : ''}>
            </div>
          </div>
          
          <div class="card">
            <h4>Learning Support</h4>
            <div class="form-group">
              <label>Screen Reader Support</label>
              <input type="checkbox" id="screen-reader" ${settings.accessibility?.screenReader ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Keyboard Navigation</label>
              <input type="checkbox" id="keyboard-nav" ${settings.accessibility?.keyboardNavigation !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Voice Commands</label>
              <input type="checkbox" id="voice-commands" ${settings.accessibility?.voiceCommands ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Text-to-Speech</label>
              <input type="checkbox" id="text-to-speech" ${settings.accessibility?.textToSpeech ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Reading Guides</label>
              <input type="checkbox" id="reading-guides" ${settings.accessibility?.readingGuides ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Color Blind Support</label>
              <select id="color-blind-support" class="form-control">
                <option value="none" ${settings.accessibility?.colorBlindSupport === 'none' || !settings.accessibility?.colorBlindSupport ? 'selected' : ''}>None</option>
                <option value="protanopia" ${settings.accessibility?.colorBlindSupport === 'protanopia' ? 'selected' : ''}>Protanopia (Red-Blind)</option>
                <option value="deuteranopia" ${settings.accessibility?.colorBlindSupport === 'deuteranopia' ? 'selected' : ''}>Deuteranopia (Green-Blind)</option>
                <option value="tritanopia" ${settings.accessibility?.colorBlindSupport === 'tritanopia' ? 'selected' : ''}>Tritanopia (Blue-Blind)</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h4>Learning Accommodations</h4>
          <div class="grid-3">
            <div>
              <h5>Visual Accommodations</h5>
              <div class="checkbox-group">
                <label><input type="checkbox" id="accommodation-magnifier" ${settings.accommodations?.magnifier ? 'checked' : ''}> Screen Magnifier</label>
                <label><input type="checkbox" id="accommodation-highlight" ${settings.accommodations?.highlight ? 'checked' : ''}> Text Highlighting</label>
                <label><input type="checkbox" id="accommodation-zoom" ${settings.accommodations?.zoom ? 'checked' : ''}> Zoom Controls</label>
                <label><input type="checkbox" id="accommodation-contrast" ${settings.accommodations?.contrast ? 'checked' : ''}> Contrast Adjustments</label>
              </div>
            </div>
            <div>
              <h5>Auditory Accommodations</h5>
              <div class="checkbox-group">
                <label><input type="checkbox" id="accommodation-captions" ${settings.accommodations?.captions ? 'checked' : ''}> Closed Captions</label>
                <label><input type="checkbox" id="accommodation-transcript" ${settings.accommodations?.transcript ? 'checked' : ''}> Audio Transcripts</label>
                <label><input type="checkbox" id="accommodation-volume" ${settings.accommodations?.volume ? 'checked' : ''}> Volume Controls</label>
                <label><input type="checkbox" id="accommodation-speed" ${settings.accommodations?.speed ? 'checked' : ''}> Playback Speed</label>
              </div>
            </div>
            <div>
              <h5>Cognitive Accommodations</h5>
              <div class="checkbox-group">
                <label><input type="checkbox" id="accommodation-timer" ${settings.accommodations?.timer ? 'checked' : ''}> Extended Timers</label>
                <label><input type="checkbox" id="accommodation-breaks" ${settings.accommodations?.breaks ? 'checked' : ''}> Scheduled Breaks</label>
                <label><input type="checkbox" id="accommodation-simplified" ${settings.accommodations?.simplified ? 'checked' : ''}> Simplified Interface</label>
                <label><input type="checkbox" id="accommodation-reminders" ${settings.accommodations?.reminders ? 'checked' : ''}> Task Reminders</label>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card">
          <h4>Accessibility Testing</h4>
          <div class="flex gap-10">
            <button class="btn btn-secondary" onclick="testAccessibility()">
              <i class="fas fa-universal-access"></i> Test Accessibility Features
            </button>
            <button class="btn btn-secondary" onclick="resetAccessibility()">
              <i class="fas fa-undo"></i> Reset to Defaults
            </button>
          </div>
        </div>
      `;
    }

    // Render Course Settings
    function renderCourseSettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Course Defaults</h4>
            <div class="form-group">
              <label>Default Course Duration (weeks)</label>
              <input type="number" id="default-duration" class="form-control" value="${settings.defaultDuration || 12}">
            </div>
            <div class="form-group">
              <label>Grading Scale</label>
              <select id="grading-scale" class="form-control">
                <option value="letter" ${settings.gradingScale === 'letter' ? 'selected' : ''}>Letter Grades (A-F)</option>
                <option value="percentage" ${settings.gradingScale === 'percentage' ? 'selected' : ''}>Percentage (0-100)</option>
                <option value="passfail" ${settings.gradingScale === 'passfail' ? 'selected' : ''}>Pass/Fail</option>
              </select>
            </div>
            <div class="form-group">
              <label>Allow Late Submissions</label>
              <input type="checkbox" id="allow-late" ${settings.allowLate !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Late Penalty (%)</label>
              <input type="number" id="late-penalty" class="form-control" value="${settings.latePenalty || 10}" min="0" max="100">
            </div>
          </div>
          
          <div class="card">
            <h4>Course Features</h4>
            <div class="form-group">
              <label>Discussion Forums</label>
              <input type="checkbox" id="enable-discussions" ${settings.courseFeatures?.discussions !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Peer Reviews</label>
              <input type="checkbox" id="enable-peer-reviews" ${settings.courseFeatures?.peerReviews ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Group Assignments</label>
              <input type="checkbox" id="enable-group-assignments" ${settings.courseFeatures?.groupAssignments ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Attendance Tracking</label>
              <input type="checkbox" id="enable-attendance" ${settings.courseFeatures?.attendance !== false ? 'checked' : ''}>
            </div>
          </div>
        </div>
      `;
    }

    // Render Integration Settings
    function renderIntegrationSettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Authentication</h4>
            <div class="form-group">
              <label>Single Sign-On (SSO)</label>
              <select id="sso-provider" class="form-control">
                <option value="none" ${settings.ssoProvider === 'none' ? 'selected' : ''}>None</option>
                <option value="google" ${settings.ssoProvider === 'google' ? 'selected' : ''}>Google</option>
                <option value="microsoft" ${settings.ssoProvider === 'microsoft' ? 'selected' : ''}>Microsoft</option>
                <option value="saml" ${settings.ssoProvider === 'saml' ? 'selected' : ''}>SAML</option>
              </select>
            </div>
            <div class="form-group">
              <label>LTI Integration</label>
              <input type="checkbox" id="lti-enabled" ${settings.ltiEnabled ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>API Access</label>
              <input type="checkbox" id="api-enabled" ${settings.apiEnabled ? 'checked' : ''}>
            </div>
          </div>
          
          <div class="card">
            <h4>External Services</h4>
            <div class="form-group">
              <label>Google Classroom Sync</label>
              <input type="checkbox" id="google-sync" ${settings.googleSync ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Microsoft Teams</label>
              <input type="checkbox" id="teams-sync" ${settings.teamsSync ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Zoom Integration</label>
              <input type="checkbox" id="zoom-integration" ${settings.zoomIntegration ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Canvas LMS</label>
              <input type="checkbox" id="canvas-integration" ${settings.canvasIntegration ? 'checked' : ''}>
            </div>
          </div>
        </div>
      `;
    }

    // Render Security Settings
    function renderSecuritySettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Security</h4>
            <div class="form-group">
              <label>Two-Factor Authentication</label>
              <input type="checkbox" id="2fa-enabled" ${settings.twoFactorAuth ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Session Timeout (minutes)</label>
              <input type="number" id="session-timeout" class="form-control" value="${settings.sessionTimeout || 30}">
            </div>
            <div class="form-group">
              <label>Password Policy</label>
              <select id="password-policy" class="form-control">
                <option value="standard" ${settings.passwordPolicy === 'standard' ? 'selected' : ''}>Standard</option>
                <option value="strong" ${settings.passwordPolicy === 'strong' ? 'selected' : ''}>Strong</option>
                <option value="very-strong" ${settings.passwordPolicy === 'very-strong' ? 'selected' : ''}>Very Strong</option>
              </select>
            </div>
          </div>
          
          <div class="card">
            <h4>Privacy</h4>
            <div class="form-group">
              <label>Data Retention (days)</label>
              <input type="number" id="data-retention" class="form-control" value="${settings.dataRetention || 365}">
            </div>
            <div class="form-group">
              <label>GDPR Compliance</label>
              <input type="checkbox" id="gdpr-enabled" ${settings.gdprEnabled ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Data Encryption</label>
              <input type="checkbox" id="data-encryption" ${settings.dataEncryption !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Audit Logging</label>
              <input type="checkbox" id="audit-logging" ${settings.auditLogging ? 'checked' : ''}>
            </div>
          </div>
        </div>
      `;
    }

    // Render Automation Settings
    function renderAutomationSettings(settings) {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Notifications</h4>
            <div class="form-group">
              <label>Assignment Reminders</label>
              <input type="checkbox" id="assignment-reminders" ${settings.assignmentReminders !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Grade Notifications</label>
              <input type="checkbox" id="grade-notifications" ${settings.gradeNotifications !== false ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Attendance Alerts</label>
              <input type="checkbox" id="attendance-alerts" ${settings.attendanceAlerts ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Weekly Reports</label>
              <input type="checkbox" id="weekly-reports" ${settings.weeklyReports ? 'checked' : ''}>
            </div>
          </div>
          
          <div class="card">
            <h4>Automation</h4>
            <div class="form-group">
              <label>Auto-grade Simple Quizzes</label>
              <input type="checkbox" id="auto-grade-quizzes" ${settings.autoGradeQuizzes ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Auto-send Welcome Messages</label>
              <input type="checkbox" id="auto-welcome" ${settings.autoWelcome ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Auto-generate Progress Reports</label>
              <input type="checkbox" id="auto-progress-reports" ${settings.autoProgressReports ? 'checked' : ''}>
            </div>
            <div class="form-group">
              <label>Auto-backup Data</label>
              <input type="checkbox" id="auto-backup" ${settings.autoBackup ? 'checked' : ''}>
            </div>
          </div>
        </div>
      `;
    }

    // Render Data Management Settings
    function renderDataManagementSettings() {
      return `
        <div class="grid-2 mb-20">
          <div class="card">
            <h4>Data Operations</h4>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="backupData()">
                <i class="fas fa-download"></i> Backup Data
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="restoreData()">
                <i class="fas fa-upload"></i> Restore Data
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="exportAllData()">
                <i class="fas fa-file-export"></i> Export All Data
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="importData()">
                <i class="fas fa-file-import"></i> Import Data
              </button>
            </div>
          </div>
          
          <div class="card">
            <h4>Data Maintenance</h4>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="cleanupData()">
                <i class="fas fa-broom"></i> Cleanup Old Data
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="optimizeStorage()">
                <i class="fas fa-compress"></i> Optimize Storage
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-secondary" onclick="viewStorageInfo()">
                <i class="fas fa-info-circle"></i> Storage Information
              </button>
            </div>
            <div class="form-group">
              <button class="btn btn-danger" onclick="clearAllData()">
                <i class="fas fa-trash"></i> Clear All Data
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Utility functions for settings
    function resetToDefaults() {
      if (confirm('Are you sure you want to reset all settings to defaults? This cannot be undone.')) {
        localStorage.removeItem('settings');
        localStorage.removeItem('teacherProfile');
        showNotification('Settings reset to defaults successfully!', 'success');
        setTimeout(() => {
          location.reload();
        }, 1000);
      }
    }

    function uploadProfilePicture() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const profilePicture = document.getElementById('profile-picture');
          profilePicture.innerHTML = `<img src="${e.target.result}" alt="Profile Picture">`;
          
          // Save to localStorage
          let teacherProfile = JSON.parse(localStorage.getItem('teacherProfile') || '{}');
          teacherProfile.profilePicture = e.target.result;
          setData(STORAGE_KEYS.TEACHER_PROFILE, teacherProfile);
          
          showNotification('Profile picture updated successfully!', 'success');
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }

    function previewTheme() {
      const theme = document.getElementById('theme-select')?.value || 'auto';
      const colorScheme = document.getElementById('color-scheme')?.value || 'blue';
      
      // Apply theme preview
      document.documentElement.setAttribute('data-theme', theme);
      applyColorScheme(colorScheme);
      
      showNotification('Theme preview applied! Save settings to make permanent.', 'info');
    }

    // Apply color scheme to the interface
    function applyColorScheme(colorScheme) {
      const root = document.documentElement;
      
      // Remove existing color scheme classes
      root.classList.remove('color-scheme-blue', 'color-scheme-green', 'color-scheme-purple', 'color-scheme-orange', 'color-scheme-red');
      
      // Add new color scheme class
      root.classList.add(`color-scheme-${colorScheme}`);
      
      // Set CSS custom properties for the color scheme
      switch(colorScheme) {
        case 'green':
          root.style.setProperty('--primary', '#10b981');
          root.style.setProperty('--primary-light', '#34d399');
          root.style.setProperty('--secondary', '#059669');
          root.style.setProperty('--accent', '#6ee7b7');
          break;
        case 'purple':
          root.style.setProperty('--primary', '#8b5cf6');
          root.style.setProperty('--primary-light', '#a78bfa');
          root.style.setProperty('--secondary', '#7c3aed');
          root.style.setProperty('--accent', '#c4b5fd');
          break;
        case 'orange':
          root.style.setProperty('--primary', '#f59e0b');
          root.style.setProperty('--primary-light', '#fbbf24');
          root.style.setProperty('--secondary', '#d97706');
          root.style.setProperty('--accent', '#fcd34d');
          break;
        case 'red':
          root.style.setProperty('--primary', '#ef4444');
          root.style.setProperty('--primary-light', '#f87171');
          root.style.setProperty('--secondary', '#dc2626');
          root.style.setProperty('--accent', '#fca5a5');
          break;
        default: // blue (default)
          root.style.setProperty('--primary', '#4361ee');
          root.style.setProperty('--primary-light', '#4895ef');
          root.style.setProperty('--secondary', '#3f37c9');
          root.style.setProperty('--accent', '#4cc9f0');
          break;
      }
    }

    function applyFontSize() {
      const fontSize = document.getElementById('font-size')?.value || 'medium';
      document.documentElement.setAttribute('data-font-size', fontSize);
      showNotification('Font size applied!', 'success');
    }

    function applyFontFamily() {
      const fontFamily = document.getElementById('font-family')?.value || 'default';
      document.documentElement.setAttribute('data-font-family', fontFamily);
      showNotification('Font family applied!', 'success');
    }

    function applyLineSpacing() {
      const lineSpacing = document.getElementById('line-spacing')?.value || 'normal';
      document.documentElement.setAttribute('data-line-spacing', lineSpacing);
      showNotification('Line spacing applied!', 'success');
    }

    function testAccessibility() {
      showNotification('Testing accessibility features...', 'info');
      
      // Simulate accessibility test
      setTimeout(() => {
        const results = {
          highContrast: document.getElementById('high-contrast')?.checked || false,
          screenReader: document.getElementById('screen-reader')?.checked || false,
          keyboardNav: document.getElementById('keyboard-nav')?.checked || false,
          focusIndicators: document.getElementById('focus-indicators')?.checked || false
        };
        
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.display = 'flex';
        modal.innerHTML = `
          <div class="modal-content">
            <button class="modal-close" onclick="this.parentElement.parentElement.remove()"><i class="fas fa-times"></i></button>
            <h2>Accessibility Test Results</h2>
            <div class="accessibility-results">
              <div class="result-item ${results.highContrast ? 'pass' : 'fail'}">
                <i class="fas fa-${results.highContrast ? 'check' : 'times'}"></i>
                <span>High Contrast Mode: ${results.highContrast ? 'Enabled' : 'Disabled'}</span>
              </div>
              <div class="result-item ${results.screenReader ? 'pass' : 'fail'}">
                <i class="fas fa-${results.screenReader ? 'check' : 'times'}"></i>
                <span>Screen Reader Support: ${results.screenReader ? 'Enabled' : 'Disabled'}</span>
              </div>
              <div class="result-item ${results.keyboardNav ? 'pass' : 'fail'}">
                <i class="fas fa-${results.keyboardNav ? 'check' : 'times'}"></i>
                <span>Keyboard Navigation: ${results.keyboardNav ? 'Enabled' : 'Disabled'}</span>
              </div>
              <div class="result-item ${results.focusIndicators ? 'pass' : 'fail'}">
                <i class="fas fa-${results.focusIndicators ? 'check' : 'times'}"></i>
                <span>Focus Indicators: ${results.focusIndicators ? 'Enabled' : 'Disabled'}</span>
              </div>
            </div>
            <button class="btn" onclick="this.parentElement.parentElement.remove()">Close</button>
          </div>
        `;
        document.body.appendChild(modal);
      }, 1000);
    }

    function resetAccessibility() {
      if (confirm('Reset all accessibility settings to defaults?')) {
        // Reset accessibility checkboxes
        const checkboxes = ['high-contrast', 'screen-reader', 'keyboard-nav', 'text-to-speech', 'reading-guides'];
        checkboxes.forEach(id => {
          const checkbox = document.getElementById(id);
          if (checkbox) checkbox.checked = false;
        });
        
        // Reset selects
        const selects = ['font-size', 'font-family', 'line-spacing', 'color-blind-support'];
        selects.forEach(id => {
          const select = document.getElementById(id);
          if (select) select.selectedIndex = 0;
        });
        
        showNotification('Accessibility settings reset to defaults!', 'success');
      }
    }

    // Placeholder functions for additional features
    function changePassword() {
      showNotification('Password change functionality would be implemented here', 'info');
    }

    function viewLoginHistory() {
      showNotification('Login history would be displayed here', 'info');
    }

    function manageSessions() {
      showNotification('Session management would be implemented here', 'info');
    }

    function importData() {
      showNotification('Data import functionality would be implemented here', 'info');
    }

    function cleanupData() {
      showNotification('Data cleanup would be performed here', 'info');
    }

    function optimizeStorage() {
      showNotification('Storage optimization would be performed here', 'info');
    }

    function viewStorageInfo() {
      const info = getStorageInfo();
      if (!info) {
        showNotification('Failed to get storage information', 'error');
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3><i class="fas fa-info-circle"></i> Storage Information</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="storage-overview">
              <div class="storage-stat">
                <div class="stat-label">Total Used</div>
                <div class="stat-value">${info.totalSizeFormatted}</div>
              </div>
              <div class="storage-stat">
                <div class="stat-label">Available</div>
                <div class="stat-value">${info.availableFormatted}</div>
              </div>
            </div>
            
            <div class="storage-details">
              <h4>Storage Breakdown</h4>
              <div class="storage-items">
                ${Object.entries(info.items).map(([key, item]) => `
                  <div class="storage-item ${item.exists ? 'exists' : 'missing'}">
                    <div class="item-name">${key}</div>
                    <div class="item-size">${item.sizeFormatted}</div>
                    <div class="item-status">${item.exists ? '✓' : '✗'}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
        
        <style>
          .storage-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
          }
          .storage-stat {
            text-align: center;
            padding: 20px;
            background: var(--glass);
            border-radius: 8px;
          }
          .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 8px;
          }
          .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
          }
          .storage-details h4 {
            margin-bottom: 15px;
          }
          .storage-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
          }
          .storage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--glass);
            border-radius: 6px;
            border-left: 4px solid var(--success);
          }
          .storage-item.missing {
            border-left-color: var(--warning);
            opacity: 0.6;
          }
          .item-name {
            font-weight: 500;
            text-transform: capitalize;
          }
          .item-size {
            font-size: 0.9rem;
            color: var(--text-light);
          }
          .item-status {
            font-weight: 700;
            color: var(--success);
          }
          .storage-item.missing .item-status {
            color: var(--warning);
          }
        </style>
      `;
      
      document.body.appendChild(modal);
      modal.style.display = 'flex';
    }

    // ===== ENHANCED ASSESSMENT FUNCTIONS =====
    
    // Initialize sample quizzes
    function initializeSampleQuizzes() {
      const sampleQuizzes = [
        {
          id: 1,
          title: 'Mathematics Fundamentals Quiz',
          courseId: 1,
          courseName: 'Advanced Mathematics',
          type: 'multiple-choice',
          timeLimit: 30,
          totalPoints: 50,
          questions: [
            {
              id: 1,
              question: 'What is the derivative of x²?',
              type: 'multiple-choice',
              options: ['x', '2x', 'x²', '2x²'],
              correctAnswer: 1,
              points: 10
            },
            {
              id: 2,
              question: 'Solve for x: 2x + 5 = 13',
              type: 'fill-blank',
              correctAnswer: '4',
              points: 10
            },
            {
              id: 3,
              question: 'What is the value of π (pi)?',
              type: 'multiple-choice',
              options: ['3.14', '3.14159', '3.14159265359', '22/7'],
              correctAnswer: 2,
              points: 10
            },
            {
              id: 4,
              question: 'Calculate: 15 × 7',
              type: 'fill-blank',
              correctAnswer: '105',
              points: 10
            },
            {
              id: 5,
              question: 'Which of the following is a prime number?',
              type: 'multiple-choice',
              options: ['15', '17', '21', '25'],
              correctAnswer: 1,
              points: 10
            }
          ],
          dueDate: '2024-02-15T23:59:00',
          status: 'active',
          submissions: [
            { studentId: 1, studentName: 'Sarah Johnson', score: 45, submittedAt: '2024-02-14T10:30:00', timeTaken: 25 },
            { studentId: 2, studentName: 'Michael Chen', score: 50, submittedAt: '2024-02-14T14:15:00', timeTaken: 28 },
            { studentId: 3, studentName: 'Emily Rodriguez', score: 40, submittedAt: '2024-02-14T16:45:00', timeTaken: 30 }
          ]
        },
        {
          id: 2,
          title: 'Computer Science Basics',
          courseId: 2,
          courseName: 'Introduction to Computer Science',
          type: 'mixed',
          timeLimit: 45,
          totalPoints: 75,
          questions: [
            {
              id: 1,
              question: 'What does HTML stand for?',
              type: 'multiple-choice',
              options: ['Hyper Text Markup Language', 'High Tech Modern Language', 'Home Tool Markup Language', 'Hyperlink and Text Markup Language'],
              correctAnswer: 0,
              points: 15
            },
            {
              id: 2,
              question: 'Write a simple HTML tag for a paragraph:',
              type: 'fill-blank',
              correctAnswer: '<p>',
              points: 15
            },
            {
              id: 3,
              question: 'Which programming language is known as the "language of the web"?',
              type: 'multiple-choice',
              options: ['Python', 'Java', 'JavaScript', 'C++'],
              correctAnswer: 2,
              points: 15
            },
            {
              id: 4,
              question: 'What is the purpose of CSS?',
              type: 'multiple-choice',
              options: ['To create databases', 'To style web pages', 'To write server code', 'To create animations'],
              correctAnswer: 1,
              points: 15
            },
            {
              id: 5,
              question: 'Define what an algorithm is:',
              type: 'fill-blank',
              correctAnswer: 'step-by-step procedure',
              points: 15
            }
          ],
          dueDate: '2024-02-20T23:59:00',
          status: 'active',
          submissions: [
            { studentId: 4, studentName: 'David Kim', score: 70, submittedAt: '2024-02-19T09:20:00', timeTaken: 40 },
            { studentId: 5, studentName: 'Lisa Thompson', score: 75, submittedAt: '2024-02-19T11:30:00', timeTaken: 42 },
            { studentId: 6, studentName: 'Robert Zhang', score: 65, submittedAt: '2024-02-19T15:45:00', timeTaken: 45 }
          ]
        }
      ];
      
      setData(STORAGE_KEYS.QUIZZES, sampleQuizzes);
    }

    // Initialize sample gradebook data
    function initializeSampleGradebook() {
      const gradebookData = {
        courses: [
          {
            id: 1,
            name: 'Advanced Mathematics',
            weightages: {
              assignments: 40,
              quizzes: 30,
              exams: 20,
              participation: 10
            },
            students: [
              { id: 1, name: 'Sarah Johnson', assignments: [85, 92, 88], quizzes: [90, 85], exams: [87], participation: 95 },
              { id: 2, name: 'Michael Chen', assignments: [92, 95, 90], quizzes: [95, 90], exams: [92], participation: 88 },
              { id: 3, name: 'Emily Rodriguez', assignments: [78, 85, 82], quizzes: [80, 75], exams: [78], participation: 92 }
            ]
          },
          {
            id: 2,
            name: 'Introduction to Computer Science',
            weightages: {
              assignments: 35,
              quizzes: 25,
              projects: 30,
              participation: 10
            },
            students: [
              { id: 4, name: 'David Kim', assignments: [88, 85, 90], quizzes: [85, 80], projects: [92], participation: 85 },
              { id: 5, name: 'Lisa Thompson', assignments: [92, 88, 95], quizzes: [90, 85], projects: [88], participation: 90 },
              { id: 6, name: 'Robert Zhang', assignments: [82, 85, 80], quizzes: [75, 80], projects: [85], participation: 88 }
            ]
          }
        ]
      };
      
      setData(STORAGE_KEYS.GRADEBOOK, gradebookData);
    }

    // Assessment utility functions
    function getTotalAssessments() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      return assignments.length;
    }

    // Exams utility functions
    function getTotalExams() {
      const exams = JSON.parse(localStorage.getItem('exams') || '[]');
      return exams.length;
    }

    function getActiveExams() {
      const exams = JSON.parse(localStorage.getItem('exams') || '[]');
      const now = new Date();
      return exams.filter(exam => {
        // Consider an exam active if it has no expiry or expiry is in the future
        return !exam.expiryDate || new Date(exam.expiryDate) > now;
      }).length;
    }

    function getAverageExamScore() {
      const exams = JSON.parse(localStorage.getItem('exams') || '[]');
      if (exams.length === 0) return 0;
      
      let totalScore = 0;
      let totalSubmissions = 0;
      
      exams.forEach(exam => {
        if (exam.submissions) {
          exam.submissions.forEach(submission => {
            if (submission.score !== undefined) {
              totalScore += submission.score;
              totalSubmissions++;
            }
          });
        }
      });
      
      return totalSubmissions > 0 ? Math.round(totalScore / totalSubmissions) : 0;
    }

    function renderRecentExams() {
      const exams = JSON.parse(localStorage.getItem('exams') || '[]');
      if (exams.length === 0) {
        return '<p class="text-muted text-center">No exams created yet.</p>';
      }
      
      const recentExams = exams.slice(-3).reverse();
      return recentExams.map(exam => `
        <div class="assessment-item">
          <div class="assessment-header">
            <div>
              <div class="assessment-title">${exam.title}</div>
              <div class="assessment-meta">
                <span>${exam.questions.length} questions</span>
                <span>${exam.timeLimit} min</span>
                <span>${exam.submissions ? exam.submissions.length : 0} submissions</span>
              </div>
            </div>
            <div class="assessment-actions">
              <button class="btn btn-secondary" onclick="openExamsModule()">View</button>
              <button class="btn btn-secondary" onclick="editExamInModule(${exams.indexOf(exam)})">Edit</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function getPendingGrading() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const quizzes = JSON.parse(localStorage.getItem('quizzes') || '[]');
      
      let pending = 0;
      assignments.forEach(assignment => {
        if (assignment.submissions && assignment.submissions.length > 0) {
          pending += assignment.submissions.filter(sub => !sub.graded).length;
        }
      });
      
      quizzes.forEach(quiz => {
        if (quiz.submissions && quiz.submissions.length > 0) {
          pending += quiz.submissions.filter(sub => !sub.graded).length;
        }
      });
      
      return pending;
    }

    // Tab switching function
    function switchAssessmentTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      // Remove active class from all tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(`${tabName}-tab`).classList.add('active');
      
      // Add active class to clicked button
      event.target.classList.add('active');
    }

    // Render assignment tab
    function renderAssignmentsTab() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Assignment Management</h4>
          <button class="btn" onclick="createAssignment()">+ Create Assignment</button>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Search:</label>
            <input type="text" id="assignment-search" class="form-control" placeholder="Search assignments...">
          </div>
          <div>
            <label>Filter by Course:</label>
            <select id="assignment-course-filter" class="form-control">
              <option value="">All Courses</option>
              ${JSON.parse(localStorage.getItem('courses') || '[]').map(course => 
                `<option value="${course.id}">${course.title}</option>`
              ).join('')}
            </select>
          </div>
        </div>
        
        <div id="assignments-list">
          ${assignments.map(assignment => `
            <div class="assessment-item">
              <div class="assessment-header">
                <div>
                  <div class="assessment-title">${assignment.title}</div>
                  <div class="assessment-meta">
                    <span>${assignment.courseName}</span>
                    <span>Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                    <span>${assignment.submissions ? assignment.submissions.length : 0} submissions</span>
                  </div>
                </div>
                <div class="assessment-actions">
                  <button class="btn btn-secondary" onclick="viewAssignmentDetails(${assignment.id})">View</button>
                  <button class="btn btn-secondary" onclick="editAssignment(${assignment.id})">Edit</button>
                  <button class="btn btn-secondary" onclick="viewSubmissions(${assignment.id})">Grade</button>
                  <button class="btn btn-danger" onclick="deleteAssignment(${assignment.id})">Delete</button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Render gradebook tab
    function renderGradebookTab() {
      const gradebook = JSON.parse(localStorage.getItem('gradebook') || '{}');
      const courses = gradebook.courses || [];
      
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Gradebook</h4>
          <div class="flex gap-10">
            <button class="btn btn-secondary" onclick="exportGradebook()">Export Excel</button>
            <button class="btn btn-secondary" onclick="exportGradebookPDF()">Export PDF</button>
            <button class="btn" onclick="openGradebookSettings()">Settings</button>
          </div>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Select Course:</label>
            <select id="gradebook-course-select" class="form-control" onchange="loadGradebookData()">
              <option value="">Select a course</option>
              ${courses.map(course => `<option value="${course.id}">${course.name}</option>`).join('')}
            </select>
          </div>
          <div>
            <label>View Mode:</label>
            <select id="gradebook-view-mode" class="form-control" onchange="loadGradebookData()">
              <option value="detailed">Detailed View</option>
              <option value="summary">Summary View</option>
            </select>
          </div>
        </div>
        
        <div id="gradebook-content">
          <p class="text-muted text-center">Select a course to view the gradebook</p>
        </div>
      `;
    }

    // Render grading tab
    function renderGradingTab() {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const pendingAssignments = assignments.filter(a => 
        a.submissions && a.submissions.some(sub => !sub.graded)
      );
      
      return `
        <div class="flex flex-between flex-center mb-20">
          <h4>Manual Grading & Feedback</h4>
          <button class="btn btn-secondary" onclick="bulkGrade()">Bulk Grade</button>
        </div>
        
        <div class="grid-2 mb-20">
          <div>
            <label>Filter by Status:</label>
            <select id="grading-status-filter" class="form-control" onchange="filterGradingItems()">
              <option value="pending">Pending Grading</option>
              <option value="graded">Graded</option>
              <option value="all">All</option>
            </select>
          </div>
          <div>
            <label>Sort by:</label>
            <select id="grading-sort" class="form-control" onchange="filterGradingItems()">
              <option value="due-date">Due Date</option>
              <option value="submission-date">Submission Date</option>
              <option value="student-name">Student Name</option>
            </select>
          </div>
        </div>
        
        <div id="grading-list">
          ${pendingAssignments.map(assignment => `
            <div class="assessment-item">
              <div class="assessment-header">
                <div>
                  <div class="assessment-title">${assignment.title}</div>
                  <div class="assessment-meta">
                    <span>${assignment.courseName}</span>
                    <span>${assignment.submissions.filter(sub => !sub.graded).length} pending</span>
                    <span>Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                  </div>
                </div>
                <div class="assessment-actions">
                  <button class="btn" onclick="gradeAssignment(${assignment.id})">Grade Now</button>
                  <button class="btn btn-secondary" onclick="viewSubmissions(${assignment.id})">View All</button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Gradebook functions
    function loadGradebookData() {
      const courseId = document.getElementById('gradebook-course-select').value;
      const viewMode = document.getElementById('gradebook-view-mode').value;
      const gradebook = JSON.parse(localStorage.getItem('gradebook') || '{}');
      const course = gradebook.courses?.find(c => c.id == courseId);
      
      if (!course) {
        document.getElementById('gradebook-content').innerHTML = '<p class="text-muted text-center">Select a course to view the gradebook</p>';
        return;
      }
      
      if (viewMode === 'summary') {
        renderGradebookSummary(course);
      } else {
        renderGradebookDetailed(course);
      }
    }

    function renderGradebookSummary(course) {
      const content = `
        <div class="card">
          <h4>${course.name} - Grade Summary</h4>
          <table class="gradebook-table">
            <thead>
              <tr>
                <th>Student</th>
                <th>Assignments</th>
                <th>Quizzes</th>
                <th>Exams</th>
                <th>Participation</th>
                <th>Final Grade</th>
              </tr>
            </thead>
            <tbody>
              ${course.students.map(student => {
                const assignmentAvg = student.assignments.reduce((a, b) => a + b, 0) / student.assignments.length;
                const quizAvg = student.quizzes.reduce((a, b) => a + b, 0) / student.quizzes.length;
                const examAvg = student.exams.reduce((a, b) => a + b, 0) / student.exams.length;
                const finalGrade = Math.round(
                  (assignmentAvg * course.weightages.assignments / 100) +
                  (quizAvg * course.weightages.quizzes / 100) +
                  (examAvg * course.weightages.exams / 100) +
                  (student.participation * course.weightages.participation / 100)
                );
                
                return `
                  <tr>
                    <td>${student.name}</td>
                    <td>${assignmentAvg.toFixed(1)}%</td>
                    <td>${quizAvg.toFixed(1)}%</td>
                    <td>${examAvg.toFixed(1)}%</td>
                    <td>${student.participation}%</td>
                    <td><strong>${finalGrade}%</strong></td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
      
      document.getElementById('gradebook-content').innerHTML = content;
    }

    function renderGradebookDetailed(course) {
      const content = `
        <div class="card">
          <h4>${course.name} - Detailed Gradebook</h4>
          <div class="flex flex-between flex-center mb-16">
            <div>
              <strong>Weightages:</strong> Assignments: ${course.weightages.assignments}% | 
              Exams: ${course.weightages.exams}% | 
              Participation: ${course.weightages.participation}%
            </div>
            <button class="btn btn-secondary" onclick="editWeightages(${course.id})">Edit Weightages</button>
          </div>
          
          <div style="overflow-x: auto;">
            <table class="gradebook-table">
              <thead>
                <tr>
                  <th>Student</th>
                  <th colspan="${course.students[0].assignments.length}">Assignments</th>
                  <th colspan="${course.students[0].exams.length}">Exams</th>
                  <th>Participation</th>
                  <th>Final Grade</th>
                </tr>
                <tr>
                  <th></th>
                  ${course.students[0].assignments.map((_, i) => `<th>A${i+1}</th>`).join('')}
                  ${course.students[0].exams.map((_, i) => `<th>E${i+1}</th>`).join('')}
                  <th>Part.</th>
                  <th>Final</th>
                </tr>
              </thead>
              <tbody>
                ${course.students.map(student => {
                  const assignmentAvg = student.assignments.reduce((a, b) => a + b, 0) / student.assignments.length;
                  const examAvg = student.exams.reduce((a, b) => a + b, 0) / student.exams.length;
                  const finalGrade = Math.round(
                    (assignmentAvg * course.weightages.assignments / 100) +
                    (examAvg * course.weightages.exams / 100) +
                    (student.participation * course.weightages.participation / 100)
                  );
                  
                  return `
                    <tr>
                      <td>${student.name}</td>
                      ${student.assignments.map(grade => `<td><input type="number" class="grade-input" value="${grade}" min="0" max="100"></td>`).join('')}
                      ${student.exams.map(grade => `<td><input type="number" class="grade-input" value="${grade}" min="0" max="100"></td>`).join('')}
                      <td><input type="number" class="grade-input" value="${student.participation}" min="0" max="100"></td>
                      <td><strong>${finalGrade}%</strong></td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      document.getElementById('gradebook-content').innerHTML = content;
    }

    // Export functions
    function exportGradebook() {
      const courseId = document.getElementById('gradebook-course-select').value;
      if (!courseId) {
        alert('Please select a course first');
        return;
      }
      
      const gradebook = JSON.parse(localStorage.getItem('gradebook') || '{}');
      const course = gradebook.courses?.find(c => c.id == courseId);
      
      if (!course) return;
      
      // Create CSV content
      let csv = 'Student,Assignments,Exams,Participation,Final Grade\n';
      
      course.students.forEach(student => {
        const assignmentAvg = student.assignments.reduce((a, b) => a + b, 0) / student.assignments.length;
        const examAvg = student.exams.reduce((a, b) => a + b, 0) / student.exams.length;
        const finalGrade = Math.round(
          (assignmentAvg * course.weightages.assignments / 100) +
          (examAvg * course.weightages.exams / 100) +
          (student.participation * course.weightages.participation / 100)
        );
        
        csv += `${student.name},${assignmentAvg.toFixed(1)}%,${examAvg.toFixed(1)}%,${student.participation}%,${finalGrade}%\n`;
      });
      
      // Download CSV
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${course.name}_gradebook.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function exportGradebookPDF() {
      alert('PDF export functionality would be implemented here with a PDF library like jsPDF');
    }

    // Enhanced grading with feedback
    function gradeAssignment(assignmentId) {
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignment = assignments.find(a => a.id == assignmentId);
      
      if (!assignment || !assignment.submissions) {
        alert('No submissions found for this assignment');
        return;
      }
      
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh;">
          <button class="modal-close" onclick="closeModal('grading-modal')"><i class="fas fa-times"></i></button>
          <h2>Grade Assignment: ${assignment.title}</h2>
          
          <div id="grading-submissions">
            ${assignment.submissions.map(submission => `
              <div class="submission-item">
                <div class="submission-header">
                  <div class="submission-student">${submission.studentName}</div>
                  <div class="submission-time">Submitted: ${new Date(submission.submittedAt).toLocaleString()}</div>
                </div>
                
                <div class="submission-content">
                  <p><strong>Submission:</strong></p>
                  <p>${submission.content || 'File submitted: ' + (submission.fileName || 'assignment.pdf')}</p>
                </div>
                
                <div class="grid-2">
                  <div>
                    <label>Grade (0-100):</label>
                    <input type="number" class="grade-input" value="${submission.grade || ''}" min="0" max="100" 
                           onchange="updateSubmissionGrade(${assignmentId}, ${submission.studentId}, this.value)">
                  </div>
                  <div>
                    <label>Feedback:</label>
                    <textarea class="feedback-input" placeholder="Enter feedback for this student..."
                              onchange="updateSubmissionFeedback(${assignmentId}, ${submission.studentId}, this.value)">${submission.feedback || ''}</textarea>
                  </div>
                </div>
                
                <div class="audio-feedback">
                  <button onclick="recordAudioFeedback(${assignmentId}, ${submission.studentId})">
                    <i class="fas fa-microphone"></i>
                  </button>
                  <span>Record audio feedback</span>
                </div>
                
                <div class="submission-actions">
                  <button class="btn btn-secondary" onclick="downloadSubmission(${assignmentId}, ${submission.studentId})">
                    <i class="fas fa-download"></i> Download
                  </button>
                  <button class="btn btn-secondary" onclick="addAnnotation(${assignmentId}, ${submission.studentId})">
                    <i class="fas fa-comment"></i> Add Annotation
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
          
          <div class="flex gap-10 mt-20">
            <button class="btn" onclick="saveAllGrades(${assignmentId})">Save All Grades</button>
            <button class="btn btn-secondary" onclick="closeModal('grading-modal')">Close</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      modal.id = 'grading-modal';
    }

    // Initialize assessment events
    function initAssessmentEvents() {
      // Initialize sample data if not exists
      if (!localStorage.getItem('gradebook')) {
        initializeSampleGradebook();
      }
      
      // Add event listeners for search and filters
      setTimeout(() => {
        const assignmentSearch = document.getElementById('assignment-search');
        if (assignmentSearch) {
          assignmentSearch.addEventListener('input', filterAssignments);
        }
      }, 100);
    }

    // Filter functions
    function filterAssignments() {
      const searchTerm = document.getElementById('assignment-search').value.toLowerCase();
      const courseFilter = document.getElementById('assignment-course-filter').value;
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      
      const filtered = assignments.filter(assignment => {
        const matchesSearch = assignment.title.toLowerCase().includes(searchTerm);
        const matchesCourse = !courseFilter || assignment.courseId == courseFilter;
        return matchesSearch && matchesCourse;
      });
      
      // Re-render assignments list
      const assignmentsList = document.getElementById('assignments-list');
      if (assignmentsList) {
        assignmentsList.innerHTML = filtered.map(assignment => `
          <div class="assessment-item">
            <div class="assessment-header">
              <div>
                <div class="assessment-title">${assignment.title}</div>
                <div class="assessment-meta">
                  <span>${assignment.courseName}</span>
                  <span>Due: ${new Date(assignment.dueDate).toLocaleDateString()}</span>
                  <span>${assignment.submissions ? assignment.submissions.length : 0} submissions</span>
                </div>
              </div>
              <div class="assessment-actions">
                <button class="btn btn-secondary" onclick="viewAssignmentDetails(${assignment.id})">View</button>
                <button class="btn btn-secondary" onclick="editAssignment(${assignment.id})">Edit</button>
                <button class="btn btn-secondary" onclick="viewSubmissions(${assignment.id})">Grade</button>
                <button class="btn btn-danger" onclick="deleteAssignment(${assignment.id})">Delete</button>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    // Placeholder functions for additional features
    function openGradebookSettings() {
      alert('Gradebook settings modal would open here');
    }

    function editWeightages(courseId) {
      alert('Weightage editing modal would open here');
    }

    function recordAudioFeedback(assignmentId, studentId) {
      alert('Audio recording functionality would be implemented here');
    }

    function addAnnotation(assignmentId, studentId) {
      alert('Annotation functionality would be implemented here');
    }

    function updateSubmissionGrade(assignmentId, studentId, grade) {
      // Update grade in localStorage
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignment = assignments.find(a => a.id == assignmentId);
      if (assignment && assignment.submissions) {
        const submission = assignment.submissions.find(s => s.studentId == studentId);
        if (submission) {
          submission.grade = parseInt(grade);
          submission.graded = true;
          localStorage.setItem('assignments', JSON.stringify(assignments));
        }
      }
    }

    function updateSubmissionFeedback(assignmentId, studentId, feedback) {
      // Update feedback in localStorage
      const assignments = JSON.parse(localStorage.getItem('assignments') || '[]');
      const assignment = assignments.find(a => a.id == assignmentId);
      if (assignment && assignment.submissions) {
        const submission = assignment.submissions.find(s => s.studentId == studentId);
        if (submission) {
          submission.feedback = feedback;
          localStorage.setItem('assignments', JSON.stringify(assignments));
        }
      }
    }

    function saveAllGrades(assignmentId) {
      alert('All grades saved successfully!');
      closeModal('grading-modal');
    }

    function bulkGrade() {
      alert('Bulk grading functionality would be implemented here');
    }

    function filterGradingItems() {
      alert('Grading filter functionality would be implemented here');
    }

    // ===== SECURITY & ADMIN CONTROLS MODULE =====
    
    function renderSecurityAdmin() {
      // Initialize sample data if not exists
      if (!getData(STORAGE_KEYS.USER_ROLES)) {
        initializeSecurityData();
      }
      
      const userRoles = getData(STORAGE_KEYS.USER_ROLES) || [];
      const privacySettings = getData(STORAGE_KEYS.PRIVACY_SETTINGS) || {};
      const backupHistory = getData(STORAGE_KEYS.BACKUP_HISTORY) || [];
      const mobileSettings = getData(STORAGE_KEYS.MOBILE_SETTINGS) || {};
      
      document.getElementById('content-area').innerHTML = `
        <div class='card' style='grid-column:1/-1;'>
          <div class='flex flex-between flex-center mb-20'>
            <h3><i class='fas fa-shield-alt'></i> Security & Admin Controls</h3>
            <div class='security-status'>
              <span class='status-indicator active'></span>
              <span>System Secure</span>
            </div>
          </div>
          
          <!-- Security Overview -->
          <div class='grid-4 mb-30'>
            <div class='security-stat'>
              <div class='stat-icon'><i class='fas fa-users-cog'></i></div>
              <div class='stat-info'>
                <div class='stat-number'>${userRoles.length}</div>
                <div class='stat-label'>Active Users</div>
              </div>
            </div>
            
            <div class='security-stat'>
              <div class='stat-icon'><i class='fas fa-shield-check'></i></div>
              <div class='stat-info'>
                <div class='stat-number'>${Object.keys(privacySettings).length}</div>
                <div class='stat-label'>Privacy Policies</div>
              </div>
            </div>
            
            <div class='security-stat'>
              <div class='stat-icon'><i class='fas fa-cloud-upload-alt'></i></div>
              <div class='stat-info'>
                <div class='stat-number'>${backupHistory.length}</div>
                <div class='stat-label'>Backups Created</div>
              </div>
            </div>
            
            <div class='security-stat'>
              <div class='stat-icon'><i class='fas fa-mobile-alt'></i></div>
              <div class='stat-info'>
                <div class='stat-number'>${mobileSettings.enabled ? 'Active' : 'Inactive'}</div>
                <div class='stat-label'>Mobile Access</div>
              </div>
            </div>
          </div>

          <!-- Main Security Tabs -->
          <div class='security-tabs'>
            <div class='tab-buttons'>
              <button class='tab-btn active' onclick='switchSecurityTab("roles", this)'>
                <i class='fas fa-users-cog'></i> Role-Based Access
              </button>
              <button class='tab-btn' onclick='switchSecurityTab("privacy", this)'>
                <i class='fas fa-user-shield'></i> Data Privacy
              </button>
              <button class='tab-btn' onclick='switchSecurityTab("backup", this)'>
                <i class='fas fa-cloud'></i> Backup & Restore
              </button>
              <button class='tab-btn' onclick='switchSecurityTab("mobile", this)'>
                <i class='fas fa-mobile-alt'></i> Mobile Access
              </button>
            </div>
            
            <div class='tab-content'>
              <div id='roles-tab' class='tab-panel active'>
                ${renderRoleBasedAccess(userRoles)}
              </div>
              <div id='privacy-tab' class='tab-panel'>
                ${renderDataPrivacy(privacySettings)}
              </div>
              <div id='backup-tab' class='tab-panel'>
                ${renderBackupRestore(backupHistory)}
              </div>
              <div id='mobile-tab' class='tab-panel'>
                ${renderMobileAccess(mobileSettings)}
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function renderRoleBasedAccess(userRoles) {
      return `
        <div class='security-section'>
          <div class='section-header'>
            <h4><i class='fas fa-users-cog'></i> Role-Based Access Control</h4>
            <button class='btn' onclick='openRoleModal()'>
              <i class='fas fa-plus'></i> Add User Role
            </button>
          </div>
          
          <div class='roles-overview'>
            <div class='role-card'>
              <div class='role-header'>
                <div class='role-icon'><i class='fas fa-crown'></i></div>
                <div class='role-info'>
                  <h5>Administrator</h5>
                  <p>Full system access and control</p>
                </div>
                <div class='role-status active'>Active</div>
              </div>
              <div class='role-permissions'>
                <span class='permission-tag'>All Permissions</span>
              </div>
            </div>
            
            <div class='role-card'>
              <div class='role-header'>
                <div class='role-icon'><i class='fas fa-chalkboard-teacher'></i></div>
                <div class='role-info'>
                  <h5>Teacher</h5>
                  <p>Course management and grading</p>
                </div>
                <div class='role-status active'>Active</div>
              </div>
              <div class='role-permissions'>
                <span class='permission-tag'>Course Management</span>
                <span class='permission-tag'>Grading</span>
                <span class='permission-tag'>Communication</span>
              </div>
            </div>
            
            <div class='role-card'>
              <div class='role-header'>
                <div class='role-icon'><i class='fas fa-user-graduate'></i></div>
                <div class='role-info'>
                  <h5>Teaching Assistant</h5>
                  <p>Limited course access and grading</p>
                </div>
                <div class='role-status active'>Active</div>
              </div>
              <div class='role-permissions'>
                <span class='permission-tag'>Grading</span>
                <span class='permission-tag'>Communication</span>
              </div>
            </div>
          </div>
          
          <div class='user-management'>
            <h5>User Management</h5>
            <div class='user-list'>
              ${userRoles.map(user => `
                <div class='user-item'>
                  <div class='user-info'>
                    <div class='user-avatar'>${user.name.split(' ').map(n => n[0]).join('')}</div>
                    <div>
                      <div class='user-name'>${user.name}</div>
                      <div class='user-email'>${user.email}</div>
                    </div>
                  </div>
                  <div class='user-role'>${user.role}</div>
                  <div class='user-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='editUserRole(${user.id})'>Edit</button>
                    <button class='btn btn-sm btn-danger' onclick='removeUserRole(${user.id})'>Remove</button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    function renderDataPrivacy(privacySettings) {
      return `
        <div class='security-section'>
          <div class='section-header'>
            <h4><i class='fas fa-user-shield'></i> Data Privacy Compliance</h4>
            <button class='btn' onclick='updatePrivacySettings()'>
              <i class='fas fa-save'></i> Update Settings
            </button>
          </div>
          
          <div class='privacy-grid'>
            <div class='privacy-card'>
              <div class='privacy-header'>
                <div class='privacy-logo gdpr-logo'>
                  <i class='fas fa-shield-check' style='font-size: 24px; margin-bottom: 4px;'></i>
                  <span class='logo-text'>GDPR</span>
                </div>
                <h5>GDPR Compliance</h5>
              </div>
              <div class='privacy-status ${privacySettings.gdpr ? 'active' : 'inactive'}'>
                ${privacySettings.gdpr ? 'Enabled' : 'Disabled'}
              </div>
              <ul class='privacy-features'>
                <li>Data minimization</li>
                <li>Right to be forgotten</li>
                <li>Data portability</li>
                <li>Consent management</li>
              </ul>
            </div>
            
            <div class='privacy-card'>
              <div class='privacy-header'>
                <div class='privacy-logo ferpa-logo'>
                  <i class='fas fa-graduation-cap' style='font-size: 24px; margin-bottom: 4px;'></i>
                  <span class='logo-text'>FERPA</span>
                </div>
                <h5>FERPA Compliance</h5>
              </div>
              <div class='privacy-status ${privacySettings.ferpa ? 'active' : 'inactive'}'>
                ${privacySettings.ferpa ? 'Enabled' : 'Disabled'}
              </div>
              <ul class='privacy-features'>
                <li>Student record protection</li>
                <li>Parent access controls</li>
                <li>Directory information</li>
                <li>Disclosure prevention</li>
              </ul>
            </div>
            
            <div class='privacy-card'>
              <div class='privacy-header'>
                <div class='privacy-logo coppa-logo'>
                  <i class='fas fa-child' style='font-size: 24px; margin-bottom: 4px;'></i>
                  <span class='logo-text'>COPPA</span>
                </div>
                <h5>COPPA Compliance</h5>
              </div>
              <div class='privacy-status ${privacySettings.coppa ? 'active' : 'inactive'}'>
                ${privacySettings.coppa ? 'Enabled' : 'Disabled'}
              </div>
              <ul class='privacy-features'>
                <li>Parental consent</li>
                <li>Age verification</li>
                <li>Data collection limits</li>
                <li>Safe harbor provisions</li>
              </ul>
            </div>
          </div>
          
          <div class='data-retention'>
            <h5>Data Retention Policies</h5>
            <div class='retention-settings'>
              <div class='setting-item'>
                <label>Student Records Retention:</label>
                <select id='student-retention' class='form-control'>
                  <option value='7' ${privacySettings.studentRetention === '7' ? 'selected' : ''}>7 years</option>
                  <option value='10' ${privacySettings.studentRetention === '10' ? 'selected' : ''}>10 years</option>
                  <option value='permanent' ${privacySettings.studentRetention === 'permanent' ? 'selected' : ''}>Permanent</option>
                </select>
              </div>
              <div class='setting-item'>
                <label>Assignment Submissions:</label>
                <select id='submission-retention' class='form-control'>
                  <option value='2' ${privacySettings.submissionRetention === '2' ? 'selected' : ''}>2 years</option>
                  <option value='5' ${privacySettings.submissionRetention === '5' ? 'selected' : ''}>5 years</option>
                  <option value='7' ${privacySettings.submissionRetention === '7' ? 'selected' : ''}>7 years</option>
                </select>
              </div>
              <div class='setting-item'>
                <label>Communication Logs:</label>
                <select id='communication-retention' class='form-control'>
                  <option value='1' ${privacySettings.communicationRetention === '1' ? 'selected' : ''}>1 year</option>
                  <option value='2' ${privacySettings.communicationRetention === '2' ? 'selected' : ''}>2 years</option>
                  <option value='3' ${privacySettings.communicationRetention === '3' ? 'selected' : ''}>3 years</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function renderBackupRestore(backupHistory) {
      return `
        <div class='security-section'>
          <div class='section-header'>
            <h4><i class='fas fa-cloud'></i> Backup & Restore</h4>
            <button class='btn' onclick='createBackup()'>
              <i class='fas fa-cloud-upload-alt'></i> Create Backup
            </button>
          </div>
          
          <div class='backup-overview'>
            <div class='backup-stats'>
              <div class='backup-stat'>
                <div class='stat-icon'><i class='fas fa-calendar'></i></div>
                <div class='stat-info'>
                  <div class='stat-number'>${backupHistory.length}</div>
                  <div class='stat-label'>Total Backups</div>
                </div>
              </div>
              <div class='backup-stat'>
                <div class='stat-icon'><i class='fas fa-clock'></i></div>
                <div class='stat-info'>
                  <div class='stat-number'>${backupHistory.length > 0 ? new Date(backupHistory[backupHistory.length - 1].timestamp).toLocaleDateString() : 'Never'}</div>
                  <div class='stat-label'>Last Backup</div>
                </div>
              </div>
              <div class='backup-stat'>
                <div class='stat-icon'><i class='fas fa-hdd'></i></div>
                <div class='stat-info'>
                  <div class='stat-number'>${calculateBackupSize(backupHistory)} MB</div>
                  <div class='stat-label'>Total Size</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class='backup-schedule'>
            <h5>Automatic Backup Schedule</h5>
            <div class='schedule-settings'>
              <div class='setting-item'>
                <label>Backup Frequency:</label>
                <select id='backup-frequency' class='form-control'>
                  <option value='daily'>Daily</option>
                  <option value='weekly'>Weekly</option>
                  <option value='monthly'>Monthly</option>
                </select>
              </div>
              <div class='setting-item'>
                <label>Backup Time:</label>
                <input type='time' id='backup-time' class='form-control' value='02:00'>
              </div>
              <div class='setting-item'>
                <label>Retention Period:</label>
                <select id='backup-retention' class='form-control'>
                  <option value='30'>30 days</option>
                  <option value='90'>90 days</option>
                  <option value='365'>1 year</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class='backup-history'>
            <h5>Backup History</h5>
            <div class='backup-list'>
              ${backupHistory.map(backup => `
                <div class='backup-item'>
                  <div class='backup-info'>
                    <div class='backup-date'>${new Date(backup.timestamp).toLocaleString()}</div>
                    <div class='backup-size'>${backup.size} MB</div>
                    <div class='backup-type'>${backup.type}</div>
                  </div>
                  <div class='backup-actions'>
                    <button class='btn btn-sm btn-secondary' onclick='downloadBackup(${backup.id})'>
                      <i class='fas fa-download'></i> Download
                    </button>
                    <button class='btn btn-sm btn-secondary' onclick='restoreBackup(${backup.id})'>
                      <i class='fas fa-undo'></i> Restore
                    </button>
                    <button class='btn btn-sm btn-danger' onclick='deleteBackup(${backup.id})'>
                      <i class='fas fa-trash'></i> Delete
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
    function renderMobileAccess(mobileSettings) {
      return `
        <div class='security-section'>
          <div class='section-header'>
            <h4><i class='fas fa-mobile-alt'></i> Mobile & Offline Access</h4>
            <button class='btn' onclick='toggleMobileAccess()'>
              <i class='fas fa-${mobileSettings.enabled ? 'times' : 'check'}'></i>
              ${mobileSettings.enabled ? 'Disable' : 'Enable'} Mobile Access
            </button>
          </div>
          
          <div class='mobile-overview'>
            <div class='mobile-status ${mobileSettings.enabled ? 'active' : 'inactive'}'>
              <div class='status-icon'>
                <i class='fas fa-${mobileSettings.enabled ? 'check-circle' : 'times-circle'}'></i>
              </div>
              <div class='status-info'>
                <h5>Mobile Access Status</h5>
                <p>${mobileSettings.enabled ? 'Mobile access is currently enabled' : 'Mobile access is currently disabled'}</p>
              </div>
            </div>
          </div>
          
          <div class='mobile-features'>
            <h5>Mobile App Features</h5>
            <div class='features-grid'>
              <div class='feature-card'>
                <div class='feature-icon'><i class='fas fa-chalkboard'></i></div>
                <h6>Grade Assignments</h6>
                <p>Review and grade student submissions on the go</p>
                <div class='feature-status ${mobileSettings.grading ? 'active' : 'inactive'}'>
                  ${mobileSettings.grading ? 'Enabled' : 'Disabled'}
                </div>
              </div>
              
              <div class='feature-card'>
                <div class='feature-icon'><i class='fas fa-comments'></i></div>
                <h6>Reply to Messages</h6>
                <p>Respond to student and parent messages instantly</p>
                <div class='feature-status ${mobileSettings.messaging ? 'active' : 'inactive'}'>
                  ${mobileSettings.messaging ? 'Enabled' : 'Disabled'}
                </div>
              </div>
              
              <div class='feature-card'>
                <div class='feature-icon'><i class='fas fa-bell'></i></div>
                <h6>Push Notifications</h6>
                <p>Receive real-time alerts for important events</p>
                <div class='feature-status ${mobileSettings.notifications ? 'active' : 'inactive'}'>
                  ${mobileSettings.notifications ? 'Enabled' : 'Disabled'}
                </div>
              </div>
              
              <div class='feature-card'>
                <div class='feature-icon'><i class='fas fa-wifi'></i></div>
                <h6>Offline Mode</h6>
                <p>Work without internet connection</p>
                <div class='feature-status ${mobileSettings.offline ? 'active' : 'inactive'}'>
                  ${mobileSettings.offline ? 'Enabled' : 'Disabled'}
                </div>
              </div>
            </div>
          </div>
          
          <div class='mobile-settings'>
            <h5>Mobile Settings</h5>
            <div class='settings-grid'>
              <div class='setting-item'>
                <label>Auto-sync Frequency:</label>
                <select id='sync-frequency' class='form-control'>
                  <option value='5' ${mobileSettings.syncFrequency === '5' ? 'selected' : ''}>Every 5 minutes</option>
                  <option value='15' ${mobileSettings.syncFrequency === '15' ? 'selected' : ''}>Every 15 minutes</option>
                  <option value='30' ${mobileSettings.syncFrequency === '30' ? 'selected' : ''}>Every 30 minutes</option>
                  <option value='manual' ${mobileSettings.syncFrequency === 'manual' ? 'selected' : ''}>Manual only</option>
                </select>
              </div>
              <div class='setting-item'>
                <label>Data Usage Limit:</label>
                <select id='data-limit' class='form-control'>
                  <option value='unlimited' ${mobileSettings.dataLimit === 'unlimited' ? 'selected' : ''}>Unlimited</option>
                  <option value='100' ${mobileSettings.dataLimit === '100' ? 'selected' : ''}>100 MB</option>
                  <option value='500' ${mobileSettings.dataLimit === '500' ? 'selected' : ''}>500 MB</option>
                  <option value='1' ${mobileSettings.dataLimit === '1' ? 'selected' : ''}>1 GB</option>
                </select>
              </div>
              <div class='setting-item'>
                <label>Biometric Authentication:</label>
                <select id='biometric-auth' class='form-control'>
                  <option value='enabled' ${mobileSettings.biometricAuth === 'enabled' ? 'selected' : ''}>Enabled</option>
                  <option value='disabled' ${mobileSettings.biometricAuth === 'disabled' ? 'selected' : ''}>Disabled</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class='mobile-download'>
            <h5>Download Mobile App</h5>
            <div class='download-options'>
              <a href='#' class='download-btn'>
                <i class='fab fa-apple'></i>
                <span>Download for iOS</span>
              </a>
              <a href='#' class='download-btn'>
                <i class='fab fa-google-play'></i>
                <span>Download for Android</span>
              </a>
            </div>
          </div>
        </div>
      `;
    }
    
    function initializeSecurityData() {
      // Initialize sample user roles
      const sampleRoles = [
        { id: 1, name: 'Sarah Johnson', email: 'sarah.j@university.edu', role: 'Teaching Assistant', permissions: ['grading', 'communication'] },
        { id: 2, name: 'Mike Chen', email: 'mike.chen@university.edu', role: 'Co-Teacher', permissions: ['course_management', 'grading', 'communication'] },
        { id: 3, name: 'Dr. Emily Rodriguez', email: 'emily.r@university.edu', role: 'Department Head', permissions: ['all'] }
      ];
      setData(STORAGE_KEYS.USER_ROLES, sampleRoles);
      
      // Initialize privacy settings
      const privacySettings = {
        gdpr: true,
        ferpa: true,
        coppa: true,
        studentRetention: '7',
        submissionRetention: '5',
        communicationRetention: '2'
      };
      setData(STORAGE_KEYS.PRIVACY_SETTINGS, privacySettings);
      
      // Initialize backup history
      const backupHistory = [
        { id: 1, timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(), size: 45.2, type: 'Automatic' },
        { id: 2, timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), size: 42.8, type: 'Automatic' },
        { id: 3, timestamp: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(), size: 41.5, type: 'Manual' }
      ];
      setData(STORAGE_KEYS.BACKUP_HISTORY, backupHistory);
      
      // Initialize mobile settings
      const mobileSettings = {
        enabled: true,
        grading: true,
        messaging: true,
        notifications: true,
        offline: true,
        syncFrequency: '15',
        dataLimit: 'unlimited',
        biometricAuth: 'enabled'
      };
      setData(STORAGE_KEYS.MOBILE_SETTINGS, mobileSettings);
    }
    
    function switchSecurityTab(tabName, element) {
      // Hide all tab panels
      document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName + '-tab').classList.add('active');
      element.classList.add('active');
    }
    
    function calculateBackupSize(backupHistory) {
      return backupHistory.reduce((total, backup) => total + backup.size, 0).toFixed(1);
    }
    
    // Security module functions
    function openRoleModal() {
      alert('Role management modal would open here');
    }
    
    function editUserRole(userId) {
      alert('Edit user role modal would open here');
    }
    
    function removeUserRole(userId) {
      if (confirm('Are you sure you want to remove this user role?')) {
        const userRoles = getData(STORAGE_KEYS.USER_ROLES) || [];
        const updatedRoles = userRoles.filter(role => role.id !== userId);
        setData(STORAGE_KEYS.USER_ROLES, updatedRoles);
        renderSecurityAdmin();
        showNotification('User role removed successfully!', 'success');
      }
    }
    
    function updatePrivacySettings() {
      const privacySettings = {
        gdpr: document.getElementById('gdpr-compliance').checked,
        ferpa: document.getElementById('ferpa-compliance').checked,
        coppa: document.getElementById('coppa-compliance').checked,
        studentRetention: document.getElementById('student-retention').value,
        submissionRetention: document.getElementById('submission-retention').value,
        communicationRetention: document.getElementById('communication-retention').value
      };
      setData(STORAGE_KEYS.PRIVACY_SETTINGS, privacySettings);
      showNotification('Privacy settings updated successfully!', 'success');
    }
    
    function createBackup() {
      const backup = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        size: Math.random() * 10 + 40,
        type: 'Manual'
      };
      
      const backupHistory = getData(STORAGE_KEYS.BACKUP_HISTORY) || [];
      backupHistory.push(backup);
      setData(STORAGE_KEYS.BACKUP_HISTORY, backupHistory);
      
      renderSecurityAdmin();
      showNotification('Backup created successfully!', 'success');
    }
    
    function downloadBackup(backupId) {
      alert('Backup download would start here');
    }
    
    function restoreBackup(backupId) {
      if (confirm('Are you sure you want to restore this backup? This will overwrite current data.')) {
        alert('Backup restoration would start here');
      }
    }
    
    function deleteBackup(backupId) {
      if (confirm('Are you sure you want to delete this backup?')) {
        const backupHistory = getData(STORAGE_KEYS.BACKUP_HISTORY) || [];
        const updatedHistory = backupHistory.filter(backup => backup.id !== backupId);
        setData(STORAGE_KEYS.BACKUP_HISTORY, updatedHistory);
        renderSecurityAdmin();
        showNotification('Backup deleted successfully!', 'success');
      }
    }
    
    function toggleMobileAccess() {
      const mobileSettings = getData(STORAGE_KEYS.MOBILE_SETTINGS) || {};
      mobileSettings.enabled = !mobileSettings.enabled;
      setData(STORAGE_KEYS.MOBILE_SETTINGS, mobileSettings);
      renderSecurityAdmin();
      showNotification(`Mobile access ${mobileSettings.enabled ? 'enabled' : 'disabled'}!`, 'success');
    }

    // Make functions globally available
    window.switchAssessmentTab = switchAssessmentTab;
    window.createQuiz = createQuiz;
    window.addQuizQuestion = addQuizQuestion;
    window.removeQuizQuestion = removeQuizQuestion;
    window.toggleQuestionOptions = toggleQuestionOptions;
    window.loadGradebookData = loadGradebookData;
    window.exportGradebook = exportGradebook;
    window.exportGradebookPDF = exportGradebookPDF;
    window.gradeAssignment = gradeAssignment;
    window.filterAssignments = filterAssignments;
    window.filterQuizzes = filterQuizzes;
    window.openGradebookSettings = openGradebookSettings;
    window.editWeightages = editWeightages;
    window.recordAudioFeedback = recordAudioFeedback;
    window.addAnnotation = addAnnotation;
    window.updateSubmissionGrade = updateSubmissionGrade;
    window.updateSubmissionFeedback = updateSubmissionFeedback;
    window.saveAllGrades = saveAllGrades;
    window.bulkGrade = bulkGrade;
    window.filterGradingItems = filterGradingItems;
    // Security module functions
    window.switchSecurityTab = switchSecurityTab;
    window.openRoleModal = openRoleModal;
    window.editUserRole = editUserRole;
    window.removeUserRole = removeUserRole;
    window.updatePrivacySettings = updatePrivacySettings;
    window.createBackup = createBackup;
    window.downloadBackup = downloadBackup;
    window.restoreBackup = restoreBackup;
    window.deleteBackup = deleteBackup;
    window.toggleMobileAccess = toggleMobileAccess;
  </script>
</body>
</html>

